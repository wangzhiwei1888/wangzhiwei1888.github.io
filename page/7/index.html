<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="javascript nodejs web developer...">
<meta property="og:type" content="website">
<meta property="og:title" content="WBlog">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="WBlog">
<meta property="og:description" content="javascript nodejs web developer...">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wangzhiwei">
<meta property="article:tag" content="javascript nodejs web developer fe engineer">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>WBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wangzhiwei blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/go/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/go/" class="post-title-link" itemprop="url">go</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:53:00" itemprop="dateCreated datePublished" datetime="2024-12-13T14:53:00+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下载<br><a target="_blank" rel="noopener" href="https://golang.google.cn/dl/">https://golang.google.cn/dl/</a></p>
<p>安装<br><a target="_blank" rel="noopener" href="https://golang.google.cn/doc/install">https://golang.google.cn/doc/install</a></p>
<p>rm -rf &#x2F;usr&#x2F;local&#x2F;go &amp;&amp; tar -C &#x2F;usr&#x2F;local -xzf go1.23.0.linux-amd64.tar.gz</p>
<p>vi .profile<br>export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;go&#x2F;bin</p>
<p>source .profile</p>
<p>go version</p>
<p>更好镜像源<br>go env -w GO111MODULE&#x3D;on<br>go env -w GOPROXY&#x3D;<a target="_blank" rel="noopener" href="https://goproxy.io,direct/">https://goproxy.io,direct</a></p>
<p><a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/quickstart/">https://gin-gonic.com/zh-cn/docs/quickstart/</a></p>
<p>安装gin<br>go get github.com&#x2F;gin-gonic&#x2F;gin</p>
<p>安装 fresh 代替 go run xxx.go<br>go install github.com&#x2F;pilu&#x2F;fresh@latest</p>
<p>命令找不到，需要配置环境变量<br>vi .profile<br>export PATH&#x3D;$PATH:&#x2F;home&#x2F;dc&#x2F;go&#x2F;bin<br>source .profile</p>
<p>参考视频<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tU4y1u7i7/?spm_id_from=333.337.search-card.all.click&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1tU4y1u7i7/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>
<p>运行项目<br>go run xxx.go</p>
<p>参考<br><a target="_blank" rel="noopener" href="https://github.com/goproxyio/goproxy.io/blob/master/content/zh/docs/getting-started.md">https://github.com/goproxyio/goproxy.io/blob/master/content/zh/docs/getting-started.md</a></p>
<p>go项目开发学习</p>
<p>8小时转职Golang工程师(如果你想低成本学习Go语言)<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gf4y1r79E?spm_id_from=333.788.videopod.episodes&vd_source=ffda878df0ed45bee1ade91d8f451048&p=2">https://www.bilibili.com/video/BV1gf4y1r79E?spm_id_from=333.788.videopod.episodes&amp;vd_source=ffda878df0ed45bee1ade91d8f451048&amp;p=2</a></p>
<p>在线文章：<a target="_blank" rel="noopener" href="https://www.yuque.com/aceld/mo95lb/dsk886">https://www.yuque.com/aceld/mo95lb/dsk886</a><br>代码<br><a target="_blank" rel="noopener" href="https://pan.baidu.com/disk/main?from=homeSave#/index?category=all&path=%2F%E6%88%91%E7%9A%84%E8%B5%84%E6%BA%90">https://pan.baidu.com/disk/main?from=homeSave#/index?category=all&amp;path=%2F%E6%88%91%E7%9A%84%E8%B5%84%E6%BA%90</a><br>gin快速入门<br><a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/quickstart/">https://gin-gonic.com/zh-cn/docs/quickstart/</a><br>GO流行的Gin框架快速搭建开发</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Jy4y1F7RG/?spm_id_from=333.337.search-card.all.click&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1Jy4y1F7RG/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>
<p>go 七牛云代理<br><a target="_blank" rel="noopener" href="https://goproxy.cn/">https://goproxy.cn/</a></p>
<p>开发学习<br>环境搭建<br>安装</p>
<p>配置<br>cat ~&#x2F;.bashrc 添加如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export GOROOT=&quot;/usr/local/go&quot;</span><br><span class="line">export GOPATH=$HOME/go</span><br><span class="line">export GOBIN=$GOROOT/bin</span><br><span class="line">export PATH=$PATH:$GOBIN</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置镜像源</p>
<p><img src="/../images/go_01.png"></p>
<p>创建 go.mod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">go mod init firstGolang</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>export GOPATH&#x3D;$HOME&#x2F;go</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在$HOME/go 即  /home/dc/go/ 目录下的 src 目录创建项目</span><br><span class="line"></span><br><span class="line">/home/dc/go/src/nc-data-sync-go/firstGolang</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/go_02.png"></p>
<p>安装gin </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>gin 的使用参考<br><a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/quickstart/">https://gin-gonic.com/zh-cn/docs/quickstart/</a></p>
<p>tool.go</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package models</span><br><span class="line"></span><br><span class="line">func Add(a int, b int) int &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>main.go</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;firstGolang/models&quot;</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line"></span><br><span class="line">    num := models.Add(1, 2)</span><br><span class="line">    fmt.Println(&quot;1+2=&quot;, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意包名为文件夹名称</p>
<p><img src="/../images/go_03.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/njs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/njs/" class="post-title-link" itemprop="url">njs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:52:47" itemprop="dateCreated datePublished" datetime="2024-12-13T14:52:47+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="njs"><a href="#njs" class="headerlink" title="njs"></a>njs</h1><p>在nginx上写JavaScript</p>
<p>NGINX JavaScript examples<br><a target="_blank" rel="noopener" href="https://github.com/nginx/njs-examples?tab=readme-ov-file#https-fetch-example-http-certs-fetch-https">https://github.com/nginx/njs-examples?tab=readme-ov-file#https-fetch-example-http-certs-fetch-https</a></p>
<p>njs、nginx JavaScript、在nginx上写JavaScript、nginx支持js</p>
<p>重点<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_37064888/article/details/142216573">https://blog.csdn.net/weixin_37064888/article/details/142216573</a><br><a target="_blank" rel="noopener" href="https://github.com/nginx/njs-examples">https://github.com/nginx/njs-examples</a><br><a target="_blank" rel="noopener" href="https://github.com/zongzw-nginx/nginx-njs-usecases">https://github.com/zongzw-nginx/nginx-njs-usecases</a><br><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/njs/reference.html">https://nginx.org/en/docs/njs/reference.html</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1nq4y1p7gk/?spm_id_from=333.337.search-card.all.click&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1nq4y1p7gk/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>
<p><img src="/../images/njs_01.png"></p>
<p><img src="/../images/njs_02.png"></p>
<p>其他：<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LB4y1p7p3/?vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1LB4y1p7p3/?vd_source=ffda878df0ed45bee1ade91d8f451048</a><br><a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1783143370177474114&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1783143370177474114&amp;wfr=spider&amp;for=pc</a><br>njs 迭代版本<br><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/njs/changes.html#njs0.8.4">https://nginx.org/en/docs/njs/changes.html#njs0.8.4</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/quickjs-zh/QuickJS?tab=readme-ov-file#21-%E5%AE%89%E8%A3%85">https://github.com/quickjs-zh/QuickJS?tab=readme-ov-file#21-%E5%AE%89%E8%A3%85</a></p>
<p>Nginx的njs开始支持将QuickJS作为实现引擎了。他们早几年就该这么做。如果在这个之上加多一层node API兼容层可以直接跑主流node module，那在生态上还是有优势的。</p>
<p>官网+ 现有modules<br><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/">https://nginx.org/en/docs/</a></p>
<p>QuickJS架构及源代码分析 - 丁乐华 - V8技术讨论会 - OSDT社区 - 20200607</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1bt4y1y79L/?spm_id_from=333.337.search-card.all.click&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1bt4y1y79L/?spm_id_from=333.337.search-card.all.click&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>
<p>quickjs 使用 英文教程<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1XjhmexEFx?spm_id_from=333.788.videopod.sections&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV1XjhmexEFx?spm_id_from=333.788.videopod.sections&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>
<p>下载项目<br>git clone nginx njs openssl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mac@bogon study % tree -L 1</span><br><span class="line">.</span><br><span class="line">├── nginx</span><br><span class="line">├── njs</span><br><span class="line">├── openssl</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行编译命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto/configure --prefix=/usr/local/nginx --with-http_ssl_module --with-openssl=/Users/mac/study/openssl --add-module=../njs/nginx</span><br><span class="line"></span><br><span class="line">sudo make</span><br><span class="line">sudo make install</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>script.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function hello(r) &#123;</span><br><span class="line">    r.return(200, &quot;Hello, njs!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">export default &#123; hello &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">load_module /usr/local/nginx/modules/ngx_http_js_module.so;</span><br><span class="line"></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    </span><br><span class="line">    js_import main from /usr/local/nginx/conf/script.js;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        location /hello &#123;</span><br><span class="line">            js_content main.hello;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function hello(r) &#123;</span><br><span class="line">    r.return(200, &quot;Hello, njs!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleHeadersRequest(r) &#123;</span><br><span class="line">    var userAgent = r.headersIn[&#x27;User-Agent&#x27;] || &quot;&quot;;</span><br><span class="line">    if (userAgent.includes(&quot;Chrome&quot;)) &#123;</span><br><span class="line">        r.return(200, &quot;You are using Chrome.&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        r.return(200, &quot;You are not using Chrome.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleSearchRequest(r) &#123;</span><br><span class="line">    var query = r.args[&#x27;query&#x27;];</span><br><span class="line">    if (query) &#123;</span><br><span class="line">        r.return(200, &quot;Search query: &quot; + query);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        r.return(400, &quot;No search query provided.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123; hello, handleHeadersRequest, handleSearchRequest &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">load_module /usr/local/nginx/modules/ngx_http_js_module.so;</span><br><span class="line"></span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    </span><br><span class="line">    js_import main from /usr/local/nginx/conf/script.js;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        location /hello &#123;</span><br><span class="line">            js_content main.hello;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /test &#123;</span><br><span class="line">            js_content main.handleHeadersRequest;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /search &#123;</span><br><span class="line">            js_content main.handleSearchRequest;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>–with-http_auth_request_module</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">auto/configure --prefix=/usr/local/nginx --with-http_ssl_module --with-openssl=/Users/mac/study/openssl --with-http_auth_request_module --add-dynamic-module=../njs/nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>njs 默认提供的模块，可以直接使用，npm 的模块现在看还不能直接用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import fs from &#x27;fs&#x27;;</span><br><span class="line">import qs from &#x27;querystring&#x27;;</span><br><span class="line">import cr from &#x27;crypto&#x27;;</span><br><span class="line">import xml from &#x27;xml&#x27;;</span><br><span class="line">import zlib from &#x27;zlib&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>njs 源码分析<br>njs内存池代码阅读<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41252394/article/details/126575902">https://blog.csdn.net/qq_41252394/article/details/126575902</a></p>
<ul>
<li>为其它环境(如QuickJs)提供模块加载功能，以复用npm上的模块包；<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903971316842509">https://juejin.cn/post/6844903971316842509</a></li>
</ul>
<p>深度分析quickjs<br><a target="_blank" rel="noopener" href="https://ming1016.github.io/2021/02/21/deeply-analyse-quickjs/#QuickJS">https://ming1016.github.io/2021/02/21/deeply-analyse-quickjs/#QuickJS</a></p>
<p>安装nginx并配置nginxscript(njs)实现请求头验证或者分流</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/antake/p/16301492.html">https://www.cnblogs.com/antake/p/16301492.html</a></p>
<p>NGINX+NJS应用场景之 带内容预览功能的文件服务器<br><a target="_blank" rel="noopener" href="https://community.f5chinanetworks.com/pc-post-426.html">https://community.f5chinanetworks.com/pc-post-426.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/quickjs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/quickjs/" class="post-title-link" itemprop="url">quickjs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:52:42" itemprop="dateCreated datePublished" datetime="2024-12-13T14:52:42+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p>环境处理<br>clone 项目<br>执行 make 命令<br>生成 qjs qjsc 命令行工具 </p>
<p>可以执行 系统命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import &#123; popen &#125; from &#x27;std&#x27;;</span><br><span class="line"></span><br><span class="line">import * as os from &quot;os&quot;;</span><br><span class="line">import * as std from &quot;std&quot;;</span><br><span class="line"></span><br><span class="line">var errorObj = &#123;&#125;;</span><br><span class="line">// var pipe = popen(&quot;./examples/hello&quot;, &quot;r&quot;, errorObj);</span><br><span class="line">var pipe = popen(&quot;ls -la&quot;, &quot;r&quot;, errorObj);</span><br><span class="line">if (!pipe) &#123;</span><br><span class="line">    throw new Error(`Failed to open pipe: $&#123;errorObj.errno&#125;`);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(pipe.readAsString())</span><br><span class="line">// var output = readAll(pipe);</span><br><span class="line">// console.log(output.toString());</span><br><span class="line">// pipe.close();</span><br><span class="line"></span><br><span class="line">var ret = os.exec([&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;exit 1&quot;], &#123; usePath: false &#125;);</span><br><span class="line"></span><br><span class="line">console.log(ret)</span><br><span class="line"></span><br><span class="line">var f = std.tmpfile();</span><br><span class="line">var str = &quot;hello world\n&quot;;</span><br><span class="line">f.puts(str);</span><br><span class="line"></span><br><span class="line">f.seek(0, std.SEEK_SET);</span><br><span class="line">var str1 = f.readAsString();</span><br><span class="line">// assert(str1 === str);</span><br><span class="line"></span><br><span class="line">console.log(str1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>自己通过 curl 命令封装 fetch 方法</p>
<p>quick 可以使用 redaxios - 调用远程请求<br><a target="_blank" rel="noopener" href="https://github.com/wangzhiwei1888/redaxios/tree/master">https://github.com/wangzhiwei1888/redaxios/tree/master</a></p>
<p>可以通过 quickjs 中 的 test 文件夹进行学习更多能力</p>
<p><img src="/../images/quickjs_01.png"></p>
<p>fetch.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import &#123; popen &#125; from &#x27;std&#x27;;</span><br><span class="line">export default function fetch(resource, init) &#123;</span><br><span class="line"></span><br><span class="line">    init = init || &#123;</span><br><span class="line">        method: &#x27;GET&#x27;,</span><br><span class="line">        headers: null,</span><br><span class="line">        body: null,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    let spErr = &#123;&#125;</span><br><span class="line">    let curlCmd = `curl -s -X$&#123;init.method&#125; $&#123;resource&#125;`</span><br><span class="line"></span><br><span class="line">    if (init.headers != null) &#123;</span><br><span class="line">        curlCmd = `$&#123;curlCmd&#125; $&#123;Object.entries(init.headers).map(n=&gt; `-H &#x27;$&#123;n[0]&#125;: $&#123;n[1]&#125;&#x27;`).join(&#x27; &#x27;)&#125;`</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    if (init.method != &#x27;GET&#x27;)</span><br><span class="line">    &#123;</span><br><span class="line">      curlCmd = `$&#123;curlCmd&#125; -d &#x27;$&#123;init.body&#125;&#x27;`</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    console.log(curlCmd);</span><br><span class="line">    let sp = popen(curlCmd, &#x27;r&#x27;, spErr);</span><br><span class="line">    let curlOutput = sp.readAsString();</span><br><span class="line">    let responseUrl = resource;</span><br><span class="line">    let responseHeaders = &#123;&#125;;</span><br><span class="line">    let responseOk = true;</span><br><span class="line">    let responseStatus = 200;</span><br><span class="line">    </span><br><span class="line">    console.log(curlOutput)</span><br><span class="line">    </span><br><span class="line">    let p = new Promise(function(resolve, reject) &#123;</span><br><span class="line"></span><br><span class="line">        let response = &#123;</span><br><span class="line">            headers: responseHeaders,</span><br><span class="line">            ok: responseOk,</span><br><span class="line">            url: responseUrl,</span><br><span class="line">            json: () =&gt; JSON.parse(curlOutput),</span><br><span class="line">            text: () =&gt; curlOutput,</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        resolve(response);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>fetch.js 使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import fetch from &#x27;./fetch.js&#x27;;</span><br><span class="line"></span><br><span class="line">const url = &#x27;https://jsonplaceholder.typicode.com/todos/1&#x27;;</span><br><span class="line"></span><br><span class="line">fetch(url)</span><br><span class="line">  .then(data =&gt; &#123;</span><br><span class="line">      console.log(JSON.stringify(data));</span><br><span class="line">      return data.json();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(res =&gt; &#123;</span><br><span class="line">    console.log(JSON.stringify(res));</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    console.log(&#x27;err:&#x27; + JSON.stringify(err));</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">fetch(&#x27;https://jsonplaceholder.typicode.com/posts&#x27;, &#123; method: &#x27;POST&#x27;, headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/json; charset=UTF-8&#x27;&#125;, body: JSON.stringify(&#123;&#x27;title&#x27;: &#x27;foo&#x27;, &#x27;body&#x27;: &#x27;bar&#x27;, &#x27;userId&#x27;: 1&#125;)&#125;)</span><br><span class="line">  .then(data =&gt; &#123;</span><br><span class="line">      console.log(JSON.stringify(data));</span><br><span class="line">      return data.json();</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(res =&gt; &#123;</span><br><span class="line">    console.log(JSON.stringify(res));</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    console.log(&#x27;err:&#x27; + JSON.stringify(err));</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>fetch.js  + redaxios.js 使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import redaxios from &#x27;./redaxios.js&#x27;;</span><br><span class="line">import fetch from &#x27;./fetch.js&#x27;;</span><br><span class="line"></span><br><span class="line">const axios = redaxios.create(&#123;fetch, responseType: &#x27;json&#x27; &#125;);</span><br><span class="line"></span><br><span class="line">// 定义请求的 URL 和配置</span><br><span class="line">const url = &#x27;https://jsonplaceholder.typicode.com/todos/1&#x27;;</span><br><span class="line"></span><br><span class="line">axios.get(url)</span><br><span class="line">  .then(res =&gt; res.data)</span><br><span class="line">  .then(data =&gt; &#123;</span><br><span class="line">    console.log(JSON.stringify(data))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">axios.post(&#x27;https://jsonplaceholder.typicode.com/posts&#x27;, &#123; &#x27;title&#x27;: &#x27;foo&#x27;, &#x27;body&#x27;: &#x27;bar&#x27;, &#x27;userId&#x27;: 1 &#125;)</span><br><span class="line">  .then(res =&gt; res.data)</span><br><span class="line">  .then(data =&gt; &#123;</span><br><span class="line">    console.log(JSON.stringify(data))</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    console.log(err.stack);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>redaxios.js 修改版</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Copyright 2018 Google Inc. All Rights Reserved.</span><br><span class="line"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="line"> * you may not use this file except in compliance with the License.</span><br><span class="line"> * You may obtain a copy of the License at</span><br><span class="line"> *     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"> * See the License for the specific language governing permissions and</span><br><span class="line"> * limitations under the License.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @public</span><br><span class="line"> * @typedef Options</span><br><span class="line"> * @property &#123;string&#125; [url] the URL to request</span><br><span class="line"> * @property &#123;&#x27;get&#x27;|&#x27;post&#x27;|&#x27;put&#x27;|&#x27;patch&#x27;|&#x27;delete&#x27;|&#x27;options&#x27;|&#x27;head&#x27;|&#x27;GET&#x27;|&#x27;POST&#x27;|&#x27;PUT&#x27;|&#x27;PATCH&#x27;|&#x27;DELETE&#x27;|&#x27;OPTIONS&#x27;|&#x27;HEAD&#x27;&#125; [method=&quot;get&quot;] HTTP method, case-insensitive</span><br><span class="line"> * @property &#123;RequestHeaders&#125; [headers] Request headers</span><br><span class="line"> * @property &#123;FormData|string|object&#125; [body] a body, optionally encoded, to send</span><br><span class="line"> * @property &#123;&#x27;text&#x27;|&#x27;json&#x27;|&#x27;stream&#x27;|&#x27;blob&#x27;|&#x27;arrayBuffer&#x27;|&#x27;formData&#x27;|&#x27;stream&#x27;&#125; [responseType=&quot;json&quot;] An encoding to use for the response</span><br><span class="line"> * @property &#123;Record&lt;string,any&gt;|URLSearchParams&#125; [params] querystring parameters</span><br><span class="line"> * @property &#123;(params: Options[&#x27;params&#x27;]) =&gt; string&#125; [paramsSerializer] custom function to stringify querystring parameters</span><br><span class="line"> * @property &#123;boolean&#125; [withCredentials] Send the request with credentials like cookies</span><br><span class="line"> * @property &#123;string&#125; [auth] Authorization header value to send with the request</span><br><span class="line"> * @property &#123;string&#125; [xsrfCookieName] Pass an Cross-site Request Forgery prevention cookie value as a header defined by `xsrfHeaderName`</span><br><span class="line"> * @property &#123;string&#125; [xsrfHeaderName] The name of a header to use for passing XSRF cookies</span><br><span class="line"> * @property &#123;(status: number) =&gt; boolean&#125; [validateStatus] Override status code handling (default: 200-399 is a success)</span><br><span class="line"> * @property &#123;Array&lt;(body: any, headers?: RequestHeaders) =&gt; any?&gt;&#125; [transformRequest] An array of transformations to apply to the outgoing request</span><br><span class="line"> * @property &#123;string&#125; [baseURL] a base URL from which to resolve all URLs</span><br><span class="line"> * @property &#123;typeof window.fetch&#125; [fetch] Custom window.fetch implementation</span><br><span class="line"> * @property &#123;any&#125; [data]</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @public</span><br><span class="line"> * @typedef RequestHeaders</span><br><span class="line"> * @type &#123;&#123;[name: string]: string&#125; | Headers&#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @public</span><br><span class="line"> * @template T</span><br><span class="line"> * @typedef Response</span><br><span class="line"> * @property &#123;number&#125; status</span><br><span class="line"> * @property &#123;string&#125; statusText</span><br><span class="line"> * @property &#123;Options&#125; config the request configuration</span><br><span class="line"> * @property &#123;T&#125; data the decoded response body</span><br><span class="line"> * @property &#123;Headers&#125; headers</span><br><span class="line"> * @property &#123;boolean&#125; redirect</span><br><span class="line"> * @property &#123;string&#125; url</span><br><span class="line"> * @property &#123;ResponseType&#125; type</span><br><span class="line"> * @property &#123;ReadableStream&lt;Uint8Array&gt; | null&#125; body</span><br><span class="line"> * @property &#123;boolean&#125; bodyUsed</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @typedef BodylessMethod</span><br><span class="line"> * @type &#123;&lt;T=any&gt;(url: string, config?: Options) =&gt; Promise&lt;Response&lt;T&gt;&gt;&#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @typedef BodyMethod</span><br><span class="line"> * @type &#123;&lt;T=any&gt;(url: string, body?: any, config?: Options) =&gt; Promise&lt;Response&lt;T&gt;&gt;&#125;</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @public</span><br><span class="line"> * @param &#123;Options&#125; [defaults = &#123;&#125;]</span><br><span class="line"> * @returns &#123;redaxios&#125;</span><br><span class="line"> */</span><br><span class="line">function create(defaults) &#123;</span><br><span class="line">  defaults = defaults || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @public</span><br><span class="line">   * @template T</span><br><span class="line">   * @type &#123;(&lt;T = any&gt;(config?: Options) =&gt; Promise&lt;Response&lt;T&gt;&gt;) | (&lt;T = any&gt;(url: string, config?: Options) =&gt; Promise&lt;Response&lt;T&gt;&gt;)&#125;</span><br><span class="line">   */</span><br><span class="line">  redaxios.request = redaxios;</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodylessMethod&#125; */</span><br><span class="line">  redaxios.get = (url, config) =&gt; redaxios(url, config, &#x27;get&#x27;);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodylessMethod&#125; */</span><br><span class="line">  redaxios.delete = (url, config) =&gt; redaxios(url, config, &#x27;delete&#x27;);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodylessMethod&#125; */</span><br><span class="line">  redaxios.head = (url, config) =&gt; redaxios(url, config, &#x27;head&#x27;);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodylessMethod&#125; */</span><br><span class="line">  redaxios.options = (url, config) =&gt; redaxios(url, config, &#x27;options&#x27;);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodyMethod&#125; */</span><br><span class="line">  redaxios.post = (url, data, config) =&gt; redaxios(url, config, &#x27;post&#x27;, data);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodyMethod&#125; */</span><br><span class="line">  redaxios.put = (url, data, config) =&gt; redaxios(url, config, &#x27;put&#x27;, data);</span><br><span class="line"></span><br><span class="line">  /** @public @type &#123;BodyMethod&#125; */</span><br><span class="line">  redaxios.patch = (url, data, config) =&gt; redaxios(url, config, &#x27;patch&#x27;, data);</span><br><span class="line"></span><br><span class="line">  /** @public */</span><br><span class="line">  redaxios.all = Promise.all.bind(Promise);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @public</span><br><span class="line">   * @template Args, R</span><br><span class="line">   * @param &#123;(...args: Args[]) =&gt; R&#125; fn</span><br><span class="line">   * @returns &#123;(array: Args[]) =&gt; R&#125;</span><br><span class="line">   */</span><br><span class="line">  redaxios.spread = (fn) =&gt; /** @type &#123;any&#125; */ (fn.apply.bind(fn, fn));</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @private</span><br><span class="line">   * @template T, U</span><br><span class="line">   * @param &#123;T&#125; opts</span><br><span class="line">   * @param &#123;U&#125; [overrides]</span><br><span class="line">   * @param &#123;boolean&#125; [lowerCase]</span><br><span class="line">   * @returns &#123;&#123;&#125; &amp; (T | U)&#125;</span><br><span class="line">   */</span><br><span class="line">  function deepMerge(opts, overrides, lowerCase) &#123;</span><br><span class="line">    let out = /** @type &#123;any&#125; */ (&#123;&#125;),</span><br><span class="line">      i;</span><br><span class="line">    if (Array.isArray(opts)) &#123;</span><br><span class="line">      // @ts-ignore</span><br><span class="line">      return opts.concat(overrides);</span><br><span class="line">    &#125;</span><br><span class="line">    for (i in opts) &#123;</span><br><span class="line">      const key = lowerCase ? i.toLowerCase() : i;</span><br><span class="line">      out[key] = opts[i];</span><br><span class="line">    &#125;</span><br><span class="line">    for (i in overrides) &#123;</span><br><span class="line">      const key = lowerCase ? i.toLowerCase() : i;</span><br><span class="line">      const value = /** @type &#123;any&#125; */ (overrides)[i];</span><br><span class="line">      out[key] = key in out &amp;&amp; typeof value == &#x27;object&#x27; ? deepMerge(out[key], value, key == &#x27;headers&#x27;) : value;</span><br><span class="line">    &#125;</span><br><span class="line">    return out;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Issues a request.</span><br><span class="line">   * @public</span><br><span class="line">   * @template T</span><br><span class="line">   * @param &#123;string | Options&#125; urlOrConfig</span><br><span class="line">   * @param &#123;Options&#125; [config = &#123;&#125;]</span><br><span class="line">   * @param &#123;any&#125; [_method] (internal)</span><br><span class="line">   * @param &#123;any&#125; [data] (internal)</span><br><span class="line">   * @param &#123;never&#125; [_undefined] (internal)</span><br><span class="line">   * @returns &#123;Promise&lt;Response&lt;T&gt;&gt;&#125;</span><br><span class="line">   */</span><br><span class="line">  function redaxios(urlOrConfig, config, _method, data, _undefined) &#123;</span><br><span class="line">    let url = /** @type &#123;string&#125; */ (typeof urlOrConfig != &#x27;string&#x27; ? (config = urlOrConfig).url : urlOrConfig);</span><br><span class="line"></span><br><span class="line">    const response = /** @type &#123;Response&lt;any&gt;&#125; */ (&#123; config &#125;);</span><br><span class="line"></span><br><span class="line">    /** @type &#123;Options&#125; */</span><br><span class="line">    const options = deepMerge(defaults, config);</span><br><span class="line"></span><br><span class="line">    /** @type &#123;RequestHeaders&#125; */</span><br><span class="line">    const customHeaders = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    data = data || options.data;</span><br><span class="line"></span><br><span class="line">    (options.transformRequest || []).map((f) =&gt; &#123;</span><br><span class="line">      data = f(data, options.headers) || data;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if (options.auth) &#123;</span><br><span class="line">      customHeaders.authorization = options.auth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (data &amp;&amp; typeof data === &#x27;object&#x27; &amp;&amp; typeof data.append !== &#x27;function&#x27; &amp;&amp; typeof data.text !== &#x27;function&#x27;) &#123;</span><br><span class="line">      data = JSON.stringify(data);</span><br><span class="line">      customHeaders[&#x27;content-type&#x27;] = &#x27;application/json&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      // @ts-ignore providing the cookie name without header name is nonsensical anyway</span><br><span class="line">      customHeaders[options.xsrfHeaderName] = decodeURIComponent(</span><br><span class="line">        // @ts-ignore accessing match()[2] throws for no match, which is intentional</span><br><span class="line">        document.cookie.match(RegExp(&#x27;(^|; )&#x27; + options.xsrfCookieName + &#x27;=([^;]*)&#x27;))[2]</span><br><span class="line">      );</span><br><span class="line">    &#125; catch (e) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    if (options.baseURL) &#123;</span><br><span class="line">      url = url.replace(/^(?!.*\/\/)\/?/, options.baseURL + &#x27;/&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (options.params) &#123;</span><br><span class="line">      url +=</span><br><span class="line">        (~url.indexOf(&#x27;?&#x27;) ? &#x27;&amp;&#x27; : &#x27;?&#x27;) +</span><br><span class="line">        (options.paramsSerializer ? options.paramsSerializer(options.params) : new URLSearchParams(options.params));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const fetchFunc = options.fetch || fetch;</span><br><span class="line"></span><br><span class="line">    return fetchFunc(url, &#123;</span><br><span class="line">      method: (_method || options.method || &#x27;get&#x27;).toUpperCase(),</span><br><span class="line">      body: data,</span><br><span class="line">      headers: deepMerge(options.headers, customHeaders, true),</span><br><span class="line">      credentials: options.withCredentials ? &#x27;include&#x27; : _undefined</span><br><span class="line">    &#125;).then((res) =&gt; &#123;</span><br><span class="line">      for (const i in res) &#123;</span><br><span class="line">        if (typeof res[i] != &#x27;function&#x27;) response[i] = res[i];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (options.responseType == &#x27;stream&#x27;) &#123;</span><br><span class="line">        response.data = res.body;</span><br><span class="line">        return response;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      /*</span><br><span class="line"></span><br><span class="line">      return res[options.responseType || &#x27;text&#x27;]()</span><br><span class="line">        .then((data) =&gt; &#123;</span><br><span class="line">          response.data = data;</span><br><span class="line">          // its okay if this fails: response.data will be the unparsed value:</span><br><span class="line">          response.data = JSON.parse(data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(Object)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          const ok = options.validateStatus ? options.validateStatus(res.status) : res.ok;</span><br><span class="line">          return ok ? response : Promise.reject(response);</span><br><span class="line">        &#125;);</span><br><span class="line">        */</span><br><span class="line">      </span><br><span class="line">      const fn = res[options.responseType || &#x27;text&#x27;];</span><br><span class="line">      const data = fn();</span><br><span class="line">      response.data = data;</span><br><span class="line">      return response;</span><br><span class="line">      </span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @public</span><br><span class="line">   * @type &#123;AbortController&#125;</span><br><span class="line">   */</span><br><span class="line">  redaxios.CancelToken = /** @type &#123;any&#125; */ (typeof AbortController == &#x27;function&#x27; ? AbortController : Object);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @public</span><br><span class="line">   * @type &#123;Options&#125;</span><br><span class="line">   */</span><br><span class="line">  redaxios.defaults = defaults;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @public</span><br><span class="line">   */</span><br><span class="line">  redaxios.create = create;</span><br><span class="line"></span><br><span class="line">  return redaxios;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default create();</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="/../images/quickjs_02.png"></p>
<p>quickjs 中使用 lodash<br>安装 lodash 命令行工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm i -g lodash-cli</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>clone lodash 仓库<br>执行以下命令输出 es6 modules 文件列表到 out 目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lodash modularize exports=es -o ./out</span><br></pre></td></tr></table></figure>

<p>演示代码（备注：其中 debounce 仓库用到了 setTimeout 方法，quickjs 中  ）</p>
<p>需要在打包好的debounce.js 中引入 setTimeout 方法才可以正常使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123;setTimeout&#125; from &quot;os&quot;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import throttle from &#x27;./lodash/throttle.js&#x27;;</span><br><span class="line">import debounce from &#x27;./lodash/debounce.js&#x27;;</span><br><span class="line"></span><br><span class="line">// 使用导入的函数</span><br><span class="line">const myDebounceFunction = debounce(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;This function has been debounced!&#x27;);</span><br><span class="line">&#125;, 1000);</span><br><span class="line"></span><br><span class="line">myDebounceFunction();</span><br><span class="line"></span><br><span class="line">const myThrottleFunction = throttle(() =&gt; &#123;</span><br><span class="line">  console.log(&#x27;This function has been throttled!&#x27;);</span><br><span class="line">&#125;, 1000);</span><br><span class="line"></span><br><span class="line">myThrottleFunction();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>继续学习官方的demo</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wunaozai/p/17850789.html">https://www.cnblogs.com/wunaozai/p/17850789.html</a><br><a target="_blank" rel="noopener" href="https://github.com/OpenQuickJS/quickjs-android">https://github.com/OpenQuickJS/quickjs-android</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=uzLy9DfujfM">https://www.youtube.com/watch?v=uzLy9DfujfM</a><br><a target="_blank" rel="noopener" href="https://github.com/bojie-liu/react-native-quickjs">https://github.com/bojie-liu/react-native-quickjs</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@bojieliu711/easily-use-quickjs-in-react-native-c7e650705ebf">https://medium.com/@bojieliu711/easily-use-quickjs-in-react-native-c7e650705ebf</a><br><a target="_blank" rel="noopener" href="https://github.com/taoweiji/miniprogram-double-thread-demo">https://github.com/taoweiji/miniprogram-double-thread-demo</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/2023/09/TPAC/ac-lt-wasm-perf">https://www.w3.org/2023/09/TPAC/ac-lt-wasm-perf</a></p>
<h1 id="quickjs-如何操作-mysql"><a href="#quickjs-如何操作-mysql" class="headerlink" title="quickjs 如何操作 mysql"></a>quickjs 如何操作 mysql</h1><p>安装依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-get install libmysqlclient-dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>mysql_module.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../quickjs.h&quot;</span><br><span class="line">#include &lt;mysql/mysql.h&gt;</span><br><span class="line"></span><br><span class="line">#define countof(x) (sizeof(x) / sizeof((x)[0]))</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  MYSQL *conn;</span><br><span class="line">  int is_closed;  // 新增字段，用于标记连接是否已关闭</span><br><span class="line">&#125; MySQLClient;</span><br><span class="line"></span><br><span class="line">static JSClassID js_mysql_client_class_id;</span><br><span class="line"></span><br><span class="line">static void js_mysql_client_finalizer(JSRuntime *rt, JSValue val)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque(val, js_mysql_client_class_id);</span><br><span class="line">  if (client &amp;&amp; client-&gt;conn &amp;&amp; !client-&gt;is_closed)</span><br><span class="line">  &#123;</span><br><span class="line">    mysql_close(client-&gt;conn);</span><br><span class="line">    js_free_rt(rt, client);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_mysql_client_ctor(JSContext *ctx,</span><br><span class="line">                                    JSValueConst new_target,</span><br><span class="line">                                    int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client;</span><br><span class="line">  JSValue obj = JS_UNDEFINED;</span><br><span class="line">  JSValue proto;</span><br><span class="line">  const char *host = &quot;127.0.0.1&quot;;</span><br><span class="line">  const char *user = &quot;root&quot;;</span><br><span class="line">  const char *password = &quot;&quot;;</span><br><span class="line">  const char *database = &quot;&quot;;</span><br><span class="line">  unsigned int port = 3306;</span><br><span class="line"></span><br><span class="line">  client = js_mallocz(ctx, sizeof(*client));</span><br><span class="line">  if (!client)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  if (argc &gt; 0 &amp;&amp; JS_IsString(argv[0]))</span><br><span class="line">  &#123;</span><br><span class="line">    host = JS_ToCString(ctx, argv[0]);</span><br><span class="line">  &#125;</span><br><span class="line">  if (argc &gt; 1 &amp;&amp; JS_IsString(argv[1]))</span><br><span class="line">  &#123;</span><br><span class="line">    user = JS_ToCString(ctx, argv[1]);</span><br><span class="line">  &#125;</span><br><span class="line">  if (argc &gt; 2 &amp;&amp; JS_IsString(argv[2]))</span><br><span class="line">  &#123;</span><br><span class="line">    password = JS_ToCString(ctx, argv[2]);</span><br><span class="line">  &#125;</span><br><span class="line">  if (argc &gt; 3 &amp;&amp; JS_IsString(argv[3]))</span><br><span class="line">  &#123;</span><br><span class="line">    database = JS_ToCString(ctx, argv[3]);</span><br><span class="line">  &#125;</span><br><span class="line">  if (argc &gt; 4 &amp;&amp; JS_IsNumber(argv[4]))</span><br><span class="line">  &#123;</span><br><span class="line">    JS_ToUint32(ctx, &amp;port, argv[4]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  client-&gt;conn = mysql_init(NULL);</span><br><span class="line">  if (mysql_real_connect(client-&gt;conn, host, user, password, database, port, NULL, 0) == NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;MySQL connection error: %s\n&quot;, mysql_error(client-&gt;conn));</span><br><span class="line">    mysql_close(client-&gt;conn);</span><br><span class="line">    js_free(ctx, client);</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  proto = JS_GetPropertyStr(ctx, new_target, &quot;prototype&quot;);</span><br><span class="line">  if (JS_IsException(proto))</span><br><span class="line">    goto fail;</span><br><span class="line">  obj = JS_NewObjectProtoClass(ctx, proto, js_mysql_client_class_id);</span><br><span class="line">  JS_FreeValue(ctx, proto);</span><br><span class="line">  if (JS_IsException(obj))</span><br><span class="line">    goto fail;</span><br><span class="line">  JS_SetOpaque(obj, client);</span><br><span class="line">  return obj;</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">  js_free(ctx, client);</span><br><span class="line">  JS_FreeValue(ctx, obj);</span><br><span class="line">  return JS_EXCEPTION;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_mysql_query(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                              int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque2(ctx, this_val, js_mysql_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;conn || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *query;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  query = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  if (mysql_query(client-&gt;conn, query))</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;MySQL query error: %s\n&quot;, mysql_error(client-&gt;conn));</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MYSQL_RES *result = mysql_store_result(client-&gt;conn);</span><br><span class="line">  if (result)</span><br><span class="line">  &#123;</span><br><span class="line">    MYSQL_ROW row;</span><br><span class="line">    JSValue result_array = JS_NewArray(ctx);</span><br><span class="line"></span><br><span class="line">    int row_index = 0;</span><br><span class="line">    while ((row = mysql_fetch_row(result)))</span><br><span class="line">    &#123;</span><br><span class="line">      JSValue row_obj = JS_NewObject(ctx);</span><br><span class="line">      for (int i = 0; i &lt; mysql_num_fields(result); i++)</span><br><span class="line">      &#123;</span><br><span class="line">        const char *field_name = mysql_fetch_field_direct(result, i)-&gt;name;</span><br><span class="line">        JS_SetPropertyStr(ctx, row_obj, field_name, JS_NewString(ctx, row[i]));</span><br><span class="line">      &#125;</span><br><span class="line">      JS_SetPropertyUint32(ctx, result_array, row_index++, row_obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysql_free_result(result);</span><br><span class="line">    return result_array;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return JS_UNDEFINED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_mysql_insert(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                               int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque2(ctx, this_val, js_mysql_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;conn || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *query;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  query = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  if (mysql_query(client-&gt;conn, query))</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;MySQL insert error: %s\n&quot;, mysql_error(client-&gt;conn));</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return JS_NewInt32(ctx, mysql_insert_id(client-&gt;conn));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_mysql_update(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                               int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque2(ctx, this_val, js_mysql_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;conn || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *query;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  query = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  if (mysql_query(client-&gt;conn, query))</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;MySQL update error: %s\n&quot;, mysql_error(client-&gt;conn));</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return JS_NewInt32(ctx, mysql_affected_rows(client-&gt;conn));</span><br><span class="line">&#125;</span><br><span class="line">static JSValue js_mysql_delete(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                               int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque2(ctx, this_val, js_mysql_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;conn || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *query;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  query = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  if (mysql_query(client-&gt;conn, query))</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;MySQL delete error: %s\n&quot;, mysql_error(client-&gt;conn));</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return JS_NewInt32(ctx, mysql_affected_rows(client-&gt;conn));</span><br><span class="line">&#125;</span><br><span class="line">static JSValue js_mysql_close(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                              int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  MySQLClient *client = JS_GetOpaque2(ctx, this_val, js_mysql_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;conn || client-&gt;is_closed)</span><br><span class="line">    return JS_UNDEFINED;</span><br><span class="line"></span><br><span class="line">  mysql_close(client-&gt;conn);</span><br><span class="line">  client-&gt;conn = NULL;</span><br><span class="line">  client-&gt;is_closed = 1;</span><br><span class="line"></span><br><span class="line">  return JS_UNDEFINED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSClassDef js_mysql_client_class = &#123;</span><br><span class="line">    &quot;MySQLClient&quot;,</span><br><span class="line">    .finalizer = js_mysql_client_finalizer,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static const JSCFunctionListEntry js_mysql_client_proto_funcs[] = &#123;</span><br><span class="line">    JS_CFUNC_DEF(&quot;query&quot;, 1, js_mysql_query),</span><br><span class="line">    JS_CFUNC_DEF(&quot;insert&quot;, 1, js_mysql_insert),</span><br><span class="line">    JS_CFUNC_DEF(&quot;update&quot;, 1, js_mysql_update),</span><br><span class="line">    JS_CFUNC_DEF(&quot;delete&quot;, 1, js_mysql_delete),  // 新增这一行</span><br><span class="line">    JS_CFUNC_DEF(&quot;close&quot;, 0, js_mysql_close),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static int js_mysql_client_init(JSContext *ctx, JSModuleDef *m)</span><br><span class="line">&#123;</span><br><span class="line">  JSValue mysql_proto, mysql_class;</span><br><span class="line"></span><br><span class="line">  JS_NewClassID(&amp;js_mysql_client_class_id);</span><br><span class="line">  JS_NewClass(JS_GetRuntime(ctx), js_mysql_client_class_id, &amp;js_mysql_client_class);</span><br><span class="line"></span><br><span class="line">  mysql_proto = JS_NewObject(ctx);</span><br><span class="line">  JS_SetPropertyFunctionList(ctx, mysql_proto, js_mysql_client_proto_funcs, countof(js_mysql_client_proto_funcs));</span><br><span class="line"></span><br><span class="line">  mysql_class = JS_NewCFunction2(ctx, js_mysql_client_ctor, &quot;MySQLClient&quot;, 5, JS_CFUNC_constructor, 0);</span><br><span class="line">  JS_SetConstructor(ctx, mysql_class, mysql_proto);</span><br><span class="line">  JS_SetClassProto(ctx, js_mysql_client_class_id, mysql_proto);</span><br><span class="line"></span><br><span class="line">  JS_SetModuleExport(ctx, m, &quot;MySQLClient&quot;, mysql_class);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSModuleDef *js_init_module(JSContext *ctx, const char *module_name)</span><br><span class="line">&#123;</span><br><span class="line">  JSModuleDef *m;</span><br><span class="line">  m = JS_NewCModule(ctx, module_name, js_mysql_client_init);</span><br><span class="line">  if (!m)</span><br><span class="line">    return NULL;</span><br><span class="line">  JS_AddModuleExport(ctx, m, &quot;MySQLClient&quot;);</span><br><span class="line">  return m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">gcc -shared -o libmysql_module.so -fPIC examples/mysql_module.c -L/home/dc/wzw/study/quickjs_yoga/quickjs -lmysqlclient -lquickjs</span><br><span class="line">mv libmysql_module.so ./examples/</span><br><span class="line">./qjs examples/test_mysql.js</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>test_mysql.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import * as mysql from &#x27;./libmysql_module.so&#x27;;</span><br><span class="line"></span><br><span class="line">const client = new mysql.MySQLClient(&#x27;127.0.0.1&#x27;, &#x27;admin&#x27;, &#x27;Jason@#123&#x27;, &#x27;big_event&#x27;);</span><br><span class="line"></span><br><span class="line">// // 查询数据</span><br><span class="line">// const result = client.query(&#x27;SELECT * FROM user&#x27;);</span><br><span class="line">// console.log(JSON.stringify(result));</span><br><span class="line"></span><br><span class="line">// // 插入数据</span><br><span class="line">// const insertId = client.insert(&#x27;INSERT INTO user (username, password, create_time, update_time) VALUES (&quot;aAlice111&quot;, &quot;aaaa&quot;, &quot;2024-08-22 09:31:58&quot;, &quot;2024-08-22 09:31:58&quot;)&#x27;);</span><br><span class="line">// console.log(insertId);</span><br><span class="line"></span><br><span class="line">// // 更新数据</span><br><span class="line">// const affectedRows = client.update(&#x27;UPDATE user SET username = &quot;Bo1b&quot; WHERE id = 1&#x27;);</span><br><span class="line">// console.log(affectedRows);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//删除数据</span><br><span class="line">const daffectedRows = client.delete(&quot;DELETE FROM user WHERE id = 1&quot;)</span><br><span class="line">console.log(daffectedRows);</span><br><span class="line"></span><br><span class="line">// 关闭连接</span><br><span class="line">client.close();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ldd examples&#x2F;libmysql_module.so</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">ldd examples/libmysql_module.so</span><br><span class="line">        linux-vdso.so.1 (0x00007fff1318a000)</span><br><span class="line">        libmysqlclient.so.21 =&gt; /lib/x86_64-linux-gnu/libmysqlclient.so.21 (0x00007f0203bf7000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f0203a05000)</span><br><span class="line">        libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f02039ff000)</span><br><span class="line">        libssl.so.1.1 =&gt; /lib/x86_64-linux-gnu/libssl.so.1.1 (0x00007f020396c000)</span><br><span class="line">        libcrypto.so.1.1 =&gt; /lib/x86_64-linux-gnu/libcrypto.so.1.1 (0x00007f0203695000)</span><br><span class="line">        libresolv.so.2 =&gt; /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f0203677000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f0203654000)</span><br><span class="line">        libstdc++.so.6 =&gt; /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f0203472000)</span><br><span class="line">        libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f0203457000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f020441a000)</span><br><span class="line">        libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f0203308000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ldd 命令用于显示动态链接库的依赖关系。它可以帮助你了解某个可执行文件或共享库依赖于哪些其他共享库，并显示这些库的具体路径。以下是 ldd 命令的主要功能和用法：</span><br><span class="line">显示依赖库：</span><br><span class="line">列出目标文件（可执行文件或共享库）所依赖的所有共享库及其路径。</span><br><span class="line">检查库文件完整性：</span><br><span class="line">确认所有依赖的库文件是否存在，并且路径正确。</span><br><span class="line">调试链接问题：</span><br><span class="line">帮助诊断由于缺少依赖库或路径错误导致的程序启动失败或运行时错误。</span><br><span class="line">用法</span><br><span class="line">ldd [选项] 文件</span><br><span class="line">常用选项</span><br><span class="line">-v 或 --verbose：显示详细信息，包括版本信息和符号解析。</span><br><span class="line">-u 或 --unused：显示未使用的直接依赖库。</span><br><span class="line">-d 或 --data-relocs：处理数据重定位。</span><br><span class="line">-r 或 --function-relocs：处理数据和函数重定位。</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="quickjs-如何操作-redis"><a href="#quickjs-如何操作-redis" class="headerlink" title="quickjs 如何操作 redis"></a>quickjs 如何操作 redis</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libmysqlclient-dev</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>redis_module.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../quickjs.h&quot;</span><br><span class="line">#include &lt;hiredis/hiredis.h&gt;</span><br><span class="line"></span><br><span class="line">#define countof(x) (sizeof(x) / sizeof((x)[0]))</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  redisContext *context;</span><br><span class="line">  int is_closed;  // 新增字段，用于标记连接是否已关闭</span><br><span class="line">&#125; RedisClient;</span><br><span class="line"></span><br><span class="line">static JSClassID js_redis_client_class_id;</span><br><span class="line"></span><br><span class="line">static void js_redis_client_finalizer(JSRuntime *rt, JSValue val)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client = JS_GetOpaque(val, js_redis_client_class_id);</span><br><span class="line">  if (client &amp;&amp; client-&gt;context &amp;&amp; !client-&gt;is_closed)</span><br><span class="line">  &#123;</span><br><span class="line">    redisFree(client-&gt;context);</span><br><span class="line">    js_free_rt(rt, client);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_redis_client_ctor(JSContext *ctx,</span><br><span class="line">                                    JSValueConst new_target,</span><br><span class="line">                                    int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client;</span><br><span class="line">  JSValue obj = JS_UNDEFINED;</span><br><span class="line">  JSValue proto;</span><br><span class="line">  const char *host = &quot;127.0.0.1&quot;;</span><br><span class="line">  int port = 6379;</span><br><span class="line"></span><br><span class="line">  client = js_mallocz(ctx, sizeof(*client));</span><br><span class="line">  if (!client)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  if (argc &gt; 0 &amp;&amp; JS_IsString(argv[0]))</span><br><span class="line">  &#123;</span><br><span class="line">    host = JS_ToCString(ctx, argv[0]);</span><br><span class="line">  &#125;</span><br><span class="line">  if (argc &gt; 1 &amp;&amp; JS_IsNumber(argv[1]))</span><br><span class="line">  &#123;</span><br><span class="line">    JS_ToInt32(ctx, &amp;port, argv[1]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  client-&gt;context = redisConnect(host, port);</span><br><span class="line">  if (client-&gt;context == NULL || client-&gt;context-&gt;err)</span><br><span class="line">  &#123;</span><br><span class="line">    if (client-&gt;context)</span><br><span class="line">    &#123;</span><br><span class="line">      fprintf(stderr, &quot;Connection error: %s\n&quot;, client-&gt;context-&gt;errstr);</span><br><span class="line">      redisFree(client-&gt;context);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      fprintf(stderr, &quot;Connection error: can&#x27;t allocate redis context\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    js_free(ctx, client);</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  proto = JS_GetPropertyStr(ctx, new_target, &quot;prototype&quot;);</span><br><span class="line">  if (JS_IsException(proto))</span><br><span class="line">    goto fail;</span><br><span class="line">  obj = JS_NewObjectProtoClass(ctx, proto, js_redis_client_class_id);</span><br><span class="line">  JS_FreeValue(ctx, proto);</span><br><span class="line">  if (JS_IsException(obj))</span><br><span class="line">    goto fail;</span><br><span class="line">  JS_SetOpaque(obj, client);</span><br><span class="line">  return obj;</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">  js_free(ctx, client);</span><br><span class="line">  JS_FreeValue(ctx, obj);</span><br><span class="line">  return JS_EXCEPTION;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_redis_set(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                            int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client = JS_GetOpaque2(ctx, this_val, js_redis_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;context || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *key, *value;</span><br><span class="line">  int expire = 0;  // 默认不过期</span><br><span class="line"></span><br><span class="line">  if (argc &lt; 2 || !JS_IsString(argv[0]) || !JS_IsString(argv[1]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  if (argc &gt; 2 &amp;&amp; JS_IsNumber(argv[2]))</span><br><span class="line">  &#123;</span><br><span class="line">    JS_ToInt32(ctx, &amp;expire, argv[2]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  key = JS_ToCString(ctx, argv[0]);</span><br><span class="line">  value = JS_ToCString(ctx, argv[1]);</span><br><span class="line"></span><br><span class="line">  redisReply *reply;</span><br><span class="line">  if (expire &gt; 0)</span><br><span class="line">  &#123;</span><br><span class="line">    reply = (redisReply *)redisCommand(client-&gt;context, &quot;SET %s %s EX %d&quot;, key, value, expire);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    reply = (redisReply *)redisCommand(client-&gt;context, &quot;SET %s %s&quot;, key, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (reply == NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;Error setting key: %s\n&quot;, client-&gt;context-&gt;errstr);</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  freeReplyObject(reply);</span><br><span class="line">  return JS_UNDEFINED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_redis_get(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                            int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client = JS_GetOpaque2(ctx, this_val, js_redis_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;context || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *key;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  key = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  redisReply *reply = (redisReply *)redisCommand(client-&gt;context, &quot;GET %s&quot;, key);</span><br><span class="line">  if (reply == NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;Error getting key: %s\n&quot;, client-&gt;context-&gt;errstr);</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  JSValue result = JS_UNDEFINED;</span><br><span class="line">  if (reply-&gt;type == REDIS_REPLY_STRING)</span><br><span class="line">  &#123;</span><br><span class="line">    result = JS_NewString(ctx, reply-&gt;str);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  freeReplyObject(reply);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_redis_del(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                            int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client = JS_GetOpaque2(ctx, this_val, js_redis_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;context || client-&gt;is_closed)</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  const char *key;</span><br><span class="line">  if (argc &lt; 1 || !JS_IsString(argv[0]))</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line"></span><br><span class="line">  key = JS_ToCString(ctx, argv[0]);</span><br><span class="line"></span><br><span class="line">  redisReply *reply = (redisReply *)redisCommand(client-&gt;context, &quot;DEL %s&quot;, key);</span><br><span class="line">  if (reply == NULL)</span><br><span class="line">  &#123;</span><br><span class="line">    fprintf(stderr, &quot;Error deleting key: %s\n&quot;, client-&gt;context-&gt;errstr);</span><br><span class="line">    return JS_EXCEPTION;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  freeReplyObject(reply);</span><br><span class="line">  return JS_UNDEFINED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSValue js_redis_close(JSContext *ctx, JSValueConst this_val,</span><br><span class="line">                              int argc, JSValueConst *argv)</span><br><span class="line">&#123;</span><br><span class="line">  RedisClient *client = JS_GetOpaque2(ctx, this_val, js_redis_client_class_id);</span><br><span class="line">  if (!client || !client-&gt;context || client-&gt;is_closed)</span><br><span class="line">    return JS_UNDEFINED;</span><br><span class="line"></span><br><span class="line">  redisFree(client-&gt;context);</span><br><span class="line">  client-&gt;context = NULL;</span><br><span class="line">  client-&gt;is_closed = 1;</span><br><span class="line"></span><br><span class="line">  return JS_UNDEFINED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static JSClassDef js_redis_client_class = &#123;</span><br><span class="line">    &quot;RedisClient&quot;,</span><br><span class="line">    .finalizer = js_redis_client_finalizer,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static const JSCFunctionListEntry js_redis_client_proto_funcs[] = &#123;</span><br><span class="line">    JS_CFUNC_DEF(&quot;set&quot;, 3, js_redis_set),</span><br><span class="line">    JS_CFUNC_DEF(&quot;get&quot;, 1, js_redis_get),</span><br><span class="line">    JS_CFUNC_DEF(&quot;del&quot;, 1, js_redis_del),</span><br><span class="line">    JS_CFUNC_DEF(&quot;close&quot;, 0, js_redis_close),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static int js_redis_client_init(JSContext *ctx, JSModuleDef *m)</span><br><span class="line">&#123;</span><br><span class="line">  JSValue redis_proto, redis_class;</span><br><span class="line"></span><br><span class="line">  JS_NewClassID(&amp;js_redis_client_class_id);</span><br><span class="line">  JS_NewClass(JS_GetRuntime(ctx), js_redis_client_class_id, &amp;js_redis_client_class);</span><br><span class="line"></span><br><span class="line">  redis_proto = JS_NewObject(ctx);</span><br><span class="line">  JS_SetPropertyFunctionList(ctx, redis_proto, js_redis_client_proto_funcs, countof(js_redis_client_proto_funcs));</span><br><span class="line"></span><br><span class="line">  redis_class = JS_NewCFunction2(ctx, js_redis_client_ctor, &quot;RedisClient&quot;, 2, JS_CFUNC_constructor, 0);</span><br><span class="line">  JS_SetConstructor(ctx, redis_class, redis_proto);</span><br><span class="line">  JS_SetClassProto(ctx, js_redis_client_class_id, redis_proto);</span><br><span class="line"></span><br><span class="line">  JS_SetModuleExport(ctx, m, &quot;RedisClient&quot;, redis_class);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JSModuleDef *js_init_module(JSContext *ctx, const char *module_name)</span><br><span class="line">&#123;</span><br><span class="line">  JSModuleDef *m;</span><br><span class="line">  m = JS_NewCModule(ctx, module_name, js_redis_client_init);</span><br><span class="line">  if (!m)</span><br><span class="line">    return NULL;</span><br><span class="line">  JS_AddModuleExport(ctx, m, &quot;RedisClient&quot;);</span><br><span class="line">  return m;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o libredis_module.so -fPIC examples/redis_module.c -L/home/dc/wzw/study/quickjs_yoga/quickjs -lhiredis -lquickjs</span><br><span class="line">mv libredis_module.so ./examples/</span><br><span class="line">qjs examples/test_redis.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>调用编译好的 so 文件，进行 redis 操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import&#123;RedisClient&#125; from &#x27;./libredis_module.so&#x27;;</span><br><span class="line"></span><br><span class="line">// 创建 Redis 客户端</span><br><span class="line">const redis = new RedisClient(&#x27;127.0.0.1&#x27;, 6379);</span><br><span class="line"></span><br><span class="line">// 设置键值对</span><br><span class="line">redis.set(&#x27;key2&#x27;, &#x27;value22&#x27;)</span><br><span class="line"></span><br><span class="line">// 获取键值对</span><br><span class="line">console.log(redis.get(&#x27;key2&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// import * as redis from &#x27;./libredis_module.so&#x27;;</span><br><span class="line"></span><br><span class="line">// const client = new redis.RedisClient();</span><br><span class="line"></span><br><span class="line">// client.set(&#x27;key&#x27;, &#x27;value&#x27;, 30);  // 设置键值对并指定过期时间为10秒</span><br><span class="line">// const value = client.get(&#x27;key&#x27;);</span><br><span class="line">// console.log(value); // 输出: value</span><br><span class="line"></span><br><span class="line">// client.del(&#x27;key&#x27;);  // 删除键</span><br><span class="line"></span><br><span class="line">// const deletedValue = client.get(&#x27;key&#x27;);</span><br><span class="line">// console.log(deletedValue); // 输出: undefined</span><br><span class="line"></span><br><span class="line">// client.close();  // 关闭连接</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="quickjs-yoga结合使用"><a href="#quickjs-yoga结合使用" class="headerlink" title="quickjs+yoga结合使用"></a>quickjs+yoga结合使用</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">QuickJS + Yoga 结合使用</span><br><span class="line">QuickJS 是一个轻量级的 JavaScript 引擎，由 Mozilla 开发，适用于嵌入式系统和高性能应用。Yoga 是 Facebook 开发的一个跨平台布局引擎，基于 Flexbox 布局算法。结合 QuickJS 和 Yoga，可以在 JavaScript 中实现高效的布局管理，特别适合用于构建跨平台的应用程序。</span><br><span class="line"></span><br><span class="line">以下是一个简单的示例，展示如何在 QuickJS 中使用 Yoga 进行布局计算。</span><br><span class="line"></span><br><span class="line">1. 安装依赖</span><br><span class="line">首先，确保你已经安装了 QuickJS 和 Yoga。你可以从各自的 GitHub 仓库获取源代码并编译安装。</span><br><span class="line"></span><br><span class="line">QuickJS: https://github.com/bellard/quickjs</span><br><span class="line">Yoga: https://github.com/facebook/yoga</span><br><span class="line">2. 编写 C 代码</span><br><span class="line">创建一个 C 文件（例如 main.c），用于初始化 QuickJS 和 Yoga，并提供 JavaScript 接口。</span><br><span class="line"></span><br><span class="line">c</span><br><span class="line">#include &quot;quickjs.h&quot;</span><br><span class="line">#include &quot;yoga/YGNode.h&quot;</span><br><span class="line"></span><br><span class="line">// 初始化 Yoga 节点</span><br><span class="line">YGNodeRef createYogaNode() &#123;</span><br><span class="line">    YGNodeRef node = YGNodeNew();</span><br><span class="line">    return node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 设置 Yoga 节点的宽度</span><br><span class="line">void setWidth(YGNodeRef node, float width) &#123;</span><br><span class="line">    YGNodeStyleSetWidth(node, width);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 设置 Yoga 节点的高度</span><br><span class="line">void setHeight(YGNodeRef node, float height) &#123;</span><br><span class="line">    YGNodeStyleSetHeight(node, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 设置 Yoga 节点的 Flex 方向</span><br><span class="line">void setFlexDirection(YGNodeRef node, const char* direction) &#123;</span><br><span class="line">    YGFlexDirection dir = YGFlexDirectionColumn;</span><br><span class="line">    if (strcmp(direction, &quot;row&quot;) == 0) &#123;</span><br><span class="line">        dir = YGFlexDirectionRow;</span><br><span class="line">    &#125; else if (strcmp(direction, &quot;column-reverse&quot;) == 0) &#123;</span><br><span class="line">        dir = YGFlexDirectionColumnReverse;</span><br><span class="line">    &#125; else if (strcmp(direction, &quot;row-reverse&quot;) == 0) &#123;</span><br><span class="line">        dir = YGFlexDirectionRowReverse;</span><br><span class="line">    &#125;</span><br><span class="line">    YGNodeStyleSetFlexDirection(node, dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 计算 Yoga 布局</span><br><span class="line">void calculateLayout(YGNodeRef node, float width, float height) &#123;</span><br><span class="line">    YGNodeCalculateLayout(node, width, height, YGDirectionLTR);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取 Yoga 节点的布局属性</span><br><span class="line">float getLayoutLeft(YGNodeRef node) &#123;</span><br><span class="line">    return YGNodeLayoutGetLeft(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float getLayoutTop(YGNodeRef node) &#123;</span><br><span class="line">    return YGNodeLayoutGetTop(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float getLayoutWidth(YGNodeRef node) &#123;</span><br><span class="line">    return YGNodeLayoutGetWidth(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float getLayoutHeight(YGNodeRef node) &#123;</span><br><span class="line">    return YGNodeLayoutGetHeight(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 注册 JavaScript 函数</span><br><span class="line">void registerJSFunctions(JSContext* ctx) &#123;</span><br><span class="line">    JS_NewGlobalObject(ctx);</span><br><span class="line">    JSValue global_obj = JS_GetGlobalObject(ctx);</span><br><span class="line"></span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;createYogaNode&quot;, JS_NewCFunction(ctx, createYogaNode, &quot;createYogaNode&quot;, 0));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;setWidth&quot;, JS_NewCFunction(ctx, setWidth, &quot;setWidth&quot;, 2));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;setHeight&quot;, JS_NewCFunction(ctx, setHeight, &quot;setHeight&quot;, 2));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;setFlexDirection&quot;, JS_NewCFunction(ctx, setFlexDirection, &quot;setFlexDirection&quot;, 2));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;calculateLayout&quot;, JS_NewCFunction(ctx, calculateLayout, &quot;calculateLayout&quot;, 3));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;getLayoutLeft&quot;, JS_NewCFunction(ctx, getLayoutLeft, &quot;getLayoutLeft&quot;, 1));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;getLayoutTop&quot;, JS_NewCFunction(ctx, getLayoutTop, &quot;getLayoutTop&quot;, 1));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;getLayoutWidth&quot;, JS_NewCFunction(ctx, getLayoutWidth, &quot;getLayoutWidth&quot;, 1));</span><br><span class="line">    JS_SetPropertyStr(ctx, global_obj, &quot;getLayoutHeight&quot;, JS_NewCFunction(ctx, getLayoutHeight, &quot;getLayoutHeight&quot;, 1));</span><br><span class="line"></span><br><span class="line">    JS_FreeValue(ctx, global_obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char** argv) &#123;</span><br><span class="line">    JSRuntime* rt = JS_NewRuntime();</span><br><span class="line">    JSContext* ctx = JS_NewContext(rt);</span><br><span class="line"></span><br><span class="line">    registerJSFunctions(ctx);</span><br><span class="line"></span><br><span class="line">    // 读取并执行 JavaScript 代码</span><br><span class="line">    const char* js_code = R&quot;(</span><br><span class="line">        let root = createYogaNode();</span><br><span class="line">        setWidth(root, 300);</span><br><span class="line">        setHeight(root, 300);</span><br><span class="line">        setFlexDirection(root, &#x27;column&#x27;);</span><br><span class="line"></span><br><span class="line">        let child1 = createYogaNode();</span><br><span class="line">        setWidth(child1, 100);</span><br><span class="line">        setHeight(child1, 100);</span><br><span class="line"></span><br><span class="line">        let child2 = createYogaNode();</span><br><span class="line">        setWidth(child2, 100);</span><br><span class="line">        setHeight(child2, 100);</span><br><span class="line"></span><br><span class="line">        root.appendChild(child1);</span><br><span class="line">        root.appendChild(child2);</span><br><span class="line"></span><br><span class="line">        calculateLayout(root, 300, 300);</span><br><span class="line"></span><br><span class="line">        console.log(`Left: $&#123;getLayoutLeft(root)&#125;, Top: $&#123;getLayoutTop(root)&#125;, Width: $&#123;getLayoutWidth(root)&#125;, Height: $&#123;getLayoutHeight(root)&#125;`);</span><br><span class="line">        console.log(`Child1 Left: $&#123;getLayoutLeft(child1)&#125;, Top: $&#123;getLayoutTop(child1)&#125;, Width: $&#123;getLayoutWidth(child1)&#125;, Height: $&#123;getLayoutHeight(child1)&#125;`);</span><br><span class="line">        console.log(`Child2 Left: $&#123;getLayoutLeft(child2)&#125;, Top: $&#123;getLayoutTop(child2)&#125;, Width: $&#123;getLayoutWidth(child2)&#125;, Height: $&#123;getLayoutHeight(child2)&#125;`);</span><br><span class="line">    )&quot;;</span><br><span class="line"></span><br><span class="line">    JS_Eval(ctx, js_code, strlen(js_code), &quot;&lt;input&gt;&quot;, JS_EVAL_TYPE_GLOBAL);</span><br><span class="line"></span><br><span class="line">    JS_FreeContext(ctx);</span><br><span class="line">    JS_FreeRuntime(rt);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3. 编译和运行</span><br><span class="line">编译上述 C 代码，并链接 QuickJS 和 Yoga 库。假设你已经编译并安装了 QuickJS 和 Yoga，可以使用以下命令进行编译：</span><br><span class="line"></span><br><span class="line">gcc -o quickjs_yoga main.c -I/path/to/quickjs -I/path/to/yoga -L/path/to/quickjs -L/path/to/yoga -lquickjs -lyoga -lm</span><br><span class="line"></span><br><span class="line">运行编译后的程序：</span><br><span class="line">./quickjs_yoga</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解释</span><br><span class="line">初始化 Yoga 节点:</span><br><span class="line"></span><br><span class="line">createYogaNode 函数创建一个新的 Yoga 节点。</span><br><span class="line">setWidth 和 setHeight 函数设置节点的宽度和高度。</span><br><span class="line">setFlexDirection 函数设置节点的 Flex 方向。</span><br><span class="line">计算布局:</span><br><span class="line"></span><br><span class="line">calculateLayout 函数计算节点的布局。</span><br><span class="line">获取布局属性:</span><br><span class="line"></span><br><span class="line">getLayoutLeft、getLayoutTop、getLayoutWidth 和 getLayoutHeight 函数获取节点的布局属性。</span><br><span class="line">注册 JavaScript 函数:</span><br><span class="line"></span><br><span class="line">registerJSFunctions 函数将 C 函数注册为 JavaScript 函数，使它们可以在 JavaScript 中调用。</span><br><span class="line">执行 JavaScript 代码:</span><br><span class="line"></span><br><span class="line">在 main 函数中，读取并执行 JavaScript 代码，创建和配置 Yoga 节点，并计算布局。</span><br><span class="line">运行结果</span><br><span class="line">当你运行上述程序时，JavaScript 代码将创建一个根节点和两个子节点，设置它们的布局属性，并计算布局。最终，程序将输出每个节点的布局属性。</span><br><span class="line"></span><br><span class="line">总结</span><br><span class="line">通过结合 QuickJS 和 Yoga，你可以在 JavaScript 中实现高效的布局管理，特别适合用于构建跨平台的应用程序。这种方式不仅提供了灵活的布局能力，还保持了高性能和低资源消耗。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yoga 编译安装</span><br><span class="line">oga 编译安装指南</span><br><span class="line">Yoga 是 Facebook 开发的一个跨平台的布局引擎，基于 Flexbox 布局算法。它支持多种平台，包括 iOS、Android、Web 和桌面应用。以下是如何在不同平台上编译和安装 Yoga 的详细步骤。</span><br><span class="line">1. 获取 Yoga 源代码</span><br><span class="line">首先，从 GitHub 上克隆 Yoga 仓库：</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install cmake ninja-build</span><br><span class="line"></span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake -G Ninja ..</span><br><span class="line">ninja</span><br><span class="line">编译完成后，你会在 build 目录下找到生成的库文件，例如 libyoga.a 或 libyoga.so。</span><br><span class="line">Windows</span><br><span class="line">使用 Visual Studio 命令行工具（例如 Developer Command Prompt for VS 2019）：</span><br><span class="line">shmkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake -G &quot;Visual Studio 16 2019&quot; -A x64 ..</span><br><span class="line">cmake --build . --config Release</span><br><span class="line">编译完成后，你会在 build\Release 目录下找到生成的库文件，例如 yoga.lib。</span><br><span class="line">4. 安装 Yoga</span><br><span class="line">Linux 和 macOS</span><br><span class="line">将生成的库文件和头文件复制到适当的位置。例如，复制到 /usr/local/lib 和 /usr/local/include：</span><br><span class="line">shsudo cp build/libyoga.a /usr/local/lib/</span><br><span class="line">sudo cp -r ../yoga /usr/local/include/</span><br><span class="line">Windows</span><br><span class="line">将生成的库文件和头文件复制到你的项目目录中。例如，复制到 C:\your_project\lib 和 C:\your_project\include：</span><br><span class="line">shcopy build\Release\yoga.lib C:\your_project\lib\</span><br><span class="line">xcopy ..\yoga C:\your_project\include\yoga /E /I</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5. 验证安装</span><br><span class="line">创建一个简单的 C++ 程序来验证 Yoga 是否安装成功。</span><br><span class="line">示例代码</span><br><span class="line">创建一个 test_yoga.cpp 文件：</span><br><span class="line">cpp#include &lt;iostream&gt;</span><br><span class="line">#include &lt;yoga/YGNode.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    // 创建一个 Yoga 节点</span><br><span class="line">    YGNodeRef root = YGNodeNew();</span><br><span class="line">    YGNodeStyleSetWidth(root, 300);</span><br><span class="line">    YGNodeStyleSetHeight(root, 300);</span><br><span class="line"></span><br><span class="line">    // 计算布局</span><br><span class="line">    YGNodeCalculateLayout(root, YGUndefined, YGUndefined, YGDirectionLTR);</span><br><span class="line"></span><br><span class="line">    // 输出布局信息</span><br><span class="line">    std::cout &lt;&lt; &quot;Root node layout: &quot;</span><br><span class="line">              &lt;&lt; &quot;Left: &quot; &lt;&lt; YGNodeLayoutGetLeft(root) &lt;&lt; &quot;, &quot;</span><br><span class="line">              &lt;&lt; &quot;Top: &quot; &lt;&lt; YGNodeLayoutGetTop(root) &lt;&lt; &quot;, &quot;</span><br><span class="line">              &lt;&lt; &quot;Width: &quot; &lt;&lt; YGNodeLayoutGetWidth(root) &lt;&lt; &quot;, &quot;</span><br><span class="line">              &lt;&lt; &quot;Height: &quot; &lt;&lt; YGNodeLayoutGetHeight(root) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    // 释放节点</span><br><span class="line">    YGNodeFreeRecursive(root);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编译和运行</span><br><span class="line">Linux 和 macOS</span><br><span class="line">shg++ test_yoga.cpp -lyoga -o test_yoga</span><br><span class="line">./test_yoga</span><br><span class="line">Windows</span><br><span class="line">使用 Visual Studio 命令行工具：</span><br><span class="line">shcl /EHsc /I C:\your_project\include test_yoga.cpp /link /LIBPATH:C:\your_project\lib yoga.lib</span><br><span class="line">test_yoga.exe</span><br><span class="line">总结</span><br><span class="line">通过以上步骤，你可以在不同的平台上编译和安装 Yoga，并验证其是否安装成功。Yoga 提供了强大的布局能力，适用于多种应用场景，特别是需要跨平台布局的项目。</span><br><span class="line"></span><br><span class="line">javascript 应该如何调用</span><br><span class="line">在你的代码中，已经将 C/C++ 函数注册到了 QuickJS 的全局对象中，这样你就可以在 JavaScript 中直接调用这些函数。以下是如何在 JavaScript 中调用这些函数的详细步骤和示例：</span><br><span class="line">1. 创建和配置 Yoga 节点</span><br><span class="line">你已经在 main 函数中定义了一段 JavaScript 代码，用于创建和配置 Yoga 节点。以下是这段代码的详细解释：</span><br><span class="line">javascriptlet root = createYogaNode();</span><br><span class="line">setWidth(root, 300);</span><br><span class="line">setHeight(root, 300);</span><br><span class="line">setFlexDirection(root, &#x27;column&#x27;);</span><br><span class="line">createYogaNode()：创建一个新的 Yoga 节点。</span><br><span class="line">setWidth(root, 300)：设置根节点的宽度为 300。</span><br><span class="line">setHeight(root, 300)：设置根节点的高度为 300。</span><br><span class="line">setFlexDirection(root, &#x27;column&#x27;)：设置根节点的 Flex 方向为列方向。</span><br><span class="line">2. 创建子节点并添加到根节点</span><br><span class="line">javascriptlet child1 = createYogaNode();</span><br><span class="line">setWidth(child1, 100);</span><br><span class="line">setHeight(child1, 100);</span><br><span class="line"></span><br><span class="line">let child2 = createYogaNode();</span><br><span class="line">setWidth(child2, 100);</span><br><span class="line">setHeight(child2, 100);</span><br><span class="line"></span><br><span class="line">root.appendChild(child1);</span><br><span class="line">root.appendChild(child2);</span><br><span class="line">createYogaNode()：创建两个子节点 child1 和 child2。</span><br><span class="line">setWidth(child1, 100) 和 setHeight(child1, 100)：设置 child1 的宽度和高度。</span><br><span class="line">setWidth(child2, 100) 和 setHeight(child2, 100)：设置 child2 的宽度和高度。</span><br><span class="line">root.appendChild(child1) 和 root.appendChild(child2)：将子节点添加到根节点中。</span><br><span class="line">3. 计算布局</span><br><span class="line">javascriptcalculateLayout(root, 300, 300);</span><br><span class="line">calculateLayout(root, 300, 300)：计算根节点及其子节点的布局，给定的宽度和高度分别为 300。</span><br><span class="line">4. 获取并输出布局属性</span><br><span class="line">javascriptconsole.log(`Left: $&#123;getLayoutLeft(root)&#125;, Top: $&#123;getLayoutTop(root)&#125;, Width: $&#123;getLayoutWidth(root)&#125;, Height: $&#123;getLayoutHeight(root)&#125;`);</span><br><span class="line">console.log(`Child1 Left: $&#123;getLayoutLeft(child1)&#125;, Top: $&#123;getLayoutTop(child1)&#125;, Width: $&#123;getLayoutWidth(child1)&#125;, Height: $&#123;getLayoutHeight(child1)&#125;`);</span><br><span class="line">console.log(`Child2 Left: $&#123;getLayoutLeft(child2)&#125;, Top: $&#123;getLayoutTop(child2)&#125;, Width: $&#123;getLayoutWidth(child2)&#125;, Height: $&#123;getLayoutHeight(child2)&#125;`);</span><br><span class="line">getLayoutLeft(node)：获取节点的左偏移。</span><br><span class="line">getLayoutTop(node)：获取节点的上偏移。</span><br><span class="line">getLayoutWidth(node)：获取节点的宽度。</span><br><span class="line">getLayoutHeight(node)：获取节点的高度。</span><br><span class="line">console.log()：输出节点的布局属性。</span><br><span class="line">完整的 JavaScript 代码</span><br><span class="line">javascriptlet root = createYogaNode();</span><br><span class="line">setWidth(root, 300);</span><br><span class="line">setHeight(root, 300);</span><br><span class="line">setFlexDirection(root, &#x27;column&#x27;);</span><br><span class="line"></span><br><span class="line">let child1 = createYogaNode();</span><br><span class="line">setWidth(child1, 100);</span><br><span class="line">setHeight(child1, 100);</span><br><span class="line"></span><br><span class="line">let child2 = createYogaNode();</span><br><span class="line">setWidth(child2, 100);</span><br><span class="line">setHeight(child2, 100);</span><br><span class="line"></span><br><span class="line">root.appendChild(child1);</span><br><span class="line">root.appendChild(child2);</span><br><span class="line"></span><br><span class="line">calculateLayout(root, 300, 300);</span><br><span class="line"></span><br><span class="line">console.log(`Left: $&#123;getLayoutLeft(root)&#125;, Top: $&#123;getLayoutTop(root)&#125;, Width: $&#123;getLayoutWidth(root)&#125;, Height: $&#123;getLayoutHeight(root)&#125;`);</span><br><span class="line">console.log(`Child1 Left: $&#123;getLayoutLeft(child1)&#125;, Top: $&#123;getLayoutTop(child1)&#125;, Width: $&#123;getLayoutWidth(child1)&#125;, Height: $&#123;getLayoutHeight(child1)&#125;`);</span><br><span class="line">console.log(`Child2 Left: $&#123;getLayoutLeft(child2)&#125;, Top: $&#123;getLayoutTop(child2)&#125;, Width: $&#123;getLayoutWidth(child2)&#125;, Height: $&#123;getLayoutHeight(child2)&#125;`);</span><br><span class="line">运行结果</span><br><span class="line">运行上述 JavaScript 代码后，你应该会看到类似以下的输出：</span><br><span class="line">Left: 0, Top: 0, Width: 300, Height: 300</span><br><span class="line">Child1 Left: 0, Top: 0, Width: 100, Height: 100</span><br><span class="line">Child2 Left: 0, Top: 100, Width: 100, Height: 100</span><br><span class="line">这表明 Yoga 节点的布局已经正确计算并输出。你可以根据需要修改 JavaScript 代码，以实现不同的布局效果。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/pg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/pg/" class="post-title-link" itemprop="url">pg postgres</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:52:23" itemprop="dateCreated datePublished" datetime="2024-12-13T14:52:23+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/postgres/" itemprop="url" rel="index"><span itemprop="name">postgres</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>链接postgres<br>psql -h localhost -p 5432 -U postgres -W</p>
<p>密码<br>admin</p>
<p>列出所有数据库<br>\list</p>
<p>切换数据库</p>
<p>CREATE DATABASE mydatabase;</p>
<p>\c mydatabase </p>
<p>CREATE TABLE mytable (<br>   id SERIAL PRIMARY KEY,<br>   name VARCHAR(100),<br>   age INT,<br>   email VARCHAR(255)<br>);</p>
<p>INSERT INTO mytable (name, age, email) VALUES<br>(‘John Doe’, 28, ‘<a href="mailto:&#106;&#x6f;&#x68;&#110;&#46;&#x64;&#111;&#x65;&#x40;&#101;&#120;&#97;&#x6d;&#x70;&#108;&#101;&#46;&#99;&#111;&#x6d;">&#106;&#x6f;&#x68;&#110;&#46;&#x64;&#111;&#x65;&#x40;&#101;&#120;&#97;&#x6d;&#x70;&#108;&#101;&#46;&#99;&#111;&#x6d;</a>‘),<br>(‘Jane Smith’, 35, ‘<a href="mailto:&#106;&#x61;&#x6e;&#101;&#x2e;&#115;&#x6d;&#x69;&#116;&#x68;&#x40;&#101;&#x78;&#x61;&#109;&#x70;&#108;&#x65;&#46;&#x63;&#x6f;&#x6d;">&#106;&#x61;&#x6e;&#101;&#x2e;&#115;&#x6d;&#x69;&#116;&#x68;&#x40;&#101;&#x78;&#x61;&#109;&#x70;&#108;&#x65;&#46;&#x63;&#x6f;&#x6d;</a>‘);</p>
<p>\dt+  – 列出所有表，包括视图和索引<br>\dt   – 仅列出表<br>\dv   – 仅列出视图<br>\di   – 仅列出索引</p>
<p>SELECT * FROM mytable;</p>
<p>\q 退出 psql</p>
<p>数据操作</p>
<p>增<br>INSERT INTO mytable (name, age, email) VALUES<br>(‘John Doe’, 28, ‘<a href="mailto:&#x6a;&#111;&#x68;&#x6e;&#x2e;&#x64;&#x6f;&#x65;&#64;&#x65;&#x78;&#97;&#x6d;&#112;&#x6c;&#x65;&#46;&#99;&#111;&#x6d;">&#x6a;&#111;&#x68;&#x6e;&#x2e;&#x64;&#x6f;&#x65;&#64;&#x65;&#x78;&#97;&#x6d;&#112;&#x6c;&#x65;&#46;&#99;&#111;&#x6d;</a>‘),<br>(‘Jane Smith’, 35, ‘<a href="mailto:&#106;&#x61;&#110;&#x65;&#x2e;&#x73;&#x6d;&#x69;&#x74;&#x68;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#x65;&#46;&#99;&#x6f;&#109;">&#106;&#x61;&#110;&#x65;&#x2e;&#x73;&#x6d;&#x69;&#x74;&#x68;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#x65;&#46;&#99;&#x6f;&#109;</a>‘);</p>
<p>删<br>DELETE FROM mytable WHERE id &#x3D; 2;</p>
<p>改<br>UPDATE mytable SET name &#x3D; ‘wzw’, age &#x3D; 38 WHERE id&#x3D;1;</p>
<p>查询<br>SELECT * FROM mytable;</p>
<p>本地链接116 的postgresql<br>1、查看116 的项目配置文件查看配置的密码</p>
<p>&#x2F;home&#x2F;admin&#x2F;tml&#x2F;app&#x2F;config<br>application-dev.yml</p>
<p>2、需要修改postgresql 的配置</p>
<p>&#x2F;home&#x2F;admin&#x2F;tml&#x2F;app&#x2F;db&#x2F;data<br>vi pg_hba.conf<br>shift + G</p>
<p>host    all             all              127.0.0.1&#x2F;32            md5</p>
<p>增加一行<br>host    all             all              0.0.0.0&#x2F;0            md5</p>
<p>vi postgresql.conf </p>
<p>&#x2F;listen</p>
<p>listen_addresses 改为 ‘<em>‘<br>listen_addresses &#x3D; ‘</em>‘          # what IP address(es) to listen on;</p>
<p>ss -anlp | grep 5432</p>
<p>重启postgresql<br>sudo systemctl restart postgresql-12</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/redis/" class="post-title-link" itemprop="url">redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:52:17" itemprop="dateCreated datePublished" datetime="2024-12-13T14:52:17+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>redis 数据库<br>链接本地<br>redis-cli -p 6379</p>
<p>链接远程redis数据库<br>sudo redis-cli -h 192.168.40.116 -p 6379 -a admin</p>
<p>切换数据库<br>SELECT 0<br>查询所有的key值<br>keys *</p>
<p>增<br>set aa 1<br>删<br>del aa<br>改<br>set aa 2<br>查<br>get ‘aa’</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/Pinia-vue-%E6%96%B0%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/Pinia-vue-%E6%96%B0%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%BA%93/" class="post-title-link" itemprop="url">Pinia vue 新的状态管理库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 14:14:10" itemprop="dateCreated datePublished" datetime="2024-12-13T14:14:10+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue3/" itemprop="url" rel="index"><span itemprop="name">vue3</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Pinia基本概念"><a href="#Pinia基本概念" class="headerlink" title="Pinia基本概念"></a>Pinia基本概念</h1><blockquote>
<p>面试题：Pinia 相比 Vuex 有什么样的优点？为什么现在官方推荐使用 Pinia ？</p>
</blockquote>
<p>Pinia，是一个 Vue 阵营的新的状态管理库，现在 Vue 官方已经推荐使用 Pinia 来代替 Vuex，或者你可以把 Pinia 看作是 Vuex 的最新的版本。</p>
<ul>
<li>Pinia 的基本介绍</li>
<li>Pinia 优势</li>
</ul>
<h2 id="Pinia-的基本介绍"><a href="#Pinia-的基本介绍" class="headerlink" title="Pinia 的基本介绍"></a>Pinia 的基本介绍</h2><p>Pinia 是一个西班牙语的单词，表示“菠萝”的意思。因为菠萝是由一小块一小块组成的，这个和 Pinia 的思想就非常的吻合，在 Pinia 中，每个 Store 仓库都是单独的扁平化的存在的。</p>
<p>Pinia 是由 Vue 官方团队中的一个成员开发的，最早是在 2019 年 11 左右作为一项实验性工作所提出的，当时的目的是将组合 API 融入到 Vuex 中，探索新版本的 Vuex 应有的形态，随着探索的进行，最终发现 Pinia 已经实现了 Vuex5 大部分的提案，因此 Pinia 就作为了最新版本的 Vuex，但是为了尊重作者本人，名字保持不变，仍然叫做 Pinia。</p>
<p>相比 Vuex，Pinia 的 API 更少而且更简单，还支持组合式 API，还可以和 Typescript 一起使用来做类型的推断。</p>
<p>pinia 官网：<a target="_blank" rel="noopener" href="https://pinia.vuejs.org/">https://pinia.vuejs.org/</a></p>
<p><img src="/../images/2023-03-21-093840.png"></p>
<h2 id="Pinia-优势"><a href="#Pinia-优势" class="headerlink" title="Pinia 优势"></a>Pinia 优势</h2><ol>
<li>在 Pinia 中，已经不存在 mutations，只有 state、getters、actions</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们创建了一个仓库，该仓库中提供三个选项，分别是 state、getters 以及 actions。</p>
<ol start="2">
<li>actions 里面支持同步和异步来修改 store，相当于将之前 Vuex 中的 mutation 和 action 合并了</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 同步的修改仓库状态</span></span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 异步的修改仓库状态</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">incrementAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>))</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">increment</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">decrementAsync</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>))</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">decrement</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>可以和 TypeScript 一起使用，以此来获得类型推断的支持</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里定义了一个名为 Todo 的接口</span></span><br><span class="line">interface <span class="title class_">Todo</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: number;</span><br><span class="line">  <span class="attr">text</span>: string;</span><br><span class="line">  <span class="attr">done</span>: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTodoStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;todo&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">todos</span>: [] <span class="keyword">as</span> <span class="title class_">Todo</span>[],</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">completedTodos</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">done</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// text 指定了是 string 类型</span></span><br><span class="line">    <span class="title function_">addTodoItem</span>(<span class="params">text: string</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> id = state.<span class="property">todos</span>.<span class="property">length</span> + <span class="number">1</span></span><br><span class="line">      <span class="keyword">const</span> newTodo = &#123; id, text, <span class="attr">done</span>: <span class="literal">false</span> &#125;</span><br><span class="line">      state.<span class="property">todos</span>.<span class="title function_">push</span>(newTodo)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// todo 指定了是 Todo 类型</span></span><br><span class="line">    <span class="title function_">toggleTodoItem</span>(<span class="params">todo: Todo</span>) &#123;</span><br><span class="line">      todo.<span class="property">done</span> = !todo.<span class="property">done</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchTodos</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://jsonplaceholder.typicode.com/todos&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> todos = <span class="keyword">await</span> response.<span class="title function_">json</span>() <span class="keyword">as</span> <span class="title class_">Todo</span>[]</span><br><span class="line">      state.<span class="property">todos</span> = todos</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<ol start="4">
<li>关于 Store 仓库，每一个 Store 仓库都是独立的扁平化的存在的，不再像 Vuex 里面是通过 modules 嵌套</li>
<li>支持插件扩展，可以通过插件（函数）来扩展仓库的功能，为仓库添加全局属性或者全局方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// 这里定义了一个名为 localStoragePlugin 的插件，本质上就是一个函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">localStoragePlugin</span> = (<span class="params">context: PiniaPluginContext</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">&#x27;my-app-state&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从 localStorage 中恢复状态</span></span><br><span class="line">  context.<span class="property">state</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key) || context.<span class="property">state</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听 state 变化，将变化保存到 localStorage</span></span><br><span class="line">  context.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">mutation</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, context.<span class="property">state</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Pinia 实例，并注册 localStoragePlugin 插件</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">pinia.<span class="title function_">use</span>(localStoragePlugin)</span><br></pre></td></tr></table></figure>



<ol start="6">
<li>更加轻量，压缩之后体积只有 1kb 左右，基本上可以忽略这个库的存在</li>
</ol>
<h2 id="真题解答"><a href="#真题解答" class="headerlink" title="真题解答"></a>真题解答</h2><blockquote>
<p>题目：Pinia 相比 Vuex 有什么样的优点？为什么现在官方推荐使用 Pinia ？</p>
<p>参考答案：</p>
<p>Pinia 是由 Vue.js 团队成员开发的下一代状态管理仓库，相比 Vuex 3.x&#x2F;4.x，Pinia 可以看作是 Vuex5 版本。</p>
<p>Pinia 具有如下的优势：</p>
<ul>
<li><p>mutations 不复存在。只有 state 、getters 、actions。</p>
</li>
<li><p>actions 中支持同步和异步方法修改 state 状态。</p>
</li>
<li><p>与 TypeScript 一起使用具有可靠的类型推断支持。</p>
</li>
<li><p>不再有模块嵌套，只有 Store 的概念，Store 之间可以相互调用。</p>
</li>
<li><p>支持插件扩展，可以非常方便实现本地存储等功能。</p>
</li>
<li><p>更加轻量，压缩后体积只有 1kb 左右。</p>
</li>
</ul>
</blockquote>
<h1 id="Pinia快速入门"><a href="#Pinia快速入门" class="headerlink" title="Pinia快速入门"></a>Pinia快速入门</h1><blockquote>
<p>面试题：是否使用过 Pinia？简单谈一下 Pinia 的使用？</p>
</blockquote>
<h2 id="安装-Pinia"><a href="#安装-Pinia" class="headerlink" title="安装 Pinia"></a>安装 Pinia</h2><p>首先第一步，需要安装 Pinia，可以通过下面的命令进行安装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>

<p>安装完毕后，需要在 Vue 应用中挂载 Pinia</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="comment">// 创建 pinia 实例</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(pinia).<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在 src 目录下面创建仓库目录 store，在该目录下面创建对应的仓库文件，注意名字一般是 useXXXStore</p>
<p>在仓库文件中，我们可以通过 defineStore 来创建一个 pinia 仓库，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仓库文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数支持两种风格：options api 以及 composition api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&quot;counter&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>创建的时候支持两种风格，选项式 API 以及组合式 API。</p>
<h2 id="选项式风格"><a href="#选项式风格" class="headerlink" title="选项式风格"></a>选项式风格</h2><p>该风格基本上和之前的 Vuex 是非常相似的，只不过没有 mutation 了，无论是同步的方法还是异步的方法，都写在 actions 里面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仓库文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数支持两种风格：options api 以及 composition api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&quot;counter&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 针对上面 state 的数据做一个二次计算</span></span><br><span class="line">    <span class="comment">// 可以看作是计算属性</span></span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">num</span> * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 同步方法</span></span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">num</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">num</span>--;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 异步方法</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">asyncIncrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 等待 1 秒钟</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">increment</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">asyncDecrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">decrement</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在组件中使用仓库数据时，首先引入仓库方法，并执行该方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/store/useCounterStore.js&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useCounterStore</span>(); <span class="comment">// 拿到仓库</span></span><br></pre></td></tr></table></figure>

<p>如果是要获取数据，为了保持数据的响应式，应该使用 storeToRefs 方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="comment">// 接下来我们可以从仓库中解构数据出来</span></span><br><span class="line"><span class="keyword">const</span> &#123; num, doubleCount &#125; = <span class="title function_">storeToRefs</span>(store);</span><br></pre></td></tr></table></figure>

<p>如果是获取方法，直接从 store 里面解构出来即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从仓库将方法解构出来</span></span><br><span class="line"><span class="keyword">const</span> &#123; increment, asyncIncrement, asyncDecrement &#125; = store;</span><br></pre></td></tr></table></figure>



<p>另外，仓库还提供了两个好用的 api：</p>
<ul>
<li>store.$reset ：重置 state</li>
<li>store.$patch：变更 state</li>
</ul>
<h2 id="真题解答-1"><a href="#真题解答-1" class="headerlink" title="真题解答"></a>真题解答</h2><blockquote>
<p>题目：是否使用过 Pinia？简单谈一下 Pinia 的使用？<br>参考答案：</p>
</blockquote>
<h1 id="Pinia快速入门二"><a href="#Pinia快速入门二" class="headerlink" title="Pinia快速入门二"></a>Pinia快速入门二</h1><blockquote>
<p>面试题：是否使用过 Pinia？简单谈一下 Pinia 的使用？</p>
</blockquote>
<h2 id="安装-Pinia-1"><a href="#安装-Pinia-1" class="headerlink" title="安装 Pinia"></a>安装 Pinia</h2><p>首先第一步，需要安装 Pinia，可以通过下面的命令进行安装：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>

<p>安装完毕后，需要在 Vue 应用中挂载 Pinia</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="comment">// 创建 pinia 实例</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(pinia).<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在 src 目录下面创建仓库目录 store，在该目录下面创建对应的仓库文件，注意名字一般是 useXXXStore</p>
<p>在仓库文件中，我们可以通过 defineStore 来创建一个 pinia 仓库，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仓库文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数支持两种风格：options api 以及 composition api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&quot;counter&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>创建的时候支持两种风格，选项式 API 以及组合式 API。</p>
<h2 id="选项式风格-1"><a href="#选项式风格-1" class="headerlink" title="选项式风格"></a>选项式风格</h2><p>该风格基本上和之前的 Vuex 是非常相似的，只不过没有 mutation 了，无论是同步的方法还是异步的方法，都写在 actions 里面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仓库文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二个参数支持两种风格：options api 以及 composition api</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&quot;counter&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">num</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="comment">// 针对上面 state 的数据做一个二次计算</span></span><br><span class="line">    <span class="comment">// 可以看作是计算属性</span></span><br><span class="line">    <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">num</span> * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 同步方法</span></span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">num</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">num</span>--;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 异步方法</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">asyncIncrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 等待 1 秒钟</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">increment</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">asyncDecrement</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">decrement</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在组件中使用仓库数据时，首先引入仓库方法，并执行该方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/store/useCounterStore.js&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useCounterStore</span>(); <span class="comment">// 拿到仓库</span></span><br></pre></td></tr></table></figure>

<p>如果是要获取数据，为了保持数据的响应式，应该使用 storeToRefs 方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="comment">// 接下来我们可以从仓库中解构数据出来</span></span><br><span class="line"><span class="keyword">const</span> &#123; num, doubleCount &#125; = <span class="title function_">storeToRefs</span>(store);</span><br></pre></td></tr></table></figure>

<p>如果是获取方法，直接从 store 里面解构出来即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从仓库将方法解构出来</span></span><br><span class="line"><span class="keyword">const</span> &#123; increment, asyncIncrement, asyncDecrement &#125; = store;</span><br></pre></td></tr></table></figure>



<p>另外，仓库还提供了两个好用的 api：</p>
<ul>
<li>store.$reset ：重置 state</li>
<li>store.$patch：变更 state</li>
</ul>
<h2 id="组合式风格"><a href="#组合式风格" class="headerlink" title="组合式风格"></a>组合式风格</h2><p>组合式风格就和 Vue3 中的使用方法是一样的，通过 ref 或者 reactive 来定义仓库数据。</p>
<p>通过普通的方法来操作仓库数据。无论是数据还是方法最终需要导出出去。</p>
<p>通过 computed 来做 getter。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入其他仓库</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&quot;./useCounterStore.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useListStore = <span class="title function_">defineStore</span>(<span class="string">&quot;list&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counterStore = <span class="title function_">useCounterStore</span>();</span><br><span class="line">  <span class="comment">// 组合 api 风格</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建仓库数据，类似于 state</span></span><br><span class="line">  <span class="keyword">const</span> list = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">    <span class="attr">items</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&quot;学习 Pinia&quot;</span>,</span><br><span class="line">        <span class="attr">isCompleted</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&quot;打羽毛球&quot;</span>,</span><br><span class="line">        <span class="attr">isCompleted</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&quot;玩游戏&quot;</span>,</span><br><span class="line">        <span class="attr">isCompleted</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">100</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用 vue 里面的计算属性来做 getters</span></span><br><span class="line">  <span class="keyword">const</span> doubleCounter = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> list.<span class="property">counter</span> * <span class="number">2</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 接下来我们再来创建一个 getter，该 getter 使用的是其他仓库的数据</span></span><br><span class="line">  <span class="keyword">const</span> otherCounter = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> counterStore.<span class="property">doubleCount</span> * <span class="number">3</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加新的事项</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addItem</span>(<span class="params">newItem</span>) &#123;</span><br><span class="line">    list.<span class="property">items</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">text</span>: newItem,</span><br><span class="line">      <span class="attr">isCompleted</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 切换事项对应的完成状态</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">completeHandle</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    list.<span class="property">items</span>[index].<span class="property">isCompleted</span> = !list.<span class="property">items</span>[index].<span class="property">isCompleted</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除待办事项对应下标的某一项</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deleteItem</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    list.<span class="property">items</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list,</span><br><span class="line">    doubleCounter,</span><br><span class="line">    otherCounter,</span><br><span class="line">    addItem,</span><br><span class="line">    completeHandle,</span><br><span class="line">    deleteItem,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在一个仓库中，可以使用其他仓库的 getter 数据。两种风格都可以使用。</p>
<h2 id="真题解答-2"><a href="#真题解答-2" class="headerlink" title="真题解答"></a>真题解答</h2><blockquote>
<p>题目：是否使用过 Pinia？简单谈一下 Pinia 的使用？<br>参考答案：</p>
<p>在 Pinia 中，核心概念有</p>
<ul>
<li>state：仓库的核心，主要是用于维护仓库的数据</li>
<li>getters：用于对数据做二次计算的，等同于 store 的 state 的计算值</li>
<li>actions ：对仓库状态进行操作的方法</li>
</ul>
<p>相比 Vuex，Pinia 中没有 mutations，同步方法和异步方法都放在 actions 里面。Pinia 同时支持 Vue2 和 Vue3，内部支持两种编码风格，分别是：</p>
<ul>
<li>选项式 API ：编码风格基本就和之前的 Vuex 是相似的</li>
<li>组合式 API ： 编码风格和 Vue3 非常相似，使用 ref 或者 reactive 来定义仓库数据，使用 computed 来做 getters，actions 里面的方法直接书写即可，最后将数据和方法通过 return 导出。</li>
</ul>
</blockquote>
<h1 id="最佳实践与补充内容"><a href="#最佳实践与补充内容" class="headerlink" title="最佳实践与补充内容"></a>最佳实践与补充内容</h1><blockquote>
<p>面试题：在目前的 Vue 应用中，使用状态管理库进行状态管理时有哪些最佳实践？请列举一至两条</p>
</blockquote>
<h1 id="添加插件"><a href="#添加插件" class="headerlink" title="添加插件"></a>添加插件</h1><blockquote>
<p>面试题：是否给 Pinia 添加过插件？具体添加的方式是什么？</p>
</blockquote>
<p>在 Pinia 中，我们可以为仓库添加插件，通过添加插件能够扩展以下的内容：</p>
<ul>
<li>为 store 添加新的属性</li>
<li>定义 store 时增加新的选项</li>
<li>为 store 增加新的方法</li>
<li>包装现有的方法</li>
<li>改变甚至取消 action</li>
<li>实现副作用，如<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">本地存储</a></li>
<li><strong>仅</strong>应用插件于特定 store</li>
</ul>
<h2 id="自定义插件"><a href="#自定义插件" class="headerlink" title="自定义插件"></a>自定义插件</h2><p>首先建议插件单独拿一个目录来存放，一个插件就是一个方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">myPiniaPlugin1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 给所有的仓库添加了一条全局属性</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&quot;the cake is a lie&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">myPiniaPlugin2</span>(<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="comment">//   console.log(context);</span></span><br><span class="line">  <span class="keyword">const</span> &#123; store &#125; = context;</span><br><span class="line">  store.<span class="property">test</span> = <span class="string">&quot;this is a test&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给特定的仓库来扩展内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">param0</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">myPiniaPlugin3</span>(<span class="params">&#123; store &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">$id</span> === <span class="string">&quot;counter&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 为当前 id 为 counter 的仓库来扩展属性</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;my name is pinia&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重置仓库状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">myPiniaPlugin4</span>(<span class="params">&#123; store &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 我们首先可以将初始状态深拷贝一份</span></span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">deepClone</span>(store.<span class="property">$state</span>);</span><br><span class="line">  store.<span class="property">reset</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    store.$patch(<span class="title function_">deepClone</span>(state));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个插件在扩展内容时，会对所有的仓库进行内容扩展，如果想要针对某一个仓库进行内容扩展，可以通过 context.store.$id 来指定某一个仓库来扩展内容。</p>
<p>插件书写完毕后，需要通过 <em>pinia</em> 实例对插件进行一个注册操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入自定义插件</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  myPiniaPlugin1,</span><br><span class="line">  myPiniaPlugin2,</span><br><span class="line">  myPiniaPlugin3,</span><br><span class="line">  myPiniaPlugin4,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./plugins&quot;</span>;</span><br><span class="line"></span><br><span class="line">pinia.<span class="title function_">use</span>(myPiniaPlugin1);</span><br><span class="line">pinia.<span class="title function_">use</span>(myPiniaPlugin2);</span><br><span class="line">pinia.<span class="title function_">use</span>(myPiniaPlugin3);</span><br><span class="line">pinia.<span class="title function_">use</span>(myPiniaPlugin4);</span><br></pre></td></tr></table></figure>



<h2 id="添加第三方插件"><a href="#添加第三方插件" class="headerlink" title="添加第三方插件"></a>添加第三方插件</h2><p>有一些第三方插件，直接通过 npm 安装使用即可。</p>
<p>具体的使用方法一定要参阅文档。</p>
<h2 id="真题解答-3"><a href="#真题解答-3" class="headerlink" title="真题解答"></a>真题解答</h2><blockquote>
<p>题目：是否给 Pinia 添加过插件？具体添加的方式是什么？<br>参考答案：</p>
<p>在 Pinia 中可以非常方便的添加插件。一个插件就是一个函数，该函数接收一个 context 上下文对象，通过 context 对象可以拿到诸如 store、app 等信息。</p>
<p>每个插件在扩展内容时，会对所有的仓库进行内容扩展，如果想要针对某一个仓库进行内容扩展，可以通过 context.store.$id 来指定某一个仓库来扩展内容。</p>
<p>插件书写完毕后，需要通过 <em>pinia</em> 实例对插件进行一个注册操作。</p>
<p>另外，我们还可以使用一些第三方插件，直接通过 npm 安装使用即可。安装完毕后，使用方法和自定义插件是一样的，具体的使用方法一定要参阅文档。</p>
</blockquote>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><ul>
<li>分离状态逻辑和业务逻辑</li>
</ul>
<p>实际上这个就是我们使用状态管理库的目的，我们使用状态管理库，就是为了将组件的状态分离出来，这样可以方便我们维护，也方便组件之间进行状态的共享。</p>
<p>没有使用状态管理库：</p>
<p><img src="/../images/2022-11-04-023144.png"></p>
<p>使用状态管理库之后：</p>
<p><img src="/../images/2022-11-04-023459.png"></p>
<p>但是需要注意一点，并非所有的 Vue 应用都需要使用状态管理库，这个取决于我们所开发的应用的规模大小。如果只是小规模的 Vue 应用，使用状态管理库反而显得更麻烦。</p>
<ul>
<li>选择 Pinia 来进行状态管理</li>
</ul>
<p>目前 Vue 官方已经推荐开发者使用 Pinia 来替代 Vuex 作为状态管理库，你可以将 Pinia 看作是 Vuex5.x</p>
<p>相比 Vuex，Pinia 真的真的真的很轻量，大小只有 1kb 左右，基本上可以忽略</p>
<p>当然相比之前的 Vuex，还有一些其他的优点：</p>
<p><a target="_blank" rel="noopener" href="https://pinia.vuejs.org/zh/introduction.html#comparison-with-vuex">https://pinia.vuejs.org/zh/introduction.html#comparison-with-vuex</a></p>
<p>另外如果你之前的项目使用的是 Vuex，那么你可以看一下官方的迁移指南：</p>
<p><a target="_blank" rel="noopener" href="https://pinia.vuejs.org/zh/cookbook/migration-vuex.html">https://pinia.vuejs.org/zh/cookbook/migration-vuex.html</a></p>
<ul>
<li>避免直接操作 store 的状态</li>
</ul>
<p>虽然我们可以直接操作 store 的状态，但是在 Pinia 中我们最好还是避免直接操作 store 里面的状态，而是通过对应的 getters 来读取，actions 来修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 计数器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;num++&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 待办事项</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addHandle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (newItem.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(list.<span class="property">value</span>.<span class="property">items</span>);</span><br><span class="line">    <span class="comment">// 直接操作 store 的状态</span></span><br><span class="line">    list.<span class="property">value</span>.<span class="property">items</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">      text : newItem.<span class="property">value</span>,</span><br><span class="line">      <span class="attr">isCompleted</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    newItem.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="string">&quot;请填写新增项目&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与其对应的应该使用 getters 和 actions 等 API 来处理状态的读取和修改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addHandle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (newItem.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="title function_">addItem</span>(newItem.<span class="property">value</span>);</span><br><span class="line">    newItem.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="string">&quot;请填写新增项目&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样做的好处在于提高了代码的可维护性，应该数据的改变始终来自于 actions 的方法，而不是分散于组件的各个部分。</p>
<ul>
<li>使用 TypeScript</li>
</ul>
<p>Pinia 本身就是使用 typescript 编写的，因此我们在使用 pinia 的时候，能够非常方便的、非常自然的使用 typescript，使用 typescript 可以更好的提供类型检查和代码提示，让我们的代码更加可靠和易于维护。</p>
<p>官方文档对应：<a target="_blank" rel="noopener" href="https://pinia.vuejs.org/zh/core-concepts/state.html#typescript">https://pinia.vuejs.org/zh/core-concepts/state.html#typescript</a></p>
<ul>
<li>将状态划分为多个模块</li>
</ul>
<p>在一个大型应用中，如果将所有组件的状态放置在一个状态仓库中，那么会显得该状态仓库非常的臃肿。因此一般在大型项目中，是一定会将状态仓库进行拆分的。</p>
<p>在早期的 Vuex 中，就已经支持将状态仓库按照不同的功能模块进行拆分，只不过在 Vuex 时期，状态仓库拆分时按照的是嵌套的方式进行代码组织的。</p>
<p>在 Pinia 中，组织状态仓库的形式不再采用像 Vuex 一样的嵌套，而是采用的是扁平化的设计，每一个状态仓库都是独立的，这个其实也是 Pinia 这个名字的来源。</p>
<h2 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h2><ul>
<li>辅助函数</li>
<li>订阅 state 以及 action</li>
<li>插件选项</li>
</ul>
<h2 id="真题解答-4"><a href="#真题解答-4" class="headerlink" title="真题解答"></a>真题解答</h2><blockquote>
<p>题目：在目前的 Vue 应用中，使用状态管理库进行状态管理时有哪些最佳实践？请列举一至两条</p>
<p>参考答案：</p>
<p>在使用 Vue 开发应用时，有关组件的状态管理这一块，有如下的最佳实践：</p>
<ul>
<li>使用专门的状态仓库来管理组件状态，以达到状态逻辑和业务逻辑的分离</li>
<li>比起 Vuex，目前更推荐使用 Pinia 来管理仓库的状态</li>
<li>尽量都集中使用 actions 中的方法来操作 store 的状态，避免直接操作 store</li>
<li>使用 typescript 以便得到更好的类型提示</li>
<li>根据不同的功能模块来创建对应的独立的状态仓库</li>
</ul>
</blockquote>
<h1 id="Pinia部分源码解析"><a href="#Pinia部分源码解析" class="headerlink" title="Pinia部分源码解析"></a>Pinia部分源码解析</h1><p>养成阅读源码的习惯，有如下的好处：</p>
<ul>
<li>阅读源码可以帮助我们扩宽自己的视野，可以看到优秀的程序员是如何书写代码的，从而提升我们自己的编码水平</li>
<li>知其然知其所以然。如果你阅读过源码，那么你自然能够知道某一个 API 是如何实现，背后的实现原理是什么，那么你也就能够自然的避免在使用该 API 时可能会遇到的一些 bug，会有一些自己独特的优化心得</li>
<li>最后一点就是阅读源码能够冲击大厂，大厂在面试的时候不会考察某个 API 如何使用，没什么意义，因为 API 经常也在变化，一般都是考察 API 背后的原理</li>
</ul>
<p>阅读源码时的一些注意事项</p>
<ul>
<li>阅读源码基于你已经使用过了该库或者该框架，对里面的 API 已经很熟悉了，是一种自发的行为</li>
<li>阅读源码一定要<strong>耐心</strong></li>
<li>不要<strong>陷入于细节</strong>，在阅读源码的时候往往需要你站在一个更高的角度</li>
</ul>
<h2 id="defineStore-方法"><a href="#defineStore-方法" class="headerlink" title="defineStore 方法"></a>defineStore 方法</h2><p>回顾 defineStore 方法的使用。defineStore 方法支持两种变成风格，一种是 option store，另一种是 setup store</p>
<p>option store 风格：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">double</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>option store 风格可以将 id 写到选项里面：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="attr">double</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>setup store 风格：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count, increment &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>defineStore 对应的源码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">defineStore</span>(<span class="params"></span></span><br><span class="line"><span class="params"><span class="comment">// <span class="doctag">TODO:</span> add proper types from above</span></span></span><br><span class="line"><span class="params">idOrOptions, setup, setupOptions</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> id;</span><br><span class="line">    <span class="keyword">let</span> options;</span><br><span class="line">    <span class="comment">// isSetupStore 会是一个布尔值，如果是 setup 函数，isSetupStore 为 true，否则为 false</span></span><br><span class="line">    <span class="keyword">const</span> isSetupStore = <span class="keyword">typeof</span> setup === <span class="string">&#x27;function&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> idOrOptions === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果进入此 if，说明 idOrOptions 是该仓库的 id</span></span><br><span class="line">        <span class="comment">// id 是 defineStore 函数内部的变量，存储仓库 id</span></span><br><span class="line">        id = idOrOptions;</span><br><span class="line">        <span class="comment">// the option store setup will contain the actual options in this case</span></span><br><span class="line">        <span class="comment">// 如果是 setup 风格，就将第三个参数（如果有）赋值给 options，否则就将配置对象赋值给 options</span></span><br><span class="line">        options = isSetupStore ? setupOptions : setup;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// idOrOptions 参数为配置对象</span></span><br><span class="line">        options = idOrOptions;</span><br><span class="line">        id = idOrOptions.<span class="property">id</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这个函数就是最终返回给外部的函数</span></span><br><span class="line">    <span class="comment">// 外部通过执行这个函数拿到 store 仓库 </span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">useStore</span>(<span class="params">pinia, hot</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> currentInstance = <span class="title function_">getCurrentInstance</span>();</span><br><span class="line">        pinia =</span><br><span class="line">            <span class="comment">// in test mode, ignore the argument provided as we can always retrieve a</span></span><br><span class="line">            <span class="comment">// pinia instance with getActivePinia()</span></span><br><span class="line">            (pinia) ||</span><br><span class="line">                (currentInstance &amp;&amp; <span class="title function_">inject</span>(piniaSymbol, <span class="literal">null</span>));</span><br><span class="line">        <span class="keyword">if</span> (pinia)</span><br><span class="line">            <span class="title function_">setActivePinia</span>(pinia);</span><br><span class="line">        <span class="keyword">if</span> (!activePinia) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`[🍍]: getActivePinia was called with no active Pinia. Did you forget to install pinia?\n`</span> +</span><br><span class="line">                <span class="string">`\tconst pinia = createPinia()\n`</span> +</span><br><span class="line">                <span class="string">`\tapp.use(pinia)\n`</span> +</span><br><span class="line">                <span class="string">`This will fail in production.`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        pinia = activePinia;</span><br><span class="line">        <span class="keyword">if</span> (!pinia.<span class="property">_s</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">            <span class="comment">// creating the store registers it in `pinia._s`</span></span><br><span class="line">            <span class="comment">// 创建一个仓库，并且将这个仓库注册到 pinia._s</span></span><br><span class="line">            <span class="comment">// 根据不同的风格开始创建仓库</span></span><br><span class="line">            <span class="keyword">if</span> (isSetupStore) &#123;</span><br><span class="line">                <span class="comment">// 如果是 setup 风格，调用的是 createSetupStore</span></span><br><span class="line">                <span class="title function_">createSetupStore</span>(id, setup, options, pinia);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果是 option 风格，调用的是 createOptionsStore</span></span><br><span class="line">                <span class="comment">// createOptionsStore 方法背后实际上也是在调用 createSetupStore，内部会创建一个名为 setup 的函数</span></span><br><span class="line">                <span class="comment">// 将选项转为 setup 函数内部的项目，然后调用 createSetupStore 方法，将 setup 函数作为第二个参数传递过去</span></span><br><span class="line">                <span class="comment">// 因此理论上来讲，setup 实践上要更加高效一些，因为 option store 背后也是转为 setup，这些是你不阅读源码无法知道的</span></span><br><span class="line">                <span class="title function_">createOptionsStore</span>(id, options, pinia);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// @ts-expect-error: not the right inferred type</span></span><br><span class="line">                useStore.<span class="property">_pinia</span> = pinia;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> store = pinia.<span class="property">_s</span>.<span class="title function_">get</span>(id);</span><br><span class="line">        <span class="keyword">if</span> (hot) &#123;</span><br><span class="line">            <span class="keyword">const</span> hotId = <span class="string">&#x27;__hot:&#x27;</span> + id;</span><br><span class="line">            <span class="keyword">const</span> newStore = isSetupStore</span><br><span class="line">                ? <span class="title function_">createSetupStore</span>(hotId, setup, options, pinia, <span class="literal">true</span>)</span><br><span class="line">                : <span class="title function_">createOptionsStore</span>(hotId, <span class="title function_">assign</span>(&#123;&#125;, options), pinia, <span class="literal">true</span>);</span><br><span class="line">            hot.<span class="title function_">_hotUpdate</span>(newStore);</span><br><span class="line">            <span class="comment">// cleanup the state properties and the store from the cache</span></span><br><span class="line">            <span class="keyword">delete</span> pinia.<span class="property">state</span>.<span class="property">value</span>[hotId];</span><br><span class="line">            pinia.<span class="property">_s</span>.<span class="title function_">delete</span>(hotId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// save stores in instances to access them devtools</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable constant_">IS_CLIENT</span> &amp;&amp;</span><br><span class="line">            currentInstance &amp;&amp;</span><br><span class="line">            currentInstance.<span class="property">proxy</span> &amp;&amp;</span><br><span class="line">            <span class="comment">// avoid adding stores that are just built for hot module replacement</span></span><br><span class="line">            !hot) &#123;</span><br><span class="line">            <span class="keyword">const</span> vm = currentInstance.<span class="property">proxy</span>;</span><br><span class="line">            <span class="keyword">const</span> cache = <span class="string">&#x27;_pStores&#x27;</span> <span class="keyword">in</span> vm ? vm.<span class="property">_pStores</span> : (vm.<span class="property">_pStores</span> = &#123;&#125;);</span><br><span class="line">            cache[id] = store;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// StoreGeneric cannot be casted towards Store</span></span><br><span class="line">        <span class="keyword">return</span> store;</span><br><span class="line">    &#125;</span><br><span class="line">    useStore.<span class="property">$id</span> = id; <span class="comment">// 在 useStore 函数上面还挂了一个 $id，存储了该仓库的 id</span></span><br><span class="line">    <span class="keyword">return</span> useStore; <span class="comment">// 在向外部返回这个函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="storeToRefs-方法"><a href="#storeToRefs-方法" class="headerlink" title="storeToRefs 方法"></a>storeToRefs 方法</h2><p>首先我们还是回顾该方法的用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;</span><br><span class="line">const store = useCounterStore()</span><br><span class="line">const &#123; name, doubleCount &#125; = storeToRefs(store)</span><br><span class="line">const &#123; increment &#125; = store</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>源码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">storeToRefs</span>(<span class="params">store</span>) &#123;</span><br><span class="line">    <span class="comment">// See https://github.com/vuejs/pinia/issues/852</span></span><br><span class="line">    <span class="comment">// It&#x27;s easier to just use toRefs() even if it includes more stuff</span></span><br><span class="line">    <span class="comment">// 针对 Vue2 版本的处理</span></span><br><span class="line">    <span class="keyword">if</span> (isVue2) &#123;</span><br><span class="line">        <span class="comment">// @ts-expect-error: toRefs include methods and others</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">toRefs</span>(store);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        store = <span class="title function_">toRaw</span>(store);</span><br><span class="line">        <span class="comment">// 创建了一个空对象</span></span><br><span class="line">        <span class="keyword">const</span> refs = &#123;&#125;;</span><br><span class="line">        <span class="comment">// 遍历仓库对象</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> store) &#123;</span><br><span class="line">            <span class="comment">// 拿到仓库对象对应的每一项的值</span></span><br><span class="line">            <span class="keyword">const</span> value = store[key];</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">isRef</span>(value) || <span class="title function_">isReactive</span>(value)) &#123;</span><br><span class="line">                <span class="comment">// @ts-expect-error: the key is state or getter</span></span><br><span class="line">                <span class="comment">// 如果这个值本身是响应式的，将这个值以原本的 key 添加到 refs 对象上面</span></span><br><span class="line">                refs[key] =</span><br><span class="line">                    <span class="comment">// ---</span></span><br><span class="line">                    <span class="title function_">toRef</span>(store, key);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 整个 for 循环完了之后，所有响应式的值被添加到了 refs 对象上面</span></span><br><span class="line">        <span class="comment">// 向外部返回这个 refs 对象</span></span><br><span class="line">        <span class="keyword">return</span> refs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/13/vue3%20%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/13/vue3%20%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">vue3 共享数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-13 13:55:14" itemprop="dateCreated datePublished" datetime="2024-12-13T13:55:14+08:00">2024-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue3/" itemprop="url" rel="index"><span itemprop="name">vue3</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vuex方案"><a href="#vuex方案" class="headerlink" title="vuex方案"></a>vuex方案</h1><p>安装<code>vuex@4.x</code></p>
<p>两个重要变动：</p>
<ul>
<li>去掉了构造函数<code>Vuex</code>，而使用<code>createStore</code>创建仓库</li>
<li>为了配合<code>composition api</code>，新增<code>useStore</code>函数获得仓库对象</li>
</ul>
<h1 id="global-state"><a href="#global-state" class="headerlink" title="global state"></a>global state</h1><p>由于<code>vue3</code>的响应式系统本身可以脱离组件而存在，因此可以充分利用这一点，轻松制造多个全局响应式数据</p>
<p><img src="/../images/20201026171519.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/useLoginUser 提供当前登录用户的共享数据</span></span><br><span class="line"><span class="comment">// 以下代码仅供参考</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive, readonly &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> userServ <span class="keyword">from</span> <span class="string">&quot;../api/user&quot;</span>; <span class="comment">// 导入api模块</span></span><br><span class="line"><span class="comment">// 创建默认的全局单例响应式数据，仅供该模块内部使用</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">user</span>: <span class="literal">null</span>, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"><span class="comment">// 对外暴露的数据是只读的，不能直接修改</span></span><br><span class="line"><span class="comment">// 也可以进一步使用toRefs进行封装，从而避免解构或展开后响应式丢失</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loginUserStore = <span class="title function_">readonly</span>(state);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">loginId, loginPwd</span>) &#123;</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> userServ.<span class="title function_">login</span>(loginId, loginPwd);</span><br><span class="line">  state.<span class="property">loginUser</span> = user;</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 退出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loginOut</span>(<span class="params"></span>) &#123;</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">await</span> userServ.<span class="title function_">loginOut</span>();</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">  state.<span class="property">loginUser</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 恢复登录状态</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">whoAmI</span>(<span class="params"></span>) &#123;</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> userServ.<span class="title function_">whoAmI</span>();</span><br><span class="line">  state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">  state.<span class="property">loginUser</span> = user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Provide-Inject"><a href="#Provide-Inject" class="headerlink" title="Provide&amp;Inject"></a>Provide&amp;Inject</h1><p>在<code>vue2</code>中，提供了<code>provide</code>和<code>inject</code>配置，可以让开发者在高层组件中注入数据，然后在后代组件中使用</p>
<p><img src="/../images/20201026173949.png"></p>
<p>除了兼容<code>vue2</code>的配置式注入，<code>vue3</code>在<code>composition api</code>中添加了<code>provide</code>和<code>inject</code>方法，可以在<code>setup</code>函数中注入和使用数据</p>
<p><img src="/../images/20201026174039.png"></p>
<p>考虑到有些数据需要在整个vue应用中使用，<code>vue3</code>还在应用实例中加入了<code>provide</code>方法，用于提供整个应用的共享数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">creaetApp</span>(<span class="title class_">App</span>)</span><br><span class="line">  .<span class="title function_">provide</span>(<span class="string">&quot;foo&quot;</span>, <span class="title function_">ref</span>(<span class="number">1</span>))</span><br><span class="line">  .<span class="title function_">provide</span>(<span class="string">&quot;bar&quot;</span>, <span class="title function_">ref</span>(<span class="number">2</span>))</span><br><span class="line">	.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>


<p><img src="/../images/20201026174611.png"></p>
<p>因此，我们可以利用这一点，在整个vue应用中提供共享数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/useLoginUser 提供当前登录用户的共享数据</span></span><br><span class="line"><span class="comment">// 以下代码仅供参考</span></span><br><span class="line"><span class="keyword">import</span> &#123; readonly, reactive, inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> key = <span class="title class_">Symbol</span>(); <span class="comment">// Provide的key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在传入的vue应用实例中提供数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">provideStore</span>(<span class="params">app</span>) &#123;</span><br><span class="line">  <span class="comment">// 创建默认的响应式数据</span></span><br><span class="line">  <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">user</span>: <span class="literal">null</span>, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">loginId, loginPwd</span>) &#123;</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> userServ.<span class="title function_">login</span>(loginId, loginPwd);</span><br><span class="line">    state.<span class="property">loginUser</span> = user;</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 退出</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loginOut</span>(<span class="params"></span>) &#123;</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">await</span> userServ.<span class="title function_">loginOut</span>();</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">    state.<span class="property">loginUser</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 恢复登录状态</span></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">whoAmI</span>(<span class="params"></span>) &#123;</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> userServ.<span class="title function_">whoAmI</span>();</span><br><span class="line">    state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">    state.<span class="property">loginUser</span> = user;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 提供全局数据</span></span><br><span class="line">  app.<span class="title function_">provide</span>(key, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="title function_">readonly</span>(state), <span class="comment">// 对外只读</span></span><br><span class="line">    login,</span><br><span class="line">    loginOut,</span><br><span class="line">    whoAmI,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useStore</span>(<span class="params">defaultValue = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">inject</span>(key, defaultValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// store/index</span></span><br><span class="line"><span class="comment">// 应用所有store</span></span><br><span class="line"><span class="keyword">import</span> &#123; provideStore <span class="keyword">as</span> provideLoginUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;./useLoginUser&quot;</span>;</span><br><span class="line"><span class="comment">// 继续导入其他共享数据模块...</span></span><br><span class="line"><span class="comment">// import &#123; provideStore as provideNewsStore &#125; from &quot;./useNews&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提供统一的数据注入接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">provideStore</span>(<span class="params">app</span>) &#123;</span><br><span class="line">  <span class="title function_">provideLoginUserStore</span>(app);</span><br><span class="line">  <span class="comment">// 继续注入其他共享数据</span></span><br><span class="line">  <span class="comment">// provideNewsStore(app);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> provideStore <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"><span class="title function_">provideStore</span>(app);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h1><table>
<thead>
<tr>
<th></th>
<th>vuex</th>
<th>global state</th>
<th>Provide&amp;Inject</th>
</tr>
</thead>
<tbody><tr>
<td>组件数据共享</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>可否脱离组件</td>
<td>✅</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>调试工具</td>
<td>✅</td>
<td>❌</td>
<td>✅</td>
</tr>
<tr>
<td>状态树</td>
<td>✅</td>
<td>自行决定</td>
<td>自行决定</td>
</tr>
<tr>
<td>量级</td>
<td>重</td>
<td>轻</td>
<td>轻</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/12/vue3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/12/vue3/" class="post-title-link" itemprop="url">vue3 和 vue2 的对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-12 11:01:14" itemprop="dateCreated datePublished" datetime="2024-12-12T11:01:14+08:00">2024-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue3/" itemprop="url" rel="index"><span itemprop="name">vue3</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>客户端渲染效率比vue2提升了1.3~2倍</p>
<p>SSR渲染效率比vue2提升了2~3倍</p>
</blockquote>
<blockquote>
<p>面试题：vue3的效率提升主要表现在哪些方面？</p>
</blockquote>
<h1 id="效率的提升"><a href="#效率的提升" class="headerlink" title="效率的提升"></a>效率的提升</h1><h2 id="静态提升"><a href="#静态提升" class="headerlink" title="静态提升"></a>静态提升</h2><p>下面的静态节点会被提升</p>
<ul>
<li>元素节点</li>
<li>没有绑定动态内容</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue2 的静态节点</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">createVNode</span>(<span class="string">&quot;h1&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue3 的静态节点</span></span><br><span class="line"><span class="keyword">const</span> hoisted = <span class="title function_">createVNode</span>(<span class="string">&quot;h1&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 直接使用 hoisted 即可</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态属性会被提升</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;user.name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hoisted = &#123; <span class="attr">class</span>: <span class="string">&quot;user&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="title function_">createVNode</span>(<span class="string">&quot;div&quot;</span>, hoisted, user.<span class="property">name</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="预字符串化"><a href="#预字符串化" class="headerlink" title="预字符串化"></a>预字符串化</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu-bar-container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>logo<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>menu<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>menu<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>menu<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>menu<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>menu<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当编译器遇到大量连续的静态内容，会直接将其编译为一个普通字符串节点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _hoisted_2 = <span class="title function_">_createStaticVNode</span>(<span class="string">&quot;&lt;div class=\&quot;logo\&quot;&gt;&lt;h1&gt;logo&lt;/h1&gt;&lt;/div&gt;&lt;ul class=\&quot;nav\&quot;&gt;&lt;li&gt;&lt;a href=\&quot;\&quot;&gt;menu&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;\&quot;&gt;menu&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;\&quot;&gt;menu&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;\&quot;&gt;menu&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;\&quot;&gt;menu&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/20200929170205.png"></p>
<p><img src="/../images/20200929170304.png"></p>
<h2 id="缓存事件处理函数"><a href="#缓存事件处理函数" class="headerlink" title="缓存事件处理函数"></a>缓存事件处理函数</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;count++&quot;</span>&gt;</span>plus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue2</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params">ctx</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="string">&quot;button&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onClick</span>: <span class="keyword">function</span>(<span class="params">$event</span>)&#123;</span><br><span class="line">      ctx.<span class="property">count</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vue3</span></span><br><span class="line"><span class="title function_">render</span>(<span class="params">ctx, _cache</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createVNode</span>(<span class="string">&quot;button&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onClick</span>: cache[<span class="number">0</span>] || (cache[<span class="number">0</span>] = <span class="function">(<span class="params">$event</span>) =&gt;</span> (ctx.<span class="property">count</span>++))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Block-Tree"><a href="#Block-Tree" class="headerlink" title="Block Tree"></a>Block Tree</h2><p>vue2在对比新旧树的时候，并不知道哪些节点是静态的，哪些是动态的，因此只能一层一层比较，这就浪费了大部分时间在比对静态节点上</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>账号：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;user.loginId&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;user.loginPwd&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/20200929172002.png"></p>
<p><img src="/../images/20200929172555.png"></p>
<h2 id="PatchFlag"><a href="#PatchFlag" class="headerlink" title="PatchFlag"></a>PatchFlag</h2><p>vue2在对比每一个节点时，并不知道这个节点哪些相关信息会发生变化，因此只能将所有信息依次比对</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">title</span>=<span class="string">&quot;user name&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;user.name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/20200929172805.png"></p>
<blockquote>
<p>面试题1：为什么vue3中去掉了vue构造函数？</p>
<p>面试题2：谈谈你对vue3数据响应式的理解</p>
</blockquote>
<blockquote>
</blockquote>
<h1 id="数据响应式和API的变化"><a href="#数据响应式和API的变化" class="headerlink" title="数据响应式和API的变化"></a>数据响应式和API的变化</h1><h2 id="去掉了Vue构造函数"><a href="#去掉了Vue构造函数" class="headerlink" title="去掉了Vue构造函数"></a>去掉了Vue构造函数</h2><blockquote>
<p>在过去，如果遇到一个页面有多个<code>vue</code>应用时，往往会遇到一些问题</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- vue2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">use</span>(...); <span class="comment">// 此代码会影响所有的vue应用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">mixin</span>(...); <span class="comment">// 此代码会影响所有的vue应用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(...); <span class="comment">// 此代码会影响所有的vue应用</span></span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 配置</span></span></span><br><span class="line"><span class="language-javascript">  &#125;).$mount(<span class="string">&quot;#app1&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 配置</span></span></span><br><span class="line"><span class="language-javascript">  &#125;).$mount(<span class="string">&quot;#app2&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在<code>vue3</code>中，去掉了<code>Vue</code>构造函数，转而使用<code>createApp</code>创建<code>vue</code>应用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- vue3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">	<span class="title function_">createApp</span>(根组件).<span class="title function_">use</span>(...).<span class="title function_">mixin</span>(...).<span class="title function_">component</span>(...).<span class="title function_">mount</span>(<span class="string">&quot;#app1&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(根组件).<span class="title function_">mount</span>(<span class="string">&quot;#app2&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多vue应用的api：<a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/application-api.html">https://v3.vuejs.org/api/application-api.html</a></p>
</blockquote>
<h2 id="组件实例中的API"><a href="#组件实例中的API" class="headerlink" title="组件实例中的API"></a>组件实例中的API</h2><p>在<code>vue3</code>中，组件实例是一个<code>Proxy</code>，它仅提供了下列成员，功能和<code>vue2</code>一样</p>
<p>属性：<a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/instance-properties.html">https://v3.vuejs.org/api/instance-properties.html</a></p>
<p>方法：<a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/instance-methods.html">https://v3.vuejs.org/api/instance-methods.html</a></p>
<h2 id="对比数据响应式"><a href="#对比数据响应式" class="headerlink" title="对比数据响应式"></a>对比数据响应式</h2><p>vue2和vue3均在相同的生命周期完成数据响应式，但做法不一样</p>
<p><img src="/../images/20201014155433.png"></p>
<h2 id="面试题参考答案"><a href="#面试题参考答案" class="headerlink" title="面试题参考答案"></a>面试题参考答案</h2><p>面试题1：为什么vue3中去掉了vue构造函数？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vue2的全局构造函数带来了诸多问题：</span><br><span class="line">1. 调用构造函数的静态方法会对所有vue应用生效，不利于隔离不同应用</span><br><span class="line">2. vue2的构造函数集成了太多功能，不利于tree shaking，vue3把这些功能使用普通函数导出，能够充分利用tree shaking优化打包体积</span><br><span class="line">3. vue2没有把组件实例和vue应用两个概念区分开，在vue2中，通过new Vue创建的对象，既是一个vue应用，同时又是一个特殊的vue组件。vue3中，把两个概念区别开来，通过createApp创建的对象，是一个vue应用，它内部提供的方法是针对整个应用的，而不再是一个特殊的组件。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>面试题2：谈谈你对vue3数据响应式的理解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vue3不再使用Object.defineProperty的方式定义完成数据响应式，而是使用Proxy。</span><br><span class="line">除了Proxy本身效率比Object.defineProperty更高之外，由于不必递归遍历所有属性，而是直接得到一个Proxy。所以在vue3中，对数据的访问是动态的，当访问某个属性的时候，再动态的获取和设置，这就极大的提升了在组件初始阶段的效率。</span><br><span class="line">同时，由于Proxy可以监控到成员的新增和删除，因此，在vue3中新增成员、删除成员、索引访问等均可以触发重新渲染，而这些在vue2中是难以做到的。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="模板中的变化"><a href="#模板中的变化" class="headerlink" title="模板中的变化"></a>模板中的变化</h1><h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><p><code>vue2</code>比较让人诟病的一点就是提供了两种双向绑定：<code>v-model</code>和<code>.sync</code>，在<code>vue3</code>中，去掉了<code>.sync</code>修饰符，只需要使用<code>v-model</code>进行双向绑定即可。</p>
<p>为了让<code>v-model</code>更好的针对多个属性进行双向绑定，<code>vue3</code>作出了以下修改</p>
<ul>
<li><p>当对自定义组件使用<code>v-model</code>指令时，绑定的属性名由原来的<code>value</code>变为<code>modelValue</code>，事件名由原来的<code>input</code>变为<code>update:modelValue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- vue2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">:value</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 简写为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- vue3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:modelValue</span>=<span class="string">&quot;pageTitle&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">update:modelValue</span>=<span class="string">&quot;pageTitle = $event&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 简写为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>去掉了<code>.sync</code>修饰符，它原本的功能由<code>v-model</code>的参数替代</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- vue2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">:title</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">update:title</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 简写为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">:title.sync</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- vue3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">:title</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">update:title</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 简写为 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">v-model:title</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>model</code>配置被移除</p>
</li>
<li><p>允许自定义<code>v-model</code>修饰符</p>
<p>vue2 无此功能</p>
<p><img src="/../images/20201008163022.png"></p>
</li>
</ul>
<h2 id="v-if-v-for"><a href="#v-if-v-for" class="headerlink" title="v-if v-for"></a>v-if v-for</h2><p><code>v-if</code> 的优先级 现在高于 <code>v-for</code></p>
<h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><ul>
<li><p>当使用<code>&lt;template&gt;</code>进行<code>v-for</code>循环时，需要把<code>key</code>值放到<code>&lt;template&gt;</code>中，而不是它的子元素中</p>
</li>
<li><p>当使用<code>v-if v-else-if v-else</code>分支的时候，不再需要指定<code>key</code>值，因为<code>vue3</code>会自动给予每个分支一个唯一的<code>key</code></p>
<p>即便要手工给予<code>key</code>值，也必须给予每个分支唯一的<code>key</code>，<strong>不能因为要重用分支而给予相同的 key</strong></p>
</li>
</ul>
<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><p><code>vue3</code>现在允许组件出现多个根节点</p>
<h1 id="组件的变化"><a href="#组件的变化" class="headerlink" title="组件的变化"></a>组件的变化</h1><h2 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import Modal from &quot;../components/Modal.vue&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;Teleport to=&quot;body&quot;&gt;</span><br><span class="line">  &lt;Modal v-if=&quot;modalVisible&quot;&gt;</span><br><span class="line">    &lt;button @click=&quot;modalVisible = false&quot;&gt;关闭朦层&lt;/button&gt;</span><br><span class="line">  &lt;/Modal&gt;</span><br><span class="line">&lt;/Teleport&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;modal&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.modal &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">  position: fixed;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background: rgba(0, 0, 0, 0.3);</span><br><span class="line">  left: 0;</span><br><span class="line">  top: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="asyncComponent"><a href="#asyncComponent" class="headerlink" title="asyncComponent"></a>asyncComponent</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">utils.js</span><br><span class="line">定义 getAsyncComponent 方法加载异步组件  定义 delay 通过 await delay(); 延迟加载</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &#123; defineAsyncComponent, h &#125; from &quot;vue&quot;;</span><br><span class="line">import Loading from &quot;../components/Loading.vue&quot;;</span><br><span class="line">import Error from &quot;../components/Error.vue&quot;;</span><br><span class="line">import NProgress from &quot;nprogress&quot;;</span><br><span class="line">import &quot;nprogress/nprogress.css&quot;;</span><br><span class="line">NProgress.configure(&#123;</span><br><span class="line">  trickleSpeed: 50,</span><br><span class="line">  showSpinner: false,</span><br><span class="line">&#125;);</span><br><span class="line">export function delay(duration) &#123;</span><br><span class="line">  if (!duration) &#123;</span><br><span class="line">    duration = random(1000, 5000);</span><br><span class="line">  &#125;</span><br><span class="line">  return new Promise((resolve) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, duration);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function random(min, max) &#123;</span><br><span class="line">  return Math.floor(Math.random() * (max - min) + min);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function getAsyncPage(path) &#123;</span><br><span class="line">  return defineAsyncComponent(&#123;</span><br><span class="line">    loader: async () =&gt; &#123;</span><br><span class="line">      NProgress.start();</span><br><span class="line">      await delay();</span><br><span class="line">      const comp = await import(path);</span><br><span class="line">      NProgress.done();</span><br><span class="line">      return comp;</span><br><span class="line">    &#125;,</span><br><span class="line">    loadingComponent: Loading,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function getAsyncComponent(path) &#123;</span><br><span class="line">  return defineAsyncComponent(&#123;</span><br><span class="line">    loader: async () =&gt; &#123;</span><br><span class="line">      await delay();</span><br><span class="line">      if (Math.random() &lt; 0.5) &#123;</span><br><span class="line">        return import(path);</span><br><span class="line">      &#125;</span><br><span class="line">      throw new Error();</span><br><span class="line">    &#125;,</span><br><span class="line">    loadingComponent: Loading,</span><br><span class="line">    errorComponent: &#123;</span><br><span class="line">      render() &#123;</span><br><span class="line">        return h(Error, &quot;组件加载出错&quot;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &#123; getAsyncPage &#125; from &quot;../util&quot;;</span><br><span class="line"></span><br><span class="line">export default [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/&quot;,</span><br><span class="line">    name: &quot;Home&quot;,</span><br><span class="line">    component: getAsyncPage(&quot;../views/Home.vue&quot;),</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/about&quot;,</span><br><span class="line">    name: &quot;About&quot;,</span><br><span class="line">    component: getAsyncPage(&quot;../views/About.vue&quot;),</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ReactivityApi"><a href="#ReactivityApi" class="headerlink" title="ReactivityApi"></a>ReactivityApi</h1><blockquote>
<p>reactivity api: <a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/reactivity-api">https://v3.vuejs.org/api/reactivity-api</a></p>
</blockquote>
<h2 id="获取响应式数据"><a href="#获取响应式数据" class="headerlink" title="获取响应式数据"></a>获取响应式数据</h2><table>
<thead>
<tr>
<th align="left">API</th>
<th>传入</th>
<th>返回</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>reactive</code></td>
<td><code>plain-object</code></td>
<td><code>对象代理</code></td>
<td>深度代理对象中的所有成员</td>
</tr>
<tr>
<td align="left"><code>readonly</code></td>
<td><code>plain-object</code> or <code>proxy</code></td>
<td><code>对象代理</code></td>
<td>只能读取代理对象中的成员，不可修改</td>
</tr>
<tr>
<td align="left"><code>ref</code></td>
<td><code>any</code></td>
<td><code>&#123; value: ... &#125;</code></td>
<td>对value的访问是响应式的<br />如果给value的值是一个对象，<br />则会通过<code>reactive</code>函数进行代理<br />如果已经是代理，则直接使用代理</td>
</tr>
<tr>
<td align="left"><code>computed</code></td>
<td><code>function</code></td>
<td><code>&#123; value: ... &#125;</code></td>
<td>当读取value值时，<br />会<strong>根据情况</strong>决定是否要运行函数</td>
</tr>
</tbody></table>
<p>应用：</p>
<ul>
<li>如果想要让一个对象变为响应式数据，可以使用<code>reactive</code>或<code>ref</code></li>
<li>如果想要让一个对象的所有属性只读，使用<code>readonly</code></li>
<li>如果想要让一个非对象数据变为响应式数据，使用<code>ref</code></li>
<li>如果想要根据已知的响应式数据得到一个新的响应式数据，使用<code>computed</code></li>
</ul>
<p>笔试题1：下面的代码输出结果是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, readonly, ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">firstName</span>: <span class="string">&quot;Xu Ming&quot;</span>,</span><br><span class="line">  <span class="attr">lastName</span>: <span class="string">&quot;Deng&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> fullName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;changed&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;state.lastName&#125;</span>, <span class="subst">$&#123;state.firstName&#125;</span>`</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;state ready&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fullname is&quot;</span>, fullName.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fullname is&quot;</span>, fullName.<span class="property">value</span>);</span><br><span class="line"><span class="keyword">const</span> imState = <span class="title function_">readonly</span>(state);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(imState === state);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stateRef = <span class="title function_">ref</span>(state);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stateRef.<span class="property">value</span> === state);</span><br><span class="line"></span><br><span class="line">state.<span class="property">firstName</span> = <span class="string">&quot;Cheng&quot;</span>;</span><br><span class="line">state.<span class="property">lastName</span> = <span class="string">&quot;Ji&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(imState.<span class="property">firstName</span>, imState.<span class="property">lastName</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fullname is&quot;</span>, fullName.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fullname is&quot;</span>, fullName.<span class="property">value</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> imState2 = <span class="title function_">readonly</span>(stateRef);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(imState2.<span class="property">value</span> === stateRef.<span class="property">value</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>笔试题2：按照下面的要求完成函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; readonly, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useUser</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 在这里补全函数</span></span><br><span class="line">  <span class="comment">// const userOrigin = reactive(&#123;&#125;)</span></span><br><span class="line">  <span class="comment">// const user = readonly(userOrigin)</span></span><br><span class="line">  <span class="comment">// const setUserName = (name) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   userOrigin.name = name</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// const setUserAge = (age) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   userOrigin.age = age</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    user, <span class="comment">// 这是一个只读的用户对象，响应式数据，默认为一个空对象</span></span><br><span class="line">    setUserName, <span class="comment">// 这是一个函数，传入用户姓名，用于修改用户的名称</span></span><br><span class="line">    setUserAge, <span class="comment">// 这是一个函数，传入用户年龄，用户修改用户的年龄</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>笔试题3：按照下面的要求完成函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; readonly, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">obj, duration</span>)&#123;</span><br><span class="line">  <span class="comment">// 在这里补全函数</span></span><br><span class="line">  <span class="keyword">const</span> valueOrigin = <span class="title function_">reactive</span>(obj);</span><br><span class="line">  <span class="keyword">const</span> value = <span class="title function_">readonly</span>(valueOrigin);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setValue</span> = (<span class="params">newValue</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">clearTimeout</span>(timer);</span><br><span class="line">    timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">entries</span>(newValue).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">        valueOrigin[key] = value;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,duration)</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    value, <span class="comment">// 这里是一个只读对象，响应式数据，默认值为参数值</span></span><br><span class="line">    setValue <span class="comment">// 这里是一个函数，传入一个新的对象，需要把新对象中的属性混合到原始对象中，混合操作需要在duration的时间中防抖</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;value, setValue&#125; = <span class="title function_">useDebounceValue</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;,<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">value</span> = value;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">setValue</span> = setValue;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="监听数据变化"><a href="#监听数据变化" class="headerlink" title="监听数据变化"></a>监听数据变化</h2><p><strong>watchEffect</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> stats = <span class="title function_">reactive</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> count =<span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// watchEffect 会自动收集用到的依赖，依赖的数据改变后，会重新执行回调函数</span></span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;count&#x27;</span>, count.<span class="property">value</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;stats&#x27;</span>, stats.<span class="property">a</span>);</span><br><span class="line">  <span class="comment">// 该函数会立即执行，然后追中函数中用到的响应式数据，响应式数据变化后会再次执行</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改数据，后会自动执行watchEffect函数</span></span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">state.<span class="property">a</span>++;</span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为会进入微队列，所以会执行一次 watchEffect </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过调用stop函数，会停止监听</span></span><br><span class="line"><span class="title function_">stop</span>(); <span class="comment">// 停止监听</span></span><br></pre></td></tr></table></figure>

<p><strong>watch</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等效于vue2的$watch</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听单个数据的变化</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> options = &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125; <span class="comment">//会立即执行一次回调函数 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// watch 默认不执行回调函数，只有值发生变化才会执行回调函数</span></span><br><span class="line"><span class="comment">// 不可以直接传state.count 需要 () =&gt; state.count</span></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> state.<span class="property">count</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, options)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> countRef = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_">watch</span>(countRef, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, options)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听多个数据的变化</span></span><br><span class="line"><span class="title function_">watch</span>([<span class="function">() =&gt;</span> state.<span class="property">count</span>, countRef], <span class="function">(<span class="params">[new1, new2], [old1, old2]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// watch 也是延迟执行的</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>注意：无论是<code>watchEffect</code>还是<code>watch</code>，当依赖项变化时，回调函数的运行都是异步的（微队列）</strong></p>
<p>应用：除非遇到下面的场景，否则均建议选择<code>watchEffect</code></p>
<ul>
<li>不希望回调函数一开始就执行</li>
<li>数据改变时，需要参考旧值</li>
<li>需要监控一些回调函数中不会用到的数据</li>
</ul>
<p>笔试题: 下面的代码输出结果是什么？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, watchEffect, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;watchEffect&quot;</span>, state.<span class="property">count</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state.<span class="property">count</span>,</span><br><span class="line">  <span class="function">(<span class="params">count, oldCount</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;watch&quot;</span>, count, oldCount);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//宏队列</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;time out&quot;</span>);</span><br><span class="line">  state.<span class="property">count</span>++; <span class="comment">//微队列</span></span><br><span class="line">  state.<span class="property">count</span>++;</span><br><span class="line">&#125;);</span><br><span class="line">state.<span class="property">count</span>++;<span class="comment">//微队列</span></span><br><span class="line">state.<span class="property">count</span>++;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="comment">// watchEffect 0</span></span><br><span class="line"><span class="comment">// start</span></span><br><span class="line"><span class="comment">// end</span></span><br><span class="line"><span class="comment">// watchEffect 2</span></span><br><span class="line"><span class="comment">// watch 2 0</span></span><br><span class="line"><span class="comment">// time out</span></span><br><span class="line"><span class="comment">// watchEffect 4</span></span><br><span class="line"><span class="comment">// watch 4 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h2><table>
<thead>
<tr>
<th>API</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>isProxy</code></td>
<td>判断某个数据是否是由<code>reactive</code>或<code>readonly</code></td>
</tr>
<tr>
<td><code>isReactive</code></td>
<td>判断某个数据是否是通过<code>reactive</code>创建的<br />详细:<a target="_blank" rel="noopener" href="https://v3.vuejs.org/api/basic-reactivity.html#isreactive">https://v3.vuejs.org/api/basic-reactivity.html#isreactive</a></td>
</tr>
<tr>
<td><code>isReadonly</code></td>
<td>判断某个数据是否是通过<code>readonly</code>创建的</td>
</tr>
<tr>
<td><code>isRef</code></td>
<td>判断某个数据是否是一个<code>ref</code>对象</td>
</tr>
</tbody></table>
<h2 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h2><p><strong>unref</strong></p>
<p>等同于：<code>isRef(val) ? val.value : val</code></p>
<p>应用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useNewTodo</span>(<span class="params">todos</span>)&#123;</span><br><span class="line">  todos = <span class="title function_">unref</span>(todos);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>toRef</strong></p>
<p>得到一个响应式对象某个属性的ref格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fooRef = <span class="title function_">toRef</span>(state, <span class="string">&#x27;foo&#x27;</span>); <span class="comment">// fooRef: &#123;value: ...&#125;</span></span><br><span class="line"></span><br><span class="line">fooRef.<span class="property">value</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">foo</span>) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">state.<span class="property">foo</span>++</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fooRef.<span class="property">value</span>) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p><strong>toRefs</strong></p>
<p>把一个响应式对象的所有属性转换为ref格式，然后包装到一个<code>plain-object</code>中返回</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">bar</span>: <span class="number">2</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stateAsRefs = <span class="title function_">toRefs</span>(state)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">stateAsRefs: not a proxy</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  foo: &#123; value: ... &#125;,</span></span><br><span class="line"><span class="comment">  bar: &#123; value: ... &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> state1 = <span class="title function_">reactive</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;);</span><br><span class="line">  <span class="keyword">const</span> state2 = <span class="title function_">reactive</span>(&#123;<span class="attr">c</span>:<span class="number">3</span>, <span class="attr">d</span>:<span class="number">4</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state1, <span class="comment">// lost reactivity</span></span><br><span class="line">    ...state2 <span class="comment">// lost reactivity</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> state1 = <span class="title function_">reactive</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;);</span><br><span class="line">  <span class="keyword">const</span> state2 = <span class="title function_">reactive</span>(&#123;<span class="attr">c</span>:<span class="number">3</span>, <span class="attr">d</span>:<span class="number">4</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...<span class="title function_">toRefs</span>(state1), <span class="comment">// reactivity</span></span><br><span class="line">    ...<span class="title function_">toRefs</span>(state2) <span class="comment">// reactivity</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// composition function</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">usePos</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> pos = <span class="title function_">reactive</span>(&#123;<span class="attr">x</span>:<span class="number">0</span>, <span class="attr">y</span>:<span class="number">0</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;x, y&#125; = <span class="title function_">usePos</span>(); <span class="comment">// lost reactivity</span></span><br><span class="line">  <span class="keyword">const</span> &#123;x, y&#125; = <span class="title function_">toRefs</span>(<span class="title function_">usePos</span>()); <span class="comment">// reactivity</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="降低心智负担"><a href="#降低心智负担" class="headerlink" title="降低心智负担"></a>降低心智负担</h2><p>所有的<code>composition function</code>均以<code>ref</code>的结果返回，以保证<code>setup</code>函数的返回结果中不包含<code>reactive</code>或<code>readonly</code>直接产生的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">usePos</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> pos = <span class="title function_">reactive</span>(&#123; <span class="attr">x</span>:<span class="number">0</span>, <span class="attr">y</span>:<span class="number">0</span> &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">toRefs</span>(pos); <span class="comment">//  &#123;x: refObj, y: refObj&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useBooks</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> books = <span class="title function_">ref</span>([]);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    books <span class="comment">// books is refObj</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLoginUser</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">readonly</span>(&#123;</span><br><span class="line">    <span class="attr">isLogin</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">loginId</span>: <span class="literal">null</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">toRefs</span>(user); <span class="comment">// &#123; isLogin: refObj, loginId: refObj &#125;  all ref is readonly</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 在setup函数中，尽量保证解构、展开出来的所有响应式数据均是ref</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...<span class="title function_">usePos</span>(),</span><br><span class="line">    ...<span class="title function_">useBooks</span>(),</span><br><span class="line">    ...<span class="title function_">useLoginUser</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="CompositionApi"><a href="#CompositionApi" class="headerlink" title="CompositionApi"></a>CompositionApi</h1><blockquote>
<p>面试题：composition api相比于option api有哪些优势？</p>
</blockquote>
<p>不同于reactivity api，composition api提供的函数很多是与组件深度绑定的，不能脱离组件而存在。</p>
<h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>)&#123;</span><br><span class="line">    <span class="comment">// 该函数在组件属性被赋值后立即执行，早于所有生命周期钩子函数</span></span><br><span class="line">    <span class="comment">// props 是一个对象，包含了所有的组件属性值</span></span><br><span class="line">    <span class="comment">// context 是一个对象，提供了组件所需的上下文信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>context对象的成员</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>attrs</td>
<td>对象</td>
<td>同<code>vue2</code>的<code>this.$attrs</code></td>
</tr>
<tr>
<td>slots</td>
<td>对象</td>
<td>同<code>vue2</code>的<code>this.$slots</code></td>
</tr>
<tr>
<td>emit</td>
<td>方法</td>
<td>同<code>vue2</code>的<code>this.$emit</code></td>
</tr>
</tbody></table>
<h2 id="生命周期函数"><a href="#生命周期函数" class="headerlink" title="生命周期函数"></a>生命周期函数</h2><table>
<thead>
<tr>
<th>vue2 option api</th>
<th>vue3 option api</th>
<th>vue 3 composition api</th>
</tr>
</thead>
<tbody><tr>
<td>beforeCreate</td>
<td>beforeCreate</td>
<td>不再需要，代码可直接置于setup中</td>
</tr>
<tr>
<td>created</td>
<td>created</td>
<td>不再需要，代码可直接置于setup中</td>
</tr>
<tr>
<td>beforeMount</td>
<td>beforeMount</td>
<td>onBeforeMount</td>
</tr>
<tr>
<td>mounted</td>
<td>mounted</td>
<td>onMounted</td>
</tr>
<tr>
<td>beforeUpdate</td>
<td>beforeUpdate</td>
<td>onBeforeUpdate</td>
</tr>
<tr>
<td>updated</td>
<td>updated</td>
<td>onUpdated</td>
</tr>
<tr>
<td>beforeDestroy</td>
<td>&#x3D;&#x3D;改&#x3D;&#x3D; beforeUnmount</td>
<td>onBeforeUnmount</td>
</tr>
<tr>
<td>destroyed</td>
<td>&#x3D;&#x3D;改&#x3D;&#x3D;unmounted</td>
<td>onUnmounted</td>
</tr>
<tr>
<td>errorCaptured</td>
<td>errorCaptured</td>
<td>onErrorCaptured</td>
</tr>
<tr>
<td>-</td>
<td>&#x3D;&#x3D;新&#x3D;&#x3D;renderTracked</td>
<td>onRenderTracked</td>
</tr>
<tr>
<td>-</td>
<td>&#x3D;&#x3D;新&#x3D;&#x3D;renderTriggered</td>
<td>onRenderTriggered</td>
</tr>
</tbody></table>
<p>新增钩子函数说明：</p>
<table>
<thead>
<tr>
<th>钩子函数</th>
<th>参数</th>
<th>执行时机</th>
</tr>
</thead>
<tbody><tr>
<td>renderTracked</td>
<td>DebuggerEvent</td>
<td>渲染vdom收集到的每一次依赖时</td>
</tr>
<tr>
<td>renderTriggered</td>
<td>DebuggerEvent</td>
<td>某个依赖变化导致组件重新渲染时</td>
</tr>
</tbody></table>
<p>DebuggerEvent:</p>
<ul>
<li>target: 跟踪或触发渲染的对象</li>
<li>key: 跟踪或触发渲染的属性</li>
<li>type: 跟踪或触发渲染的方式</li>
</ul>
<h2 id="面试题参考答案-1"><a href="#面试题参考答案-1" class="headerlink" title="面试题参考答案"></a>面试题参考答案</h2><p>面试题：composition api相比于option api有哪些优势？</p>
<blockquote>
<p>从两个方面回答：</p>
<ol>
<li>为了更好的逻辑复用和代码组织</li>
<li>更好的类型推导</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">有了composition api，配合reactivity api，可以在组件内部进行更加细粒度的控制，使得组件中不同的功能高度聚合，提升了代码的可维护性。对于不同组件的相同功能，也能够更好的复用。</span><br><span class="line">相比于option api，composition api中没有了指向奇怪的this，所有的api变得更加函数式，这有利于和类型推断系统比如TS深度配合。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">useBar.js</span><br><span class="line"></span><br><span class="line">import &#123; computed, ref, watch &#125; from &quot;vue&quot;;</span><br><span class="line">import gsap from &quot;gsap&quot;;</span><br><span class="line">const colors = [&quot;#334552&quot;, &quot;#B34335&quot;, &quot;#6E9FA5&quot;, &quot;#A2C3AC&quot;, &quot;#C8846C&quot;];</span><br><span class="line">export default function useGdpBar(maxSize, gdp) &#123;</span><br><span class="line">  const max = computed(() =&gt; &#123;</span><br><span class="line">    if (gdp.value.length) &#123;</span><br><span class="line">      return Math.max(...gdp.value.map((it) =&gt; it.value));</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">  &#125;);</span><br><span class="line">  const bars = ref([]);</span><br><span class="line">  const targetBars = computed(() =&gt;</span><br><span class="line">    gdp.value.map((it, i) =&gt; &#123;</span><br><span class="line">      let size = (it.value / max.value) * maxSize;</span><br><span class="line">      return &#123;</span><br><span class="line">        size,</span><br><span class="line">        color: colors[i % colors.length],</span><br><span class="line">        ...it,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  watch(</span><br><span class="line">    targetBars,</span><br><span class="line">    (newValue) =&gt; &#123;</span><br><span class="line">      for (let i = 0; i &lt; newValue.length; i++) &#123;</span><br><span class="line">        if (!bars.value[i]) &#123;</span><br><span class="line">          bars.value[i] = &#123;</span><br><span class="line">            ...newValue[i],</span><br><span class="line">            size: 0,</span><br><span class="line">            value: 0,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        gsap.to(bars.value[i], &#123;</span><br><span class="line">          ...newValue[i],</span><br><span class="line">          duration: 1,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      deep: true,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  return &#123;</span><br><span class="line">    bars,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Bar1.vue</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bar1&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;item&quot; v-for=&quot;item in bars&quot;&gt;</span><br><span class="line">      &lt;label&gt;&#123;&#123; item.country &#125;&#125;&lt;/label&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;bar&quot;</span><br><span class="line">        :style=&quot;&#123; background: item.color, width: item.size + &#x27;px&#x27; &#125;&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;value&quot;&gt;&#123;&#123; item.value &#125;&#125;万亿&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import useBar from &quot;../composition/useBar&quot;;</span><br><span class="line">import &#123; computed &#125; from &quot;vue&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [&quot;gdp&quot;],</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    const gdp = computed(() =&gt; props.gdp);</span><br><span class="line">    return &#123;</span><br><span class="line">      ...useBar(400, gdp),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.bar1 &#123;</span><br><span class="line">  width: 500px;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  margin: 3em;</span><br><span class="line">  border-left: 1px solid #333;</span><br><span class="line">&#125;</span><br><span class="line">.item &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  height: 35px;</span><br><span class="line">  line-height: 35px;</span><br><span class="line">  margin: 1em 0;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line">.bar &#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100%;</span><br><span class="line">  margin-right: 1em;</span><br><span class="line">  flex: 0 0 auto;</span><br><span class="line">&#125;</span><br><span class="line">.item label &#123;</span><br><span class="line">  position: absolute;</span><br><span class="line">  left: -50px;</span><br><span class="line">&#125;</span><br><span class="line">.value &#123;</span><br><span class="line">  flex: 0 0 auto;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>图片引用</p>
<p>创建 URL 对象：调用 new URL 构造函数。<br>解析相对路径：使用 import.meta.url 解析 .&#x2F;assets&#x2F;Wallpaper1.jpg 的相对路径。打包后，图片会存放在 public 目录下。<br>new URL(<code>./assets/Wallpaper1.jpg</code>, import.meta.url),</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/12/vite-%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/12/vite-%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">vite 原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-12 10:36:14" itemprop="dateCreated datePublished" datetime="2024-12-12T10:36:14+08:00">2024-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-03-18 11:10:52" itemprop="dateModified" datetime="2025-03-18T11:10:52+08:00">2025-03-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">构建工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一个开发服务器，它基于 原生 ES 模块 提供了 丰富的内建功能，如速度快到惊人的 模块热更新（HMR）。</p>
<p>一套构建指令，它使用 Rollup 打包你的代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源。</p>
<p><img src="/../images/vite.png"></p>
<p>vs</p>
<p><img src="/../images/webpack.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; type=&quot;image/svg+xml&quot; href=&quot;/vite.svg&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;Vite + Vue&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;script type=&quot;module&quot; src=&quot;/src/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>参考：<br><a target="_blank" rel="noopener" href="https://vitejs.cn/vite3-cn/guide/">https://vitejs.cn/vite3-cn/guide/</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/12/%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/12/%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88/" class="post-title-link" itemprop="url">工具集合</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-12-12 10:36:14" itemprop="dateCreated datePublished" datetime="2024-12-12T10:36:14+08:00">2024-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-01 16:22:42" itemprop="dateModified" datetime="2025-04-01T16:22:42+08:00">2025-04-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88/" itemprop="url" rel="index"><span itemprop="name">工具集合</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>流程图<br><a target="_blank" rel="noopener" href="https://boardmix.cn/app/home/flowchart">https://boardmix.cn/app/home/flowchart</a></p>
<p>数据存储，即时通信 游戏解决方案 等..<br><a target="_blank" rel="noopener" href="https://console.leancloud.cn/apps">https://console.leancloud.cn/apps</a></p>
<p>自己搭建vpn<br><a target="_blank" rel="noopener" href="https://v2.hysteria.network/zh/">https://v2.hysteria.network/zh/</a><br>自己搭建vpn 推荐<br><a target="_blank" rel="noopener" href="https://github.com/XTLS/Xray-core">https://github.com/XTLS/Xray-core</a></p>
<p>Convert curl commands to Python, JavaScript and more<br><a target="_blank" rel="noopener" href="https://curlconverter.com/node-axios/">https://curlconverter.com/node-axios/</a></p>
<p>vscode使用restClient实现各种http请求<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36268452/article/details/128045377">https://blog.csdn.net/qq_36268452/article/details/128045377</a></p>
<p><a target="_blank" rel="noopener" href="https://m.ke.com/bj/bangdan/chaoyang/p1ibd7">https://m.ke.com/bj/bangdan/chaoyang/p1ibd7</a></p>
<p>时序图<br>Preview Diagram, Press Alt + D to start PlantUML preview (option + D on MacOS).</p>
<p>vscode 插件 plantuml<br><a target="_blank" rel="noopener" href="https://plantuml.com/zh/guide">https://plantuml.com/zh/guide</a></p>
<p>面试<br><a target="_blank" rel="noopener" href="https://q.shanyue.tech/">https://q.shanyue.tech/</a><br><a target="_blank" rel="noopener" href="https://github.com/lgwebdream/FE-Interview">https://github.com/lgwebdream/FE-Interview</a><br><a target="_blank" rel="noopener" href="https://github.com/qdleader/qdleader">https://github.com/qdleader/qdleader</a></p>
<p>算法<br><a target="_blank" rel="noopener" href="https://www.nowcoder.com/">https://www.nowcoder.com/</a><br><a target="_blank" rel="noopener" href="https://leetcode-cn.com/">https://leetcode-cn.com/</a></p>
<p>webp<br><a target="_blank" rel="noopener" href="https://jovialchap.com/auto-convert-images-to-webp-with-nginx/">https://jovialchap.com/auto-convert-images-to-webp-with-nginx/</a><br><a target="_blank" rel="noopener" href="https://github.com/webp-sh/webp_server_go">https://github.com/webp-sh/webp_server_go</a></p>
<p>AST 分析<br><a target="_blank" rel="noopener" href="https://www.astexplorer.net/">https://www.astexplorer.net/</a></p>
<p>开源认证系统<br>Keycloak vs okta<br>Auth0 vs keycloak<br>Authelia vs keycloak<br>Cognito vs keycloak<br>Authentik vs keycloak<br>Auth0 vs okta<br>Auth0 vs cognito<br>Authelia vs authentik<br>Auth0 vs authelia<br>Cognito vs okta<br>Authentik vs okta</p>
<p>typescript<br>Stack Auth: Open-source Clerk&#x2F;Auth0 alternative<br><a target="_blank" rel="noopener" href="https://github.com/stack-auth/stack">https://github.com/stack-auth/stack</a></p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://ritza.co/articles/gen-articles/keycloak-vs-okta-vs-auth0-vs-authelia-vs-cognito-vs-authentik/#authentik-vs-okta">https://ritza.co/articles/gen-articles/keycloak-vs-okta-vs-auth0-vs-authelia-vs-cognito-vs-authentik/#authentik-vs-okta</a></p>
<p>vscode 插件</p>
<p>REST Client<br><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">https://marketplace.visualstudio.com/items?itemName=humao.rest-client</a></p>
<p>新建 test.http 文件</p>
<p>文件内容</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>POST <a href="https://example.com/comments">https://example.com/comments</a> HTTP&#x2F;1.1<br>content-type: application&#x2F;json</p>
<p>{<br>    “name”: “sample”,<br>    “time”: “Wed, 21 Oct 2015 18:27:50 GMT”<br>}</p>
<p>截取图片固定在桌面 Snipaste  </p>
<p><a target="_blank" rel="noopener" href="https://yr7ywq.smartapps.baidu.com/?_chatQuery=ubuntu%20%E5%AE%89%E8%A3%85snipaste&searchid=14545354901972517931&_chatParams=%7B%22agent_id%22:%22c816%22,%22content_build_id%22:%221297021%22,%22from%22:%22q2c%22,%22token%22:%22UGlGZHdpN0lzYXNVbS9Gb1JoeVNNWXRmOGI3Q0R2VFNVZlJSWlMzOW9STDBIemhhOFBvUHFvd01YR1Y4Y3dhUE5rcTFNNlg3dEVkaWJvbnpuUDFRZWJqVmNGRTdRejFEWjkxWGkzMmNpNmsxK1E3bExKa0RXWGNqdkZBcWNXdHQ=%22,%22chat_no_login%22:true%7D&_swebScene=3711000610001000">https://yr7ywq.smartapps.baidu.com/?_chatQuery=ubuntu%20%E5%AE%89%E8%A3%85snipaste&amp;searchid=14545354901972517931&amp;_chatParams=%7B%22agent_id%22%3A%22c816%22%2C%22content_build_id%22%3A%221297021%22%2C%22from%22%3A%22q2c%22%2C%22token%22%3A%22UGlGZHdpN0lzYXNVbS9Gb1JoeVNNWXRmOGI3Q0R2VFNVZlJSWlMzOW9STDBIemhhOFBvUHFvd01YR1Y4Y3dhUE5rcTFNNlg3dEVkaWJvbnpuUDFRZWJqVmNGRTdRejFEWjkxWGkzMmNpNmsxK1E3bExKa0RXWGNqdkZBcWNXdHQ%3D%22%2C%22chat_no_login%22%3Atrue%7D&amp;_swebScene=3711000610001000</a></p>
<p>腾讯帮小忙，各种小工具集合（图片处理，pdf 转换，教育，开发等）<br><a target="_blank" rel="noopener" href="https://tool.browser.qq.com/category/pc_plugin">https://tool.browser.qq.com/category/pc_plugin</a></p>
<p>图片素材 png webp 可直接下载<br><a target="_blank" rel="noopener" href="https://freepngzone.com/index.html">https://freepngzone.com/index.html</a></p>
<p>AI 生成涂色书<br><a target="_blank" rel="noopener" href="https://zcoloring.com/">https://zcoloring.com/</a></p>
<p>web components ui library 一个具有前瞻性的 Web 组件库。适用于所有框架<br><a target="_blank" rel="noopener" href="https://github.com/shoelace-style/shoelace">https://github.com/shoelace-style/shoelace</a></p>
<h3 id="在线架构图"><a href="#在线架构图" class="headerlink" title="在线架构图"></a>在线架构图</h3><p><a target="_blank" rel="noopener" href="https://excalidraw.com/">https://excalidraw.com/</a></p>
<h3 id="在线思维导图"><a href="#在线思维导图" class="headerlink" title="在线思维导图"></a>在线思维导图</h3><p><a target="_blank" rel="noopener" href="https://boardmix.cn/">https://boardmix.cn/</a></p>
<h3 id="markdown-生成思维导图"><a href="#markdown-生成思维导图" class="headerlink" title="markdown 生成思维导图"></a>markdown 生成思维导图</h3><p><a target="_blank" rel="noopener" href="https://markmap.js.org/repl">https://markmap.js.org/repl</a></p>
<h3 id="pdf-to-png"><a href="#pdf-to-png" class="headerlink" title="pdf to png"></a>pdf to png</h3><p><a target="_blank" rel="noopener" href="https://pdf2png.com/zh/">https://pdf2png.com/zh/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">wangzhiwei</p>
  <div class="site-description" itemprop="description">javascript nodejs web developer...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangzhiwei</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
