<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="javascript nodejs web developer...">
<meta property="og:type" content="website">
<meta property="og:title" content="WBlog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="WBlog">
<meta property="og:description" content="javascript nodejs web developer...">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wangzhiwei">
<meta property="article:tag" content="javascript nodejs web developer fe engineer">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>WBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">WBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">wangzhiwei blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/08/dify-X-App-Passport-%E4%B8%AD-end-user-id-%E6%89%93%E9%80%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/12/08/dify-X-App-Passport-%E4%B8%AD-end-user-id-%E6%89%93%E9%80%9A%E5%A4%A7%E6%A8%A1%E5%9E%8B%E8%AE%BF%E9%97%AE%E9%93%BE%E8%B7%AF/" class="post-title-link" itemprop="url">dify X-App-Passport ä¸­ end_user_id æ‰“é€šå¤§æ¨¡å‹è®¿é—®é“¾è·¯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-08 11:43:19 / ä¿®æ”¹æ—¶é—´ï¼š11:50:29" itemprop="dateCreated datePublished" datetime="2025-12-08T11:43:19+08:00">2025-12-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="dify-X-App-Passport-ä¸­-end-user-id-æ‰“é€šå¤§æ¨¡å‹è®¿é—®é“¾è·¯"><a href="#dify-X-App-Passport-ä¸­-end-user-id-æ‰“é€šå¤§æ¨¡å‹è®¿é—®é“¾è·¯" class="headerlink" title="dify X-App-Passport ä¸­ end_user_id æ‰“é€šå¤§æ¨¡å‹è®¿é—®é“¾è·¯"></a>dify X-App-Passport ä¸­ end_user_id æ‰“é€šå¤§æ¨¡å‹è®¿é—®é“¾è·¯</h2><p>å‰ç«¯è§£å¯†ç”¨åˆ°äº† jose ï¼Œéœ€è¦å¯¹X-App-Passport ï¼Œè¿›è¡Œè§£å¯†ï¼Œè§£å¯†éœ€è¦åœ¨ httpsç¯å¢ƒä¸‹ï¼Œå¦åˆ™æ­ç§˜æ–¹æ³•ä¼šæŠ¥é”™ã€‚</p>
<p>difyåº”ç”¨ï¼Œè°ƒç”¨dify è‡ªå·±çš„ chat æ¥å£ï¼Œä¼šä¼ é€’ X-App-Passport ï¼Œ</p>
<p><img src="/../images/dify01.jpeg"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">    if (iframeLoaded) &#123;</span><br><span class="line">      setTimeout(async() =&gt; &#123;        </span><br><span class="line">        const passport = localStorage.getItem(&#x27;passport-&#x27; + chatId) || &#x27;&#x27;;</span><br><span class="line">        console.log(passport);</span><br><span class="line"></span><br><span class="line">        if (passport) &#123;</span><br><span class="line">          const secret = new TextEncoder().encode(&#x27;sk-xxxxxxxxxxx&#x27;);</span><br><span class="line">          // éªŒç­¾</span><br><span class="line">          try &#123;</span><br><span class="line">            const &#123; payload &#125; = await jose.jwtVerify(passport, secret, &#123;</span><br><span class="line">              algorithms: [&#x27;HS256&#x27;],</span><br><span class="line">            &#125;);</span><br><span class="line">            // console.log(payload);</span><br><span class="line">            // alert(JSON.stringify(payload));</span><br><span class="line"></span><br><span class="line">            const userStr = localStorage.getItem(&#x27;user&#x27;);</span><br><span class="line">            const user = userStr ? JSON.parse(userStr) : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">            setEndUserId(user.user_uuid as string, payload.end_user_id as string)</span><br><span class="line">            .then((res) =&gt; &#123;</span><br><span class="line">              console.log(&#x27;set end user id success&#x27;, res);</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch((err) =&gt; &#123;</span><br><span class="line">              console.error(&#x27;set end user id failed&#x27;, err);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">          &#125; catch (e) &#123;</span><br><span class="line">            console.error(&#x27;invalid&#x27;, e);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;, 1000)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [iframeLoaded]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>X-App-Passport è§£æåå«æœ‰ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    iss: &#x27;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&#x27;, </span><br><span class="line">    sub: &#x27;Web API Passport&#x27;, </span><br><span class="line">    app_id: &#x27;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&#x27;, </span><br><span class="line">    app_code: &#x27;j0xH9mK60ZS5mI70&#x27;, </span><br><span class="line">    end_user_id: &#x27;239b5e72-7cfd-4a25-930d-de68a3f41764&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹å…³æ³¨end_user_idï¼Œdifyä¼šå°†å…¶å‘é€ç»™å¤§æ¨¡å‹çš„è¯·æ±‚ä½“ä¸­ã€‚æŠ“åŒ…å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /v1/chat/completions HTTP/1.1</span><br><span class="line">Host: 192.168.0.209:8080</span><br><span class="line">User-Agent: python-requests/2.32.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept-Charset: utf-8</span><br><span class="line">Authorization: Bearer vllm</span><br><span class="line">Content-Length: 227</span><br><span class="line"></span><br><span class="line">&#123;&quot;model&quot;: &quot;Qwen3-14B&quot;, &quot;stream&quot;: true, &quot;temperature&quot;: 0.7, &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;85f7cfff-90fe-4248-b41a-f60c56d8efb3&quot;&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;a\n\n&quot;&#125;], &quot;user&quot;: &quot;85f7cfff-90fe-4248-b41a-f60c56d8efb3&quot;&#125;</span><br></pre></td></tr></table></figure>


<p>X-App-Passport å†…å®¹æ ¼å¼å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹†åˆ†ä¸‹é¢çš„å­—ç¬¦ä¸²ï¼Œè·å–ä¸­é—´éƒ¨åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJkMWI2NmE1MS1iNGVmLTQ1ZWYtYjNiZi03YjU4MTNjODYyNjEiLCJzdWIiOiJXZWIgQVBJIFBhc3Nwb3J0IiwiYXBwX2lkIjoiZDFiNjZhNTEtYjRlZi00NWVmLWIzYmYtN2I1ODEzYzg2MjYxIiwiYXBwX2NvZGUiOiJqMHhIOW1LNjBaUzVtSTcwIiwiZW5kX3VzZXJfaWQiOiIyMzliNWU3Mi03Y2ZkLTRhMjUtOTMwZC1kZTY4YTNmNDE3NjQifQ.eb0j1nJaPXvB5ZFLLlopQu-PwkvAHSvWlqnaaG2d6ms</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 1. æŠŠ URL-safe å­—ç¬¦ (- _) æ¢å›æ ‡å‡† (+ /)</span><br><span class="line">const urlSafe = &#x27;eyJpc3MiOiJkMWI2NmE1MS1iNGVmLTQ1ZWYtYjNiZi03YjU4MTNjODYyNjEiLCJzdWIiOiJXZWIgQVBJIFBhc3Nwb3J0IiwiYXBwX2lkIjoiZDFiNjZhNTEtYjRlZi00NWVmLWIzYmYtN2I1ODEzYzg2MjYxIiwiYXBwX2NvZGUiOiJqMHhIOW1LNjBaUzVtSTcwIiwiZW5kX3VzZXJfaWQiOiIyMzliNWU3Mi03Y2ZkLTRhMjUtOTMwZC1kZTY4YTNmNDE3NjQifQ&#x27;;</span><br><span class="line">const standard = urlSafe.replace(/-/g, &#x27;+&#x27;).replace(/_/g, &#x27;/&#x27;);</span><br><span class="line"></span><br><span class="line">// 2. è§£ç </span><br><span class="line">const jsonStr = decodeURIComponent(</span><br><span class="line">  Array.prototype.map.call(</span><br><span class="line">    atob(standard),</span><br><span class="line">    c =&gt; &#x27;%&#x27; + (&#x27;00&#x27; + c.charCodeAt(0).toString(16)).slice(-2)</span><br><span class="line">  ).join(&#x27;&#x27;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">console.log(jsonStr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;iss&quot;: &quot;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&quot;,</span><br><span class="line">  &quot;sub&quot;: &quot;Web API Passport&quot;,</span><br><span class="line">  &quot;app_id&quot;: &quot;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&quot;,</span><br><span class="line">  &quot;app_code&quot;: &quot;j0xH9mK60ZS5mI70&quot;,</span><br><span class="line">  &quot;end_user_id&quot;: &quot;239b5e72-7cfd-4a25-930d-de68a3f41764&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>æ‹“å±•å¯¹å­—ç¬¦è¿›è¡Œbase64åŠ å¯†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// åŠ å¯†ï¼šæ™®é€šå­—ç¬¦ä¸² â†’ Base64</span><br><span class="line">function base64Encode(str) &#123;</span><br><span class="line">  return btoa(</span><br><span class="line">    encodeURIComponent(str)</span><br><span class="line">      .replace(/%([0-9A-F]&#123;2&#125;)/g, (_, p1) =&gt;</span><br><span class="line">        String.fromCharCode(&#x27;0x&#x27; + p1)</span><br><span class="line">      )</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* ---- ç”¨ä¾‹ ---- */</span><br><span class="line">const json = JSON.stringify(&#123;</span><br><span class="line">  iss: &quot;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&quot;,</span><br><span class="line">  sub: &quot;Web API Passport&quot;,</span><br><span class="line">  app_id: &quot;d1b66a51-b4ef-45ef-b3bf-7b5813c86261&quot;,</span><br><span class="line">  app_code: &quot;j0xH9mK60ZS5mI70&quot;,</span><br><span class="line">  end_user_id: &quot;239b5e72-7cfd-4a25-930d-de68a3f41764&quot;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(base64Encode(json));</span><br><span class="line">// è¾“å‡ºï¼š</span><br><span class="line">// eyJpc3MiOiJkMWI2NmE1MS1iNGVmLTQ1ZWYtYjNiZi03YjU4MTNjODYyNjEiLCJzdWIiOiJXZWIgQVBJIFBhc3Nwb3J0IiwiYXBwX2lkIjoiZDFiNjZhNTEtYjRlZi00NWVmLWIzYmYtN2I1ODEzYzg2MjYxIiwiYXBwX2NvZGUiOiJqMHhIOW1LNjBaUzVtSTcwIiwiZW5kX3VzZXJfaWQiOiIyMzliNWU3Mi03Y2ZkLTRhMjUtOTMwZC1kZTY4YTNmNDE3NjQifQ</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/25/nodejs-mcp-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/25/nodejs-mcp-study/" class="post-title-link" itemprop="url">nodejs mcp study</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-11-25 17:54:01 / ä¿®æ”¹æ—¶é—´ï¼š18:06:24" itemprop="dateCreated datePublished" datetime="2025-11-25T17:54:01+08:00">2025-11-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="nodejs-mcp"><a href="#nodejs-mcp" class="headerlink" title="nodejs mcp"></a>nodejs mcp</h2><p>package.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;nodejs-mcp-server&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;server.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,</span><br><span class="line">    &quot;start&quot;: &quot;node server.js&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;@modelcontextprotocol/sdk&quot;: &quot;^1.22.0&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;^5.1.0&quot;,</span><br><span class="line">    &quot;zod&quot;: &quot;^3.24.1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;type&quot;: &quot;module&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»¥æ–‡ä»¶çš„å½¢å¼æä¾›mcpæœåŠ¡<br>server.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import &#123; McpServer, ResourceTemplate &#125; from &#x27;@modelcontextprotocol/sdk/server/mcp.js&#x27;;</span><br><span class="line">import &#123; StdioServerTransport &#125; from &#x27;@modelcontextprotocol/sdk/server/stdio.js&#x27;;</span><br><span class="line">import * as z from &#x27;zod&#x27;;</span><br><span class="line"></span><br><span class="line">const server = new McpServer(&#123;</span><br><span class="line">    name: &#x27;demo-server&#x27;,</span><br><span class="line">    version: &#x27;1.0.0&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// å·¥å…·1ï¼šç¬‘è¯ï¼ˆä¿®å¤ç‰ˆï¼‰</span><br><span class="line">server.registerTool(</span><br><span class="line">    &#x27;tell_weird_joke&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: &#x27;Tell Weird Joke&#x27;,</span><br><span class="line">        description: &#x27;Generate a weird joke about a specified topic&#x27;,</span><br><span class="line">        inputSchema: z.object(&#123;  // ä¿®å¤ï¼šå¿…é¡»ä½¿ç”¨ z.object()</span><br><span class="line">            topic: z.string().describe(&#x27;The topic of the joke&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    async (&#123; topic &#125;) =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            content: [&#123; type: &#x27;text&#x27;, text: `The weirdest joke about $&#123;topic&#125; is... hahaha!` &#125;],</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// å·¥å…·2ï¼šåŠ æ³•ï¼ˆä¿®å¤ç‰ˆï¼‰</span><br><span class="line">server.registerTool(</span><br><span class="line">    &#x27;add&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: &#x27;Addition Tool&#x27;,</span><br><span class="line">        description: &#x27;Add two numbers&#x27;,</span><br><span class="line">        inputSchema: z.object(&#123;  // ä¿®å¤ï¼šå¿…é¡»ä½¿ç”¨ z.object()</span><br><span class="line">            a: z.number(),</span><br><span class="line">            b: z.number()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    async (&#123; a, b &#125;) =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            content: [&#123; type: &#x27;text&#x27;, text: `Result: $&#123;a + b&#125;` &#125;],</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// èµ„æºï¼šé—®å€™</span><br><span class="line">server.registerResource(</span><br><span class="line">    &#x27;greeting&#x27;,</span><br><span class="line">    new ResourceTemplate(&#x27;greeting://&#123;name&#125;&#x27;, &#123; list: undefined &#125;),</span><br><span class="line">    &#123; title: &#x27;Greeting Resource&#x27;, description: &#x27;Dynamic greeting generator&#x27; &#125;,</span><br><span class="line">    async (uri, &#123; name &#125;) =&gt; (&#123;</span><br><span class="line">        contents: [&#123; uri: uri.href, text: `Hello, $&#123;name&#125;!` &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// å¯åŠ¨</span><br><span class="line">async function main() &#123;</span><br><span class="line">    const transport = new StdioServerTransport();</span><br><span class="line">    await server.connect(transport);</span><br><span class="line">    console.error(&#x27;âœ… MCP æœåŠ¡å™¨å·²å¯åŠ¨&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">main().catch(console.error);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>npx @modelcontextprotocol&#x2F;inspector nodejs server.js</p>
<p><img src="/../images/mcp001.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;tell_weird_joke&quot;: &#123;</span><br><span class="line">      &quot;isActive&quot;: true,</span><br><span class="line">      &quot;name&quot;: &quot;tell_weird_joke&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;stdio&quot;,</span><br><span class="line">      &quot;command&quot;: &quot;node&quot;,</span><br><span class="line">      &quot;args&quot;: [</span><br><span class="line">        &quot;/Users/wangzhiwei/work/ai-getway-study/nodejs-mcp-server/server.js&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;installSource&quot;: &quot;unknown&quot;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>


<p>ä»¥httpç«¯ç‚¹çš„å½¢å¼æä¾› mcp æœåŠ¡<br>server2.js </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">import &#123; McpServer, ResourceTemplate &#125; from &#x27;@modelcontextprotocol/sdk/server/mcp.js&#x27;;</span><br><span class="line">import &#123; StreamableHTTPServerTransport &#125; from &#x27;@modelcontextprotocol/sdk/server/streamableHttp.js&#x27;;</span><br><span class="line">import express from &#x27;express&#x27;;</span><br><span class="line">import * as z from &#x27;zod&#x27;;</span><br><span class="line"></span><br><span class="line">// 1. åˆ›å»º MCP æœåŠ¡å™¨ï¼ˆä¿æŒä¸å˜ï¼‰</span><br><span class="line">const server = new McpServer(&#123;</span><br><span class="line">    name: &#x27;demo-server&#x27;,</span><br><span class="line">    version: &#x27;1.0.0&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 2. æ³¨å†Œæ‰€æœ‰å·¥å…·å’Œèµ„æºï¼ˆä¿æŒä¸å˜ï¼‰</span><br><span class="line">server.registerTool(</span><br><span class="line">    &#x27;tell_weird_joke&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: &#x27;Tell Weird Joke&#x27;,</span><br><span class="line">        description: &#x27;Generate a weird joke about a specified topic&#x27;,</span><br><span class="line">        inputSchema: z.object(&#123;</span><br><span class="line">            topic: z.string().describe(&#x27;The topic of the joke&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    async (&#123; topic &#125;) =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            content: [&#123; type: &#x27;text&#x27;, text: `The weirdest joke about $&#123;topic&#125; is... hahaha!` &#125;],</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">server.registerTool(</span><br><span class="line">    &#x27;add&#x27;,</span><br><span class="line">    &#123;</span><br><span class="line">        title: &#x27;Addition Tool&#x27;,</span><br><span class="line">        description: &#x27;Add two numbers&#x27;,</span><br><span class="line">        inputSchema: z.object(&#123;</span><br><span class="line">            a: z.number(),</span><br><span class="line">            b: z.number()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    async (&#123; a, b &#125;) =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            content: [&#123; type: &#x27;text&#x27;, text: `Result: $&#123;a + b&#125;` &#125;],</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">server.registerResource(</span><br><span class="line">    &#x27;greeting&#x27;,</span><br><span class="line">    new ResourceTemplate(&#x27;greeting://&#123;name&#125;&#x27;, &#123; list: undefined &#125;),</span><br><span class="line">    &#123; title: &#x27;Greeting Resource&#x27;, description: &#x27;Dynamic greeting generator&#x27; &#125;,</span><br><span class="line">    async (uri, &#123; name &#125;) =&gt; (&#123;</span><br><span class="line">        contents: [&#123; uri: uri.href, text: `Hello, $&#123;name&#125;!` &#125;]</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 3. åˆ›å»º Express åº”ç”¨</span><br><span class="line">const app = express();</span><br><span class="line">app.use(express.json());</span><br><span class="line"></span><br><span class="line">// 4. æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">app.get(&#x27;/health&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123; status: &#x27;ok&#x27;, timestamp: new Date().toISOString() &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 5. æ ¸å¿ƒ MCP HTTP ç«¯ç‚¹</span><br><span class="line">app.post(&#x27;/mcp&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    // æ¯ä¸ªè¯·æ±‚åˆ›å»ºç‹¬ç«‹ transport å®ä¾‹ï¼ˆé¿å…è¯·æ±‚ ID å†²çªï¼‰</span><br><span class="line">    const transport = new StreamableHTTPServerTransport(&#123;</span><br><span class="line">        sessionIdGenerator: undefined,</span><br><span class="line">        enableJsonResponse: true // å¯ç”¨ JSON å“åº”æ ¼å¼</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    // è¯·æ±‚ç»“æŸæ—¶æ¸…ç†èµ„æº</span><br><span class="line">    res.on(&#x27;close&#x27;, () =&gt; &#123;</span><br><span class="line">        transport.close();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        // å°† transport è¿æ¥åˆ° MCP æœåŠ¡å™¨</span><br><span class="line">        await server.connect(transport);</span><br><span class="line">        </span><br><span class="line">        // å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”</span><br><span class="line">        await transport.handleRequest(req, res, req.body);</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;âŒ MCP request error:&#x27;, error);</span><br><span class="line">        if (!res.headersSent) &#123;</span><br><span class="line">            res.status(500).json(&#123; error: &#x27;Internal server error&#x27; &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 6. å¯åŠ¨ HTTP æœåŠ¡å™¨</span><br><span class="line">const port = parseInt(process.env.PORT || &#x27;3000&#x27;);</span><br><span class="line">app.listen(port, () =&gt; &#123;</span><br><span class="line">    console.log(`ğŸš€ MCP HTTP Server running at http://localhost:$&#123;port&#125;`);</span><br><span class="line">    console.log(`ğŸ“¡ MCP endpoint: http://localhost:$&#123;port&#125;/mcp`);</span><br><span class="line">    console.log(`ğŸ¥ Health check: http://localhost:$&#123;port&#125;/health`);</span><br><span class="line">&#125;).on(&#x27;error&#x27;, error =&gt; &#123;</span><br><span class="line">    console.error(&#x27;âŒ Server error:&#x27;, error);</span><br><span class="line">    process.exit(1);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ-1"><a href="#è¿è¡Œ-1" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>node server2.js</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:3000/health</span><br><span class="line">&#123;&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:&quot;2025-11-25T10:00:07.470Z&quot;&#125;%</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:3000/mcp \</span><br><span class="line">  -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">  -d &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;tools/list&quot;,&quot;params&quot;:&#123;&#125;&#125;&#x27;</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;error&quot;:&#123;&quot;code&quot;:-32000,&quot;message&quot;:&quot;Not Acceptable: Client must accept both application/json and text/event-stream&quot;&#125;,&quot;id&quot;:null&#125;%</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:3000/mcp \</span><br><span class="line">  -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">  -H &quot;Accept: application/json, text/event-stream&quot; \</span><br><span class="line">  -d &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;method&quot;:&quot;tools/list&quot;,&quot;params&quot;:&#123;&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#123;&quot;result&quot;:&#123;&quot;tools&quot;:[&#123;&quot;name&quot;:&quot;tell_weird_joke&quot;,&quot;title&quot;:&quot;Tell Weird Joke&quot;,&quot;description&quot;:&quot;Generate a weird joke about a specified topic&quot;,&quot;inputSchema&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;topic&quot;:&#123;&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;The topic of the joke&quot;&#125;&#125;,&quot;required&quot;:[&quot;topic&quot;],&quot;additionalProperties&quot;:false,&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;&#125;&#125;,&#123;&quot;name&quot;:&quot;add&quot;,&quot;title&quot;:&quot;Addition Tool&quot;,&quot;description&quot;:&quot;Add two numbers&quot;,&quot;inputSchema&quot;:&#123;&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:&#123;&quot;a&quot;:&#123;&quot;type&quot;:&quot;number&quot;&#125;,&quot;b&quot;:&#123;&quot;type&quot;:&quot;number&quot;&#125;&#125;,&quot;required&quot;:[&quot;a&quot;,&quot;b&quot;],&quot;additionalProperties&quot;:false,&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;&#125;&#125;]&#125;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1&#125;%</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:3000/mcp \</span><br><span class="line">  -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">  -H &quot;Accept: application/json, text/event-stream&quot; \</span><br><span class="line">  -d &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:2,&quot;method&quot;:&quot;tools/call&quot;,&quot;params&quot;:&#123;&quot;name&quot;:&quot;add&quot;,&quot;arguments&quot;:&#123;&quot;a&quot;:5,&quot;b&quot;:3&#125;&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">  &#123;&quot;result&quot;:&#123;&quot;content&quot;:[&#123;&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;Result: 8&quot;&#125;]&#125;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:2&#125;%</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -X POST http://localhost:3000/mcp \</span><br><span class="line">  -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">  -H &quot;Accept: application/json, text/event-stream&quot; \</span><br><span class="line">  -d &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:3,&quot;method&quot;:&quot;tools/call&quot;,&quot;params&quot;:&#123;&quot;name&quot;:&quot;tell_weird_joke&quot;,&quot;arguments&quot;:&#123;&quot;topic&quot;:&quot;programming&quot;&#125;&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">&#123;&quot;result&quot;:&#123;&quot;content&quot;:[&#123;&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:&quot;The weirdest joke about programming is... hahaha!&quot;&#125;]&#125;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:3&#125;%</span><br></pre></td></tr></table></figure>




<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p><a target="_blank" rel="noopener" href="https://github.com/modelcontextprotocol/typescript-sdk">https://github.com/modelcontextprotocol/typescript-sdk</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/24/nginx-conf-to-json/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/24/nginx-conf-to-json/" class="post-title-link" itemprop="url">nginx conf to json</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-24 08:57:09 / ä¿®æ”¹æ—¶é—´ï¼š10:16:21" itemprop="dateCreated datePublished" datetime="2025-10-24T08:57:09+08:00">2025-10-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>python ç‰ˆæœ¬<br>pip install crossplane</p>
<p>crossplane parse â€“indent&#x3D;4 nginx.conf &gt; nginx.json</p>
<p>crossplane build nginx.json</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nginxinc/crossplane?tab=readme-ov-file#crossplane-parse">https://github.com/nginxinc/crossplane?tab=readme-ov-file#crossplane-parse</a></p>
<h2 id="è½¬æ¢ä¸º-js-ç‰ˆæœ¬"><a href="#è½¬æ¢ä¸º-js-ç‰ˆæœ¬" class="headerlink" title="è½¬æ¢ä¸º js ç‰ˆæœ¬"></a>è½¬æ¢ä¸º js ç‰ˆæœ¬</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">nginx-parser.js</span><br><span class="line"></span><br><span class="line">// nginx config lexer + parser (browser version)</span><br><span class="line">// ç”¨æ³•ï¼š</span><br><span class="line">//   import &#123; parseNginx &#125; from &#x27;./nginx-parser.js&#x27;;</span><br><span class="line">//   const payload = parseNginx(nginxText, &#123; filename:&#x27;nginx.conf&#x27;, comments:true &#125;);</span><br><span class="line"></span><br><span class="line">const EXTERNAL_PARSERS = &#123;&#125;;   // é¢„ç•™ç¬¬ä¸‰æ–¹æŒ‡ä»¤è§£æå™¨</span><br><span class="line"></span><br><span class="line">// ---------- lexer ----------</span><br><span class="line">function* lex(text, filename = &#x27;nginx.conf&#x27;) &#123;</span><br><span class="line">  let line = 1, col = 0, idx = 0;</span><br><span class="line">  const len = text.length;</span><br><span class="line"></span><br><span class="line">  function skipWhitespace() &#123;</span><br><span class="line">    while (idx &lt; len &amp;&amp; /\s/.test(text[idx])) &#123;</span><br><span class="line">      if (text[idx] === &#x27;\n&#x27;) &#123; line++; col = 0; &#125;</span><br><span class="line">      else col++;</span><br><span class="line">      idx++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function readString(quote) &#123;</span><br><span class="line">    const start = ++idx;  // skip open quote</span><br><span class="line">    col++;</span><br><span class="line">    while (idx &lt; len &amp;&amp; text[idx] !== quote) &#123;</span><br><span class="line">      if (text[idx] === &#x27;\n&#x27;) &#123; line++; col = 0; &#125;</span><br><span class="line">      else if (text[idx] === &#x27;\\&#x27;) &#123; idx++; col++; &#125; // skip escaped</span><br><span class="line">      idx++; col++;</span><br><span class="line">    &#125;</span><br><span class="line">    if (idx &gt;= len) throw new Error(`Unterminated quoted string at $&#123;filename&#125;:$&#123;line&#125;`);</span><br><span class="line">    const val = text.slice(start, idx);</span><br><span class="line">    idx++; col++; // skip close quote</span><br><span class="line">    return [val, line, true];   // [token, lineno, quoted]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function readToken() &#123;</span><br><span class="line">    const start = idx;</span><br><span class="line">    while (idx &lt; len &amp;&amp; !/\s|[&#123;&#125;;#&quot;&#x27;\\]/.test(text[idx])) &#123;</span><br><span class="line">      idx++; col++;</span><br><span class="line">    &#125;</span><br><span class="line">    return text.slice(start, idx);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  while (idx &lt; len) &#123;</span><br><span class="line">    skipWhitespace();</span><br><span class="line">    if (idx &gt;= len) break;</span><br><span class="line">    const ch = text[idx];</span><br><span class="line"></span><br><span class="line">    if (ch === &#x27;#&#x27; || ch === &#x27;;&#x27; || ch === &#x27;&#123;&#x27; || ch === &#x27;&#125;&#x27;) &#123;</span><br><span class="line">      const tok = ch === &#x27;#&#x27; ? text.slice(idx, text.indexOf(&#x27;\n&#x27;, idx)) || text.slice(idx)</span><br><span class="line">                             : ch;</span><br><span class="line">      yield [tok, line, false];</span><br><span class="line">      if (tok === &#x27;\n&#x27;) &#123; line++; col = 0; &#125;</span><br><span class="line">      else col++;</span><br><span class="line">      idx += tok.length;</span><br><span class="line">    &#125; else if (ch === &#x27;&quot;&#x27; || ch === &quot;&#x27;&quot;) &#123;</span><br><span class="line">      yield readString(ch);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      const tok = readToken();</span><br><span class="line">      if (tok) yield [tok, line, false];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ---------- util ----------</span><br><span class="line">class NgxParserDirectiveError extends Error &#123;</span><br><span class="line">  constructor(msg, lineno) &#123;</span><br><span class="line">    super(msg);</span><br><span class="line">    this.name = &#x27;NgxParserDirectiveError&#x27;;</span><br><span class="line">    this.lineno = lineno;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç®€æ˜“ç‰ˆ analyzeï¼Œåªæ£€æŸ¥æœ«å°¾ç¬¦å·</span><br><span class="line">function analyze(&#123; fname, stmt, term, ctx, strict, check_ctx, check_args &#125;) &#123;</span><br><span class="line">  const dir = stmt.directive;</span><br><span class="line">  if (dir === &#x27;#&#x27;) return;          // æ³¨é‡Šè·³è¿‡</span><br><span class="line">  if (dir.startsWith(&#x27;#&#x27;)) return;  // è¡Œå†…æ³¨é‡Šä¹Ÿè·³è¿‡</span><br><span class="line">  // æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡/å‚æ•°æ£€æŸ¥å¯åœ¨æ­¤æ‰©å±•</span><br><span class="line">  if (term !== &#x27;;&#x27; &amp;&amp; term !== &#x27;&#123;&#x27; &amp;&amp; term !== &#x27;&#125;&#x27;) &#123;</span><br><span class="line">    throw new NgxParserDirectiveError(</span><br><span class="line">      `directive &quot;$&#123;dir&#125;&quot; is not terminated by &quot;;&quot; or &quot;&#123;&quot;`, stmt.line);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function enterBlockCtx(stmt, ctx) &#123;</span><br><span class="line">  // è¿”å›æ–°çš„ä¸Šä¸‹æ–‡ï¼Œç®€å•æ‹¼è·¯å¾„</span><br><span class="line">  return [...ctx, stmt.directive];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ---------- parser ----------</span><br><span class="line">export function parseNginx(text, &#123;</span><br><span class="line">  filename = &#x27;nginx.conf&#x27;,</span><br><span class="line">  onerror = null,</span><br><span class="line">  catchErrors = true,</span><br><span class="line">  ignore = [],</span><br><span class="line">  single = false,</span><br><span class="line">  comments = false,</span><br><span class="line">  strict = false,</span><br><span class="line">  checkCtx = true,</span><br><span class="line">  checkArgs = true</span><br><span class="line">&#125; = &#123;&#125;) &#123;</span><br><span class="line">  const tokens = [...lex(text, filename)]; // å…ˆå…¨éƒ¨å±•å¼€ï¼Œæ–¹ä¾¿ next()</span><br><span class="line">  let tokIdx = 0;</span><br><span class="line">  function next() &#123;</span><br><span class="line">    if (tokIdx &gt;= tokens.length) return [null, -1, false];</span><br><span class="line">    return tokens[tokIdx++];</span><br><span class="line">  &#125;</span><br><span class="line">  function peek() &#123;</span><br><span class="line">    if (tokIdx &gt;= tokens.length) return [null, -1, false];</span><br><span class="line">    return tokens[tokIdx];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const payload = &#123;</span><br><span class="line">    status: &#x27;ok&#x27;,</span><br><span class="line">    errors: [],</span><br><span class="line">    config: []</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  function handleError(parsing, e) &#123;</span><br><span class="line">    const file = parsing.file;</span><br><span class="line">    const errObj = &#123; file, error: e.message, line: e.lineno || null &#125;;</span><br><span class="line">    if (onerror) errObj.callback = onerror(e);</span><br><span class="line"></span><br><span class="line">    parsing.status = &#x27;failed&#x27;;</span><br><span class="line">    parsing.errors.push(&#123; error: e.message, line: e.lineno || null &#125;);</span><br><span class="line"></span><br><span class="line">    payload.status = &#x27;failed&#x27;;</span><br><span class="line">    payload.errors.push(errObj);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _parse(parsing, ctx = [], consume = false) &#123;</span><br><span class="line">    const fname = parsing.file;</span><br><span class="line">    const parsed = [];</span><br><span class="line"></span><br><span class="line">    while (true) &#123;</span><br><span class="line">      const [token, lineno, quoted] = next();</span><br><span class="line">      if (!token) break;</span><br><span class="line">      if (token === &#x27;&#125;&#x27; &amp;&amp; !quoted) break;</span><br><span class="line">      if (consume) &#123;</span><br><span class="line">        if (token === &#x27;&#123;&#x27; &amp;&amp; !quoted) _parse(parsing, ctx, true);</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      const directive = token;</span><br><span class="line"></span><br><span class="line">      // æ³¨é‡Šè¡Œ</span><br><span class="line">      if (directive.startsWith(&#x27;#&#x27;) &amp;&amp; !quoted) &#123;</span><br><span class="line">        if (comments) &#123;</span><br><span class="line">          parsed.push(&#123; directive: &#x27;#&#x27;, line: lineno, args: [], comment: directive.slice(1).trim() &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      const stmt = &#123; directive, line: lineno, args: [] &#125;;</span><br><span class="line">      if (!single) stmt.file = fname;</span><br><span class="line"></span><br><span class="line">      // æ”¶é›†å‚æ•°</span><br><span class="line">      const commentsInArgs = [];</span><br><span class="line">      let term;</span><br><span class="line">      while (true) &#123;</span><br><span class="line">        const [t, , q] = peek();</span><br><span class="line">        if (!t || (!q &amp;&amp; [&#x27;;&#x27;, &#x27;&#123;&#x27;, &#x27;&#125;&#x27;].includes(t))) &#123; term = t; next(); break; &#125;</span><br><span class="line">        next();</span><br><span class="line">        if (t.startsWith(&#x27;#&#x27;) &amp;&amp; !q) commentsInArgs.push(t.slice(1).trim());</span><br><span class="line">        else stmt.args.push(t);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (ignore.includes(stmt.directive)) &#123;</span><br><span class="line">        if (term === &#x27;&#123;&#x27; &amp;&amp; !quoted) _parse(parsing, ctx, true);</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // if ç‰¹æ®Šå¤„ç†</span><br><span class="line">      if (stmt.directive === &#x27;if&#x27;) &#123;</span><br><span class="line">        const args = stmt.args;</span><br><span class="line">        if (args.length &amp;&amp; args[0].startsWith(&#x27;(&#x27;) &amp;&amp; args[args.length - 1].endsWith(&#x27;)&#x27;)) &#123;</span><br><span class="line">          args[0] = args[0].slice(1).trimLeft();</span><br><span class="line">          args[args.length - 1] = args[args.length - 1].slice(0, -1).trimRight();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      try &#123;</span><br><span class="line">        analyze(&#123; fname, stmt, term, ctx, strict, check_ctx: checkCtx, check_args: checkArgs &#125;);</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        if (catchErrors) &#123;</span><br><span class="line">          handleError(parsing, e);</span><br><span class="line">          if (e.message.includes(&#x27;is not terminated&#x27;) &amp;&amp; term !== &#x27;&#125;&#x27; &amp;&amp; !quoted) &#123;</span><br><span class="line">            _parse(parsing, ctx, true);</span><br><span class="line">          &#125;</span><br><span class="line">          continue;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          throw e;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // include å¤„ç†ï¼ˆæµè§ˆå™¨ç«¯ä¸åšæ–‡ä»¶ IOï¼Œåªç•™ç©ºå£³ï¼‰</span><br><span class="line">      if (!single &amp;&amp; stmt.directive === &#x27;include&#x27;) &#123;</span><br><span class="line">        stmt.includes = [];   // å®é™…æ–‡ä»¶åˆ—è¡¨æ— æ³•è·å–ï¼Œç•™ç©º</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (term === &#x27;&#123;&#x27; &amp;&amp; !quoted) &#123;</span><br><span class="line">        const inner = enterBlockCtx(stmt, ctx);</span><br><span class="line">        stmt.block = _parse(parsing, inner);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      parsed.push(stmt);</span><br><span class="line"></span><br><span class="line">      // è¡Œå†…æ³¨é‡Šè¿½åŠ </span><br><span class="line">      commentsInArgs.forEach(c =&gt; parsed.push(&#123; directive: &#x27;#&#x27;, line: stmt.line, args: [], comment: c &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    return parsed;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ä¸»æµç¨‹</span><br><span class="line">  const parsing = &#123; file: filename, status: &#x27;ok&#x27;, errors: [], parsed: [] &#125;;</span><br><span class="line">  try &#123;</span><br><span class="line">    parsing.parsed = _parse(parsing, []);</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    handleError(parsing, e);</span><br><span class="line">  &#125;</span><br><span class="line">  payload.config.push(parsing);</span><br><span class="line">  return payload;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// é¢„ç•™å¤–éƒ¨è§£æå™¨æ³¨å†Œ</span><br><span class="line">export function registerExternalParser(parser, directives) &#123;</span><br><span class="line">  directives.forEach(d =&gt; &#123; EXTERNAL_PARSERS[d] = parser; &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">a.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;script type=&quot;module&quot;&gt;</span><br><span class="line">      import &#123; parseNginx &#125; from &quot;./nginx-parser.js&quot;;</span><br><span class="line"></span><br><span class="line">      const conf = `</span><br><span class="line">      user  nginx;</span><br><span class="line">      worker_processes  auto;</span><br><span class="line">      </span><br><span class="line">      events &#123;</span><br><span class="line">          worker_connections  1024;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      http &#123;</span><br><span class="line">          include       mime.types;</span><br><span class="line">          default_type  application/octet-stream;</span><br><span class="line">      </span><br><span class="line">          server &#123;</span><br><span class="line">              listen 80;</span><br><span class="line">              location / &#123;</span><br><span class="line">                  root /usr/share/nginx/html;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      `;</span><br><span class="line"></span><br><span class="line">      const payload = parseNginx(conf, &#123; comments: true &#125;);</span><br><span class="line">      console.log(JSON.stringify(payload, null, 2));</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nginx-builder.js</span><br><span class="line"></span><br><span class="line">// nginx config builder (browser version)</span><br><span class="line">// ç”¨æ³•ï¼š</span><br><span class="line">//   import &#123; build, buildFiles &#125; from &#x27;./nginx-builder.js&#x27;;</span><br><span class="line">//   const txt = build(payload, &#123; indent:4, tabs:false, header:true &#125;);</span><br><span class="line"></span><br><span class="line">const EXTERNAL_BUILDERS = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// ä¸ Python ç‰ˆè¡Œä¸ºå®Œå…¨ä¸€è‡´çš„è½¬ä¹‰æ£€æµ‹</span><br><span class="line">function* _escape(string) &#123;</span><br><span class="line">  let prev = &#x27;&#x27;, char = &#x27;&#x27;;</span><br><span class="line">  for (let i = 0; i &lt; string.length; i++) &#123;</span><br><span class="line">    char = string[i];</span><br><span class="line">    if (prev === &#x27;\\&#x27; || prev + char === &#x27;$&#123;&#x27;) &#123;</span><br><span class="line">      prev += char;</span><br><span class="line">      yield prev;</span><br><span class="line">      prev = &#x27;&#x27;;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    if (prev === &#x27;$&#x27;) yield prev;</span><br><span class="line">    if (char !== &#x27;\\&#x27; &amp;&amp; char !== &#x27;$&#x27;) yield char;</span><br><span class="line">    prev = char;</span><br><span class="line">  &#125;</span><br><span class="line">  if (char === &#x27;\\&#x27; || char === &#x27;$&#x27;) yield char;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _needsQuotes(str) &#123;</span><br><span class="line">  if (str === &#x27;&#x27;) return true;</span><br><span class="line">  const gen = _escape(str);</span><br><span class="line">  // é¦–å­—ç¬¦</span><br><span class="line">  let &#123; value: char, done &#125; = gen.next();</span><br><span class="line">  if (done) return false;</span><br><span class="line">  if (/\s/.test(char) || [&#x27;&#123;&#x27;, &#x27;&#125;&#x27;, &#x27;;&#x27;, &#x27;&quot;&#x27;, &quot;&#x27;&quot;, &#x27;$&#123;&#x27;].includes(char)) return true;</span><br><span class="line"></span><br><span class="line">  let expanding = false;</span><br><span class="line">  for (const ch of gen) &#123;</span><br><span class="line">    if (/\s/.test(ch) || [&#x27;&#123;&#x27;, &#x27;;&#x27;, &#x27;&quot;&#x27;, &quot;&#x27;&quot;].includes(ch)) return true;</span><br><span class="line">    if (ch === (expanding ? &#x27;&#125;&#x27; : &#x27;$&#123;&#x27;)) expanding = !expanding;</span><br><span class="line">  &#125;</span><br><span class="line">  return expanding;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æŠŠå­—ç¬¦ä¸²è½¬æˆ nginx å¯è¯†åˆ«çš„å¸¦å¼•å·æ ¼å¼</span><br><span class="line">function _enquote(arg) &#123;</span><br><span class="line">  if (arg == null) return &#x27;&quot;&quot;&#x27;;          // æ–°å¢ï¼šç©ºå‚æ•°ç›´æ¥ç»™ &quot;&quot;</span><br><span class="line">  if (!_needsQuotes(arg)) return arg;</span><br><span class="line">  // æµè§ˆå™¨é‡Œ repr ç­‰ä»· JSON.stringify åå»å¤´å°¾å¼•å·å†è‡ªå·±åŠ </span><br><span class="line">  let s = JSON.stringify(arg);</span><br><span class="line">  // JSON ä¼šæŠŠ \ å˜æˆ \\ï¼Œæˆ‘ä»¬éœ€è¦å• \</span><br><span class="line">  s = s.replace(/\\\\/g, &#x27;\\&#x27;);</span><br><span class="line">  // å†åŒ…ä¸€å±‚å¼•å·</span><br><span class="line">  return `&quot;$&#123;s.slice(1, -1)&#125;&quot;`;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * å°† payload æ„å»ºæˆå­—ç¬¦ä¸²</span><br><span class="line"> * @param &#123;Array&#125; payload  å¯¹åº” python é‡Œçš„ parsed æ•°ç»„</span><br><span class="line"> * @param &#123;Object&#125; opts</span><br><span class="line"> *        indent:number     ç¼©è¿›ç©ºæ ¼æ•°</span><br><span class="line"> *        tabs:boolean      ç”¨ tab ä»£æ›¿ç©ºæ ¼</span><br><span class="line"> *        header:boolean    æ˜¯å¦å¸¦ç”Ÿæˆå¤´æ³¨é‡Š</span><br><span class="line"> * @returns &#123;string&#125;  nginx æ–‡æœ¬</span><br><span class="line"> */</span><br><span class="line">export function build(payload, &#123; indent = 4, tabs = false, header = false &#125; = &#123;&#125;) &#123;</span><br><span class="line">  const padChar = tabs ? &#x27;\t&#x27; : &#x27; &#x27;;</span><br><span class="line">  const padding = (d) =&gt; padChar.repeat(tabs ? d : d * indent);</span><br><span class="line"></span><br><span class="line">  let head = &#x27;&#x27;;</span><br><span class="line">  if (header) &#123;</span><br><span class="line">    head += &#x27;# This config was built from JSON using NGINX crossplane.\n&#x27;;</span><br><span class="line">    head += &#x27;# If you encounter any bugs please report them here:\n&#x27;;</span><br><span class="line">    head += &#x27;# https://github.com/nginxinc/crossplane/issues\n\n&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _buildBlock(block, depth, lastLine) &#123;</span><br><span class="line">    let out = &#x27;&#x27;;</span><br><span class="line">    const margin = padding(depth);</span><br><span class="line"></span><br><span class="line">    for (const stmt of block) &#123;</span><br><span class="line">      const dir = _enquote(stmt.directive ?? stmt.cmd ?? &#x27;&#x27;);</span><br><span class="line">      const line = stmt.line || 0;</span><br><span class="line"></span><br><span class="line">      // è¡Œå°¾æ³¨é‡Šåˆå¹¶</span><br><span class="line">      if (dir === &#x27;#&#x27; &amp;&amp; line === lastLine) &#123;</span><br><span class="line">        out += &#x27; #&#x27; + stmt.comment;</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line">      if (dir === &#x27;#&#x27;) &#123;</span><br><span class="line">        out += (out ? &#x27;\n&#x27; : &#x27;&#x27;) + margin + &#x27;#&#x27; + stmt.comment;</span><br><span class="line">        lastLine = line;</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // å¤–éƒ¨è‡ªå®šä¹‰æ„é€ å™¨</span><br><span class="line">      if (EXTERNAL_BUILDERS[dir]) &#123;</span><br><span class="line">        out += (out ? &#x27;\n&#x27; : &#x27;&#x27;) + margin + EXTERNAL_BUILDERS[dir](stmt, padding, indent, tabs);</span><br><span class="line">        lastLine = line;</span><br><span class="line">        continue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // æ™®é€šæŒ‡ä»¤</span><br><span class="line">      const args = (stmt.args ?? stmt.arguments ?? []).map(_enquote);</span><br><span class="line">      let built;</span><br><span class="line">      if (dir === &#x27;if&#x27;) &#123;</span><br><span class="line">        built = `if ($&#123;args.join(&#x27; &#x27;)&#125;)`;</span><br><span class="line">      &#125; else if (args.length) &#123;</span><br><span class="line">        built = `$&#123;dir&#125; $&#123;args.join(&#x27; &#x27;)&#125;`;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        built = dir;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (stmt.block == null) &#123;</span><br><span class="line">        built += &#x27;;&#x27;;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        built += &#x27; &#123;&#x27;;</span><br><span class="line">        const inner = _buildBlock(stmt.block, depth + 1, line);</span><br><span class="line">        built += inner + &#x27;\n&#x27; + margin + &#x27;&#125;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      out += (out ? &#x27;\n&#x27; : &#x27;&#x27;) + margin + built;</span><br><span class="line">      lastLine = line;</span><br><span class="line">    &#125;</span><br><span class="line">    return out;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const body = _buildBlock(payload, 0, 0);</span><br><span class="line">  return head + body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * ä¸ºæµè§ˆå™¨å‡†å¤‡çš„â€œå†™ç›˜â€å°è£…ï¼šè¿”å› filename =&gt; content çš„ Map</span><br><span class="line"> * @param &#123;Object&#125; payload   crossplane.parse çš„å®Œæ•´è¾“å‡º</span><br><span class="line"> * @param &#123;Object&#125; opts      åŒ build å‡½æ•°</span><br><span class="line"> * @returns &#123;Map&#125;            key=ç»å¯¹è·¯å¾„ï¼Œvalue=æ–‡æœ¬</span><br><span class="line"> */</span><br><span class="line">export function buildFiles(payload, &#123; indent = 4, tabs = false, header = false &#125; = &#123;&#125;) &#123;</span><br><span class="line">  const map = new Map();</span><br><span class="line">  for (const config of payload.config) &#123;</span><br><span class="line">    const content = build(config.parsed, &#123; indent, tabs, header &#125;);</span><br><span class="line">    map.set(config.file, content.replace(/\n+$/, &#x27;\n&#x27;)); // ä¿è¯æœ«å°¾ä¸€ä¸ªæ¢è¡Œ</span><br><span class="line">  &#125;</span><br><span class="line">  return map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ³¨å†Œç¬¬ä¸‰æ–¹æ„é€ å™¨</span><br><span class="line"> * @param &#123;Function&#125; builder     function(stmt, padding, indent, tabs)-&gt;string</span><br><span class="line"> * @param &#123;Array&lt;string&gt;&#125; dirs   æŒ‡ä»¤åˆ—è¡¨</span><br><span class="line"> */</span><br><span class="line">export function registerExternalBuilder(builder, dirs) &#123;</span><br><span class="line">  dirs.forEach(d =&gt; &#123; EXTERNAL_BUILDERS[d] = builder; &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;script type=&quot;module&quot;&gt;</span><br><span class="line">      import &#123; build, buildFiles &#125; from &quot;./nginx-builder.js&quot;;</span><br><span class="line"></span><br><span class="line">      const payload = &#123;</span><br><span class="line">        config: [</span><br><span class="line">          &#123;</span><br><span class="line">            file: &quot;/etc/nginx/nginx.conf&quot;,</span><br><span class="line">            parsed: [</span><br><span class="line">              &#123;</span><br><span class="line">                directive: &quot;user&quot;,</span><br><span class="line">                line: 2,</span><br><span class="line">                args: [&quot;nginx&quot;],</span><br><span class="line">                file: &quot;nginx.conf&quot;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                directive: &quot;worker_processes&quot;,</span><br><span class="line">                line: 3,</span><br><span class="line">                args: [&quot;auto&quot;],</span><br><span class="line">                file: &quot;nginx.conf&quot;,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                directive: &quot;events&quot;,</span><br><span class="line">                line: 5,</span><br><span class="line">                args: [],</span><br><span class="line">                file: &quot;nginx.conf&quot;,</span><br><span class="line">                block: [</span><br><span class="line">                  &#123;</span><br><span class="line">                    directive: &quot;worker_connections&quot;,</span><br><span class="line">                    line: 6,</span><br><span class="line">                    args: [&quot;1024&quot;],</span><br><span class="line">                    file: &quot;nginx.conf&quot;,</span><br><span class="line">                  &#125;,</span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                directive: &quot;http&quot;,</span><br><span class="line">                line: 9,</span><br><span class="line">                args: [],</span><br><span class="line">                file: &quot;nginx.conf&quot;,</span><br><span class="line">                block: [</span><br><span class="line">                  &#123;</span><br><span class="line">                    directive: &quot;include&quot;,</span><br><span class="line">                    line: 10,</span><br><span class="line">                    args: [&quot;mime.types&quot;],</span><br><span class="line">                    file: &quot;nginx.conf&quot;,</span><br><span class="line">                    includes: [],</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                    directive: &quot;default_type&quot;,</span><br><span class="line">                    line: 11,</span><br><span class="line">                    args: [&quot;application/octet-stream&quot;],</span><br><span class="line">                    file: &quot;nginx.conf&quot;,</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                    directive: &quot;server&quot;,</span><br><span class="line">                    line: 13,</span><br><span class="line">                    args: [],</span><br><span class="line">                    file: &quot;nginx.conf&quot;,</span><br><span class="line">                    block: [</span><br><span class="line">                      &#123;</span><br><span class="line">                        directive: &quot;listen&quot;,</span><br><span class="line">                        line: 14,</span><br><span class="line">                        args: [&quot;80&quot;],</span><br><span class="line">                        file: &quot;nginx.conf&quot;,</span><br><span class="line">                      &#125;,</span><br><span class="line">                      &#123;</span><br><span class="line">                        directive: &quot;location&quot;,</span><br><span class="line">                        line: 15,</span><br><span class="line">                        args: [&quot;/&quot;],</span><br><span class="line">                        file: &quot;nginx.conf&quot;,</span><br><span class="line">                        block: [</span><br><span class="line">                          &#123;</span><br><span class="line">                            directive: &quot;root&quot;,</span><br><span class="line">                            line: 16,</span><br><span class="line">                            args: [&quot;/usr/share/nginx/html&quot;],</span><br><span class="line">                            file: &quot;nginx.conf&quot;,</span><br><span class="line">                          &#125;,</span><br><span class="line">                        ],</span><br><span class="line">                      &#125;,</span><br><span class="line">                    ],</span><br><span class="line">                  &#125;,</span><br><span class="line">                ],</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      // 1. åªæ‹¿æ–‡æœ¬</span><br><span class="line">      const txt = build(payload.config[0].parsed, &#123; header: true &#125;);</span><br><span class="line">      console.log(txt);</span><br><span class="line"></span><br><span class="line">      // 2. æ‹¿å…¨éƒ¨æ–‡ä»¶</span><br><span class="line">      const fileMap = buildFiles(payload);</span><br><span class="line">      for (const [name, content] of fileMap) &#123;</span><br><span class="line">        console.log(&quot;===&quot;, name, &quot;===&quot;);</span><br><span class="line">        console.log(content);</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/23/%E6%8A%93%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/23/%E6%8A%93%E5%8C%85/" class="post-title-link" itemprop="url">æŠ“9000 ç«¯å£ ä¸Šçš„è¯·æ±‚</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-10-23 17:03:14 / ä¿®æ”¹æ—¶é—´ï¼š17:18:10" itemprop="dateCreated datePublished" datetime="2025-10-23T17:03:14+08:00">2025-10-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%93%E5%8C%85/" itemprop="url" rel="index"><span itemprop="name">æŠ“åŒ…</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>192.168.40.116 æœºå™¨ä¸Š</p>
<p>ip a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:94:5c:7f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.40.116/24 brd 192.168.40.255 scope global noprefixroute ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 172.17.10.10/24 scope global ens192</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 2408:8606:8400:30a:6::41/128 scope global noprefixroute dynamic</span><br><span class="line">       valid_lft 6018sec preferred_lft 5718sec</span><br><span class="line">    inet6 fe80::d6f6:f5f6:1e6c:cf29/64 scope link noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:26:ce:e5 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ens192 ä¸ºé»˜è®¤ç½‘å¡</p>
<p>sudo tcpdump â€˜port 9000â€™ -w a.cap -i ens192</p>
<p>ç›‘å¬ 9000 ç«¯å£ ä¸Šçš„è¯·æ±‚ï¼ŒæŒ‡å®š ç½‘å¡ ä¸º ens192 å¹¶å°†å…¶ä¿å­˜åˆ° a.cap æ–‡ä»¶ä¸­</p>
<p>ä¸‹è½½ a.cap æ–‡ä»¶</p>
<p>å°†å…¶ æ‹‰å…¥åˆ° wireshark è¿›è¡Œåˆ†æ</p>
<p>sudo ln -s &#x2F;Applications&#x2F;Wireshark.app&#x2F;Contents&#x2F;MacOS&#x2F;Wireshark &#x2F;usr&#x2F;local&#x2F;bin&#x2F;wireshark</p>
<p>wireshark a.cap</p>
<p>ä¹Ÿå¯ä»¥å°† a.cap æ–‡ä»¶æ‹‰å…¥åˆ° wireshark ä¸­è¿›è¡ŒæŸ¥çœ‹</p>
<p><img src="/../images/wireshark/01.png"></p>
<p><img src="/../images/wireshark/02.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/13/sekiro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/13/sekiro/" class="post-title-link" itemprop="url">sekiro - jsé€†å‘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-13 15:47:06" itemprop="dateCreated datePublished" datetime="2025-08-13T15:47:06+08:00">2025-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-23 17:02:14" itemprop="dateModified" datetime="2025-10-23T17:02:14+08:00">2025-10-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å®‰è£…ï¼šsekiro</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">docker run -d --name sekiro -p 5612:5612 \</span><br><span class="line">  registry.cn-beijing.aliyuncs.com/iinti/common:sekiro-all-in-one-latest</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ä¸­ç™»å½•ï¼š<br><a target="_blank" rel="noopener" href="http://127.0.0.1:5612/#/">http://127.0.0.1:5612/#/</a></p>
<p>æ‰“å¼€æŸç½‘é¡µï¼Œåœ¨æµè§ˆå™¨ console ä¸­è¾“å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">function SekiroClient(e)&#123;if(this.wsURL=e,this.handlers=&#123;&#125;,this.socket=&#123;&#125;,!e)throw new Error(&quot;wsURL can not be empty!!&quot;);this.webSocketFactory=this.resolveWebSocketFactory(),this.connect()&#125;SekiroClient.prototype.resolveWebSocketFactory=function()&#123;if(&quot;object&quot;==typeof window)&#123;var e=window.WebSocket?window.WebSocket:window.MozWebSocket;return function(o)&#123;function t(o)&#123;this.mSocket=new e(o)&#125;return t.prototype.close=function()&#123;this.mSocket.close()&#125;,t.prototype.onmessage=function(e)&#123;this.mSocket.onmessage=e&#125;,t.prototype.onopen=function(e)&#123;this.mSocket.onopen=e&#125;,t.prototype.onclose=function(e)&#123;this.mSocket.onclose=e&#125;,t.prototype.send=function(e)&#123;this.mSocket.send(e)&#125;,new t(o)&#125;&#125;if(&quot;object&quot;==typeof weex)try&#123;console.log(&quot;test webSocket for weex&quot;);var o=weex.requireModule(&quot;webSocket&quot;);return console.log(&quot;find webSocket for weex:&quot;+o),function(e)&#123;try&#123;o.close()&#125;catch(e)&#123;&#125;return o.WebSocket(e,&quot;&quot;),o&#125;&#125;catch(e)&#123;console.log(e)&#125;if(&quot;object&quot;==typeof WebSocket)return function(o)&#123;return new e(o)&#125;;throw new Error(&quot;the js environment do not support websocket&quot;)&#125;,SekiroClient.prototype.connect=function()&#123;console.log(&quot;sekiro: begin of connect to wsURL: &quot;+this.wsURL);var e=this;try&#123;this.socket=this.webSocketFactory(this.wsURL)&#125;catch(o)&#123;return console.log(&quot;sekiro: create connection failed,reconnect after 2s:&quot;+o),void setTimeout(function()&#123;e.connect()&#125;,2e3)&#125;this.socket.onmessage(function(o)&#123;e.handleSekiroRequest(o.data)&#125;),this.socket.onopen(function(e)&#123;console.log(&quot;sekiro: open a sekiro client connection&quot;)&#125;),this.socket.onclose(function(o)&#123;console.log(&quot;sekiro: disconnected ,reconnection after 2s&quot;),setTimeout(function()&#123;e.connect()&#125;,2e3)&#125;)&#125;,SekiroClient.prototype.handleSekiroRequest=function(e)&#123;console.log(&quot;receive sekiro request: &quot;+e);var o=JSON.parse(e),t=o.__sekiro_seq__;if(o.action)&#123;var n=o.action;if(this.handlers[n])&#123;var s=this.handlers[n],i=this;try&#123;s(o,function(e)&#123;try&#123;i.sendSuccess(t,e)&#125;catch(e)&#123;i.sendFailed(t,&quot;e:&quot;+e)&#125;&#125;,function(e)&#123;i.sendFailed(t,e)&#125;)&#125;catch(e)&#123;console.log(&quot;error: &quot;+e),i.sendFailed(t,&quot;:&quot;+e)&#125;&#125;else this.sendFailed(t,&quot;no action handler: &quot;+n+&quot; defined&quot;)&#125;else this.sendFailed(t,&quot;need request param &#123;action&#125;&quot;)&#125;,SekiroClient.prototype.sendSuccess=function(e,o)&#123;var t;if(&quot;string&quot;==typeof o)try&#123;t=JSON.parse(o)&#125;catch(e)&#123;(t=&#123;&#125;).data=o&#125;else&quot;object&quot;==typeof o?t=o:(t=&#123;&#125;).data=o;(Array.isArray(t)||&quot;string&quot;==typeof t)&amp;&amp;(t=&#123;data:t,code:0&#125;),t.code?t.code=0:(t.status,t.status=0),t.__sekiro_seq__=e;var n=JSON.stringify(t);console.log(&quot;response :&quot;+n),this.socket.send(n)&#125;,SekiroClient.prototype.sendFailed=function(e,o)&#123;&quot;string&quot;!=typeof o&amp;&amp;(o=JSON.stringify(o));var t=&#123;&#125;;t.message=o,t.status=-1,t.__sekiro_seq__=e;var n=JSON.stringify(t);console.log(&quot;sekiro: response :&quot;+n),this.socket.send(n)&#125;,SekiroClient.prototype.registerAction=function(e,o)&#123;if(&quot;string&quot;!=typeof e)throw new Error(&quot;an action must be string&quot;);if(&quot;function&quot;!=typeof o)throw new Error(&quot;a handler must be function&quot;);return console.log(&quot;sekiro: register action: &quot;+e),this.handlers[e]=o,this&#125;;</span><br><span class="line">var client = new SekiroClient(&quot;ws://127.0.0.1:5612/business/register?group=testAction&amp;clientId=&quot; + Math.random());</span><br><span class="line">client.registerAction(&quot;testAction&quot;, function (request, resolve, reject) &#123;</span><br><span class="line"></span><br><span class="line">    resolve(Math.random());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š</p>
<p><a target="_blank" rel="noopener" href="http://localhost:5612/business/invoke?group=testAction&action=testAction&param=testparm">http://localhost:5612/business/invoke?group=testAction&amp;action=testAction&amp;param=testparm</a></p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://sekiro.iinti.cn/sekiro-doc/">https://sekiro.iinti.cn/sekiro-doc/</a><br>å‚è€ƒè§†é¢‘ï¼š<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16U4y1B7PA/?spm_id_from=333.1387.favlist.content.click&vd_source=ffda878df0ed45bee1ade91d8f451048">https://www.bilibili.com/video/BV16U4y1B7PA/?spm_id_from=333.1387.favlist.content.click&amp;vd_source=ffda878df0ed45bee1ade91d8f451048</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/07/vite-monorepo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/07/vite-monorepo/" class="post-title-link" itemprop="url">vite+monorepo</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-07 17:54:52 / ä¿®æ”¹æ—¶é—´ï¼š17:56:44" itemprop="dateCreated datePublished" datetime="2025-08-07T17:54:52+08:00">2025-08-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æ··åˆé¡¹ç›®ç»“æ„ï¼Œæ‰€æœ‰ç›¸å…³çš„å·¥ç¨‹å½¢æˆå­åŒ…è¿›è¡Œç®¡ç†<br>æŠ€æœ¯æ ˆé«˜åº¦ç»Ÿä¸€ï¼Œ(å›¢é˜ŸåŸºå»ºé¡¹ç›®ã€ä¸šåŠ¡é¡¹ç›®ã€å­æœåŠ¡ï¼ŒæŠ€æœ¯æ ˆ)è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–ã€æµç¨‹åŒ–é¡¹ç›®é—´å…±äº«<br>ä¾èµ–ç®¡ç†ï¼Œç‰ˆæœ¬ç»Ÿ-ç®¡ç†<br>éƒ¨ç½²ï¼Œdockerã€docker composeï¼Œè‡ªåŠ¨åŒ–è„šæœ¬ç»Ÿ-éƒ¨ç½²æµç¨‹</p>
<p>å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1UePTeqEu6/?spm_id_from=333.1387.favlist.content.click">https://www.bilibili.com/video/BV1UePTeqEu6/?spm_id_from=333.1387.favlist.content.click</a><br><a target="_blank" rel="noopener" href="https://github.com/robcaldecott/pnpm-vite-monorepo-example">https://github.com/robcaldecott/pnpm-vite-monorepo-example</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/13/%E5%90%B4%E6%81%A9%E8%BE%BE%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/13/%E5%90%B4%E6%81%A9%E8%BE%BE%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">å´æ©è¾¾ç®—æ³•</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-13 09:37:07" itemprop="dateCreated datePublished" datetime="2025-05-13T09:37:07+08:00">2025-05-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/10/tfjs-study6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/10/tfjs-study6/" class="post-title-link" itemprop="url">tfjs-study6</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-10 15:31:07 / ä¿®æ”¹æ—¶é—´ï¼š16:48:31" itemprop="dateCreated datePublished" datetime="2025-05-10T15:31:07+08:00">2025-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="python-ä¸-javascript-äº’è½¬"><a href="#python-ä¸-javascript-äº’è½¬" class="headerlink" title="python ä¸ javascript äº’è½¬"></a>python ä¸ javascript äº’è½¬</h2><p>python æ¨¡å‹ï¼š<br>é€šè¿‡ python ç‰ˆ TensorFlow&#x2F;Keras ç”Ÿæˆæ¨¡å‹</p>
<p>åŒ…æ‹¬ï¼š TensorFlow SavedModelã€Keras HDF5 æ¨¡å‹ ç­‰</p>
<p>è·å–ï¼šå¼€æºç½‘ç«™ä¸‹è½½&#x2F;ç®—æ³•åŒäº‹æä¾›</p>
<p>javascript æ¨¡å‹ï¼š</p>
<p>å¯ä»¥åœ¨ TensorFlowJSä¸­è¿è¡Œçš„æ¨¡å‹</p>
<p>åŒ…æ‹¬ï¼š tfjs_layers_model.jsonã€tfjs_graph_model.jsonã€tfjs_weights.bin ç­‰</p>
<p>è·å–ï¼šå¼€æºç½‘ç«™ä¸‹è½½&#x2F;é€šè¿‡TFJSç”Ÿæˆ&#x2F;ç”±python æ¨¡å‹è½¬æ¢è€Œæ¥</p>
<p>ä¸ºä½•è¦è¿›è¡Œäº’è½¬?<br>Python to JavaScript:JavaScriptæ¨¡å‹å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ</p>
<p>JavaScript to Python:å°‘è§,ä¸ºäº†åœ¨æ›´å¤šå¹³å°è¿è¡Œ</p>
<p>JavaScript to JavaScript:åˆ†ç‰‡&#x2F;é‡åŒ–&#x2F;åŠ é€Ÿ</p>
<p>å¦‚ä½•è¿›è¡Œäº’è½¬?<br>å®‰è£…Tensorflow.js Converter<br>åœ¨å‘½ä»¤è¡ŒæŒ‡å®šè¾“å…¥è¾“å‡ºçš„è·¯å¾„å’Œæ¨¡å‹æ ¼å¼å³å¯</p>
<p>æ“ä½œæ­¥éª¤<br>å®‰è£…Tensorflow.js Converter<br>Pythonä¸JavaScriptæ¨¡å‹äº’è½¬<br>JavaScriptæ¨¡å‹çš„äº’è½¬:åˆ†ç‰‡ã€é‡åŒ–ã€åŠ é€Ÿ</p>
<p>å®‰è£…Tensorflow.js Converter</p>
<p>æ“ä½œæ­¥éª¤<br>å®‰è£…Conda<br>ä½¿ç”¨Condaå®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒ<br>ä½¿ç”¨Pythonè™šæ‹Ÿç¯å¢ƒå®‰è£…Tensorflow.jsConverter</p>
<p><img src="/../images/tfjs/69.png"></p>
<p><img src="/../images/tfjs/70.png"></p>
<p><img src="/../images/tfjs/71.png"></p>
<p><img src="/../images/tfjs/72.png"></p>
<p><img src="/../images/tfjs/73.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/10/tfjs-study5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/10/tfjs-study5/" class="post-title-link" itemprop="url">tfjs-study5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-10 14:23:22 / ä¿®æ”¹æ—¶é—´ï¼š16:25:42" itemprop="dateCreated datePublished" datetime="2025-05-10T14:23:22+08:00">2025-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«"><a href="#ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«" class="headerlink" title="ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«"></a>ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«</h2><p>æ¨¡å‹æ¥å—å£°éŸ³ä¿¡æ¯ï¼Œè¾“å‡ºåˆ†ç±»ä¿¡æ¯<br>å£°éŸ³åœ¨è®¡ç®—æœºé‡Œæ˜¯å£°è°±å›¾ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œè¿›è¡Œè¯†åˆ«</p>
<p><img src="/../images/tfjs/65.png"></p>
<p><img src="/../images/tfjs/66.png"></p>
<p><img src="/../images/tfjs/67.png"></p>
<p><img src="/../images/tfjs/68.png"></p>
<p>script.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import * as speechCommands from &#x27;@tensorflow-models/speech-commands&#x27;;</span><br><span class="line"></span><br><span class="line">const MODEL_PATH = &#x27;http://127.0.0.1:8080/speech&#x27;;</span><br><span class="line"></span><br><span class="line">window.onload = async () =&gt; &#123;</span><br><span class="line">    const recognizer = speechCommands.create(</span><br><span class="line">        &#x27;BROWSER_FFT&#x27;,</span><br><span class="line">        null,</span><br><span class="line">        MODEL_PATH + &#x27;/model.json&#x27;,</span><br><span class="line">        MODEL_PATH + &#x27;/metadata.json&#x27;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    await recognizer.ensureModelLoaded();</span><br><span class="line"></span><br><span class="line">    const labels = recognizer.wordLabels().slice(2); //</span><br><span class="line">    const resultEl = document.querySelector(&#x27;#result&#x27;);</span><br><span class="line">    resultEl.innerHTML = labels.map(l =&gt; `</span><br><span class="line">        &lt;div&gt;$&#123;l&#125;&lt;/div&gt;</span><br><span class="line">    `).join(&#x27;&#x27;);</span><br><span class="line">    recognizer.listen(result =&gt; &#123; //ä¼šæ‰“å¼€æµè§ˆå™¨éº¦å…‹é£</span><br><span class="line">        const &#123; scores &#125; = result;</span><br><span class="line">        const maxValue = Math.max(...scores);</span><br><span class="line">        const index = scores.indexOf(maxValue) - 2;</span><br><span class="line">        resultEl.innerHTML = labels.map((l, i) =&gt; `</span><br><span class="line">        &lt;div style=&quot;background: $&#123;i === index &amp;&amp; &#x27;green&#x27;&#125;&quot;&gt;$&#123;l&#125;&lt;/div&gt;</span><br><span class="line">        `).join(&#x27;&#x27;);</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        overlapFactor: 0.3, //é‡å </span><br><span class="line">        probabilityThreshold: 0.9 // ç½®ä¿¡åº¦</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<p>index.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    #result&gt;div &#123;</span><br><span class="line">        float: left;</span><br><span class="line">        padding: 20px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div id=&quot;result&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="åŸºäºè¿ç§»å­¦ä¹ çš„è¯­éŸ³è¯†åˆ«å™¨ï¼šå£°æ§è½®æ’­å›¾"><a href="#åŸºäºè¿ç§»å­¦ä¹ çš„è¯­éŸ³è¯†åˆ«å™¨ï¼šå£°æ§è½®æ’­å›¾" class="headerlink" title="åŸºäºè¿ç§»å­¦ä¹ çš„è¯­éŸ³è¯†åˆ«å™¨ï¼šå£°æ§è½®æ’­å›¾"></a>åŸºäºè¿ç§»å­¦ä¹ çš„è¯­éŸ³è¯†åˆ«å™¨ï¼šå£°æ§è½®æ’­å›¾</h2><p>åœ¨æµè§ˆå™¨ä¸­æ”¶é›†ä¸­æ–‡è¯­éŸ³è®­ç»ƒæ•°æ®</p>
<p>ä½¿ç”¨ speech commands ï¼ˆè‹±æ–‡è¯­éŸ³è¯†åˆ«ï¼‰ åŒ…è¿›è¡Œè¿ç§»å­¦ä¹ å¹¶é¢„æµ‹ ä¸­æ–‡è¯­éŸ³</p>
<p>è¯­éŸ³è®­ç»ƒæ•°æ®çš„ä¿å­˜å’ŒåŠ è½½</p>
<p>æ“ä½œæ­¥éª¤</p>
<p>ä½¿ç”¨ speech commands åŒ…åˆ›å»ºè¿ç§»å­¦ä¹ å™¨<br>ç¼–å†™å‰ç«¯ç•Œé¢å‡†å¤‡æ”¶é›†è¯­éŸ³æ•°æ®<br>è°ƒç”¨collectExampleå‡½æ•°æ”¶é›†è¯­éŸ³æ•°æ®</p>
<p><img src="/../images/tfjs/68.png"></p>
<p>index.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;button onclick=&quot;collect(this)&quot;&gt;ä¸Šä¸€å¼ &lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;collect(this)&quot;&gt;ä¸‹ä¸€å¼ &lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;collect(this)&quot;&gt;èƒŒæ™¯å™ªéŸ³&lt;/button&gt;</span><br><span class="line">&lt;button onclick=&quot;save()&quot;&gt;ä¿å­˜&lt;/button&gt;</span><br><span class="line">&lt;pre id=&quot;count&quot;&gt;&lt;/pre&gt;</span><br><span class="line">&lt;button onclick=&quot;train()&quot;&gt;è®­ç»ƒ&lt;/button&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">ç›‘å¬å¼€å…³ï¼š&lt;input type=&quot;checkbox&quot; onchange=&quot;toggle(this.checked)&quot;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>script.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">import * as speechCommands from &#x27;@tensorflow-models/speech-commands&#x27;;</span><br><span class="line">import * as tfvis from &#x27;@tensorflow/tfjs-vis&#x27;;</span><br><span class="line"></span><br><span class="line">const MODEL_PATH = &#x27;http://127.0.0.1:8080&#x27;;</span><br><span class="line">let transferRecognizer;</span><br><span class="line"></span><br><span class="line">window.onload = async () =&gt; &#123;</span><br><span class="line">    const recognizer = speechCommands.create(</span><br><span class="line">        &#x27;BROWSER_FFT&#x27;,</span><br><span class="line">        null,</span><br><span class="line">        MODEL_PATH + &#x27;/speech/model.json&#x27;,</span><br><span class="line">        MODEL_PATH + &#x27;/speech/metadata.json&#x27;</span><br><span class="line">    );</span><br><span class="line">    await recognizer.ensureModelLoaded(); // åŠ è½½æ¨¡å‹</span><br><span class="line">    transferRecognizer = recognizer.createTransfer(&#x27;è½®æ’­å›¾&#x27;); // åˆ›å»ºä¸€ä¸ªè®­ç»ƒå™¨</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.collect = async (btn) =&gt; &#123;</span><br><span class="line">    btn.disabled = true;</span><br><span class="line">    const label = btn.innerText;</span><br><span class="line">    await transferRecognizer.collectExample( //  æ”¶é›†æ ·æœ¬</span><br><span class="line">        label === &#x27;èƒŒæ™¯å™ªéŸ³&#x27; ? &#x27;_background_noise_&#x27; : label</span><br><span class="line">    );</span><br><span class="line">    btn.disabled = false;</span><br><span class="line">    document.querySelector(&#x27;#count&#x27;).innerHTML = JSON.stringify(transferRecognizer.countExamples(), null, 2);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.train = async () =&gt; &#123;</span><br><span class="line">    await transferRecognizer.train(&#123;</span><br><span class="line">        epochs: 30,</span><br><span class="line">        callback: tfvis.show.fitCallbacks(</span><br><span class="line">            &#123; name: &#x27;è®­ç»ƒæ•ˆæœ&#x27; &#125;,</span><br><span class="line">            [&#x27;loss&#x27;, &#x27;acc&#x27;],</span><br><span class="line">            &#123; callbacks: [&#x27;onEpochEnd&#x27;] &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.toggle = async (checked) =&gt; &#123;</span><br><span class="line">    if (checked) &#123;</span><br><span class="line">        await transferRecognizer.listen(result =&gt; &#123; // ç›‘å¬</span><br><span class="line">            const &#123; scores &#125; = result;</span><br><span class="line">            const labels = transferRecognizer.wordLabels();</span><br><span class="line">            const index = scores.indexOf(Math.max(...scores));</span><br><span class="line">            console.log(labels[index]);</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            overlapFactor: 0,</span><br><span class="line">            probabilityThreshold: 0.75</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        transferRecognizer.stopListening();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.save = () =&gt; &#123;</span><br><span class="line">    const arrayBuffer = transferRecognizer.serializeExamples(); //æŠŠé‡‡é›†å¥½çš„æ•°æ®å­˜ä¸‹æ¥</span><br><span class="line">    const blob = new Blob([arrayBuffer]);</span><br><span class="line">    const link = document.createElement(&#x27;a&#x27;);</span><br><span class="line">    link.href = window.URL.createObjectURL(blob);</span><br><span class="line">    link.download = &#x27;data.bin&#x27;;</span><br><span class="line">    link.click();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="è½®æ’­å›¾"><a href="#è½®æ’­å›¾" class="headerlink" title="è½®æ’­å›¾"></a>è½®æ’­å›¾</h2><p>index.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;script.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">ç›‘å¬å¼€å…³ï¼š&lt;input type=&quot;checkbox&quot; onchange=&quot;toggle(this.checked)&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .slider &#123;</span><br><span class="line">        width: 600px;</span><br><span class="line">        overflow: hidden;</span><br><span class="line">        margin: 10px auto;</span><br><span class="line">    &#125;</span><br><span class="line">    .slider &gt; div&#123;</span><br><span class="line">        display: flex;</span><br><span class="line">        align-items: center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class=&quot;slider&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/10/29/15/57/vancouver-4587302__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/10/31/07/14/coffee-4591159__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/11/01/11/08/landscape-4593909__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/11/02/21/45/maple-leaf-4597501__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/11/02/03/13/in-xinjiang-4595560__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;https://cdn.pixabay.com/photo/2019/11/01/22/45/reschensee-4595385__480.jpg&quot; alt=&quot;&quot; width=&quot;600&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>script.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import * as speechCommands from &#x27;@tensorflow-models/speech-commands&#x27;;</span><br><span class="line"></span><br><span class="line">const MODEL_PATH = &#x27;http://127.0.0.1:8080&#x27;;</span><br><span class="line">let transferRecognizer;</span><br><span class="line">let curIndex = 0;</span><br><span class="line"></span><br><span class="line">window.onload = async () =&gt; &#123;</span><br><span class="line">    const recognizer = speechCommands.create(</span><br><span class="line">        &#x27;BROWSER_FFT&#x27;,</span><br><span class="line">        null,</span><br><span class="line">        MODEL_PATH + &#x27;/speech/model.json&#x27;,</span><br><span class="line">        MODEL_PATH + &#x27;/speech/metadata.json&#x27;,</span><br><span class="line">    );</span><br><span class="line">    await recognizer.ensureModelLoaded();</span><br><span class="line">    transferRecognizer = recognizer.createTransfer(&#x27;è½®æ’­å›¾&#x27;);</span><br><span class="line">    const res = await fetch(MODEL_PATH + &#x27;/slider/data.bin&#x27;);</span><br><span class="line">    const arrayBuffer = await res.arrayBuffer();</span><br><span class="line">    transferRecognizer.loadExamples(arrayBuffer);</span><br><span class="line">    await transferRecognizer.train(&#123; epochs: 30 &#125;);</span><br><span class="line">    console.log(&#x27;done&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.toggle = async (checked) =&gt; &#123;</span><br><span class="line">    if (checked) &#123;</span><br><span class="line">        await transferRecognizer.listen(result =&gt; &#123;</span><br><span class="line">            const &#123; scores &#125; = result;</span><br><span class="line">            const labels = transferRecognizer.wordLabels();</span><br><span class="line">            const index = scores.indexOf(Math.max(...scores));</span><br><span class="line">            window.play(labels[index]);</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            overlapFactor: 0,</span><br><span class="line">            probabilityThreshold: 0.5</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        transferRecognizer.stopListening();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">window.play = (label) =&gt; &#123;</span><br><span class="line">    const div = document.querySelector(&#x27;.slider&gt;div&#x27;);</span><br><span class="line">    if (label === &#x27;ä¸Šä¸€å¼ &#x27;) &#123;</span><br><span class="line">        if (curIndex === 0) &#123; return; &#125;</span><br><span class="line">        curIndex -= 1;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (curIndex === document.querySelectorAll(&#x27;img&#x27;).length - 1) &#123; return; &#125;</span><br><span class="line">        curIndex += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    div.style.transition = &quot;transform 1s&quot;</span><br><span class="line">    div.style.transform = `translateX(-$&#123;100 * curIndex&#125;%)`;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/10/tfjs-study4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="wangzhiwei">
      <meta itemprop="description" content="javascript nodejs web developer...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/05/10/tfjs-study4/" class="post-title-link" itemprop="url">tfjs-study4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2025-05-10 10:27:08 / ä¿®æ”¹æ—¶é—´ï¼š12:05:40" itemprop="dateCreated datePublished" datetime="2025-05-10T10:27:08+08:00">2025-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="åŸºäºè¿ç§»å­¦ä¹ çš„å›¾åƒåˆ†ç±»å™¨-â€“å•†æ ‡è¯†åˆ«ä»»åŠ¡"><a href="#åŸºäºè¿ç§»å­¦ä¹ çš„å›¾åƒåˆ†ç±»å™¨-â€“å•†æ ‡è¯†åˆ«ä»»åŠ¡" class="headerlink" title="åŸºäºè¿ç§»å­¦ä¹ çš„å›¾åƒåˆ†ç±»å™¨ â€“å•†æ ‡è¯†åˆ«ä»»åŠ¡"></a>åŸºäºè¿ç§»å­¦ä¹ çš„å›¾åƒåˆ†ç±»å™¨ â€“å•†æ ‡è¯†åˆ«ä»»åŠ¡</h2><p>æŠŠå·²è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°è¿ç§»åˆ°æ–°çš„æ¨¡å‹æ¥å¸®åŠ©æ–°æ¨¡å‹è®­ç»ƒ</p>
<p>æ·±åº¦å­¦ä¹ æ¨¡å‹å‚æ•°å¤šï¼Œä»å¤´è®­ç»ƒé™ˆæœ¬é«˜</p>
<p>åˆ é™¤åŸå§‹æ¨¡å‹çš„æœ€åä¸€å±‚ï¼ŒåŸºäºæ­¤æˆªæ–­æ¨¡å‹çš„è¾“å‡ºè®­ç»ƒä¸€ä¸ªæ–°çš„ï¼ˆé€šå¸¸ç›¸å½“æµ…çš„ï¼‰æ¨¡å‹</p>
<p>åŠ è½½å•†æ ‡è®­ç»ƒæ•°æ®å¹¶å¯è§†åŒ–<br>å®šä¹‰æ¨¡å‹ç»“æ„ï¼šæˆªæ–­æ¨¡å‹ + åŒå±‚ç¥ç»ç½‘ç»œ<br>è®­ç»ƒæ¨¡å‹å¹¶é¢„æµ‹</p>
<p><img src="/../images/tfjs/61.png"></p>
<p><img src="/../images/tfjs/62.png"></p>
<p><img src="/../images/tfjs/63.png"></p>
<p><img src="/../images/tfjs/64.png"></p>
<p>data.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">const IMAGE_SIZE = 224;</span><br><span class="line"></span><br><span class="line">const loadImg = (src) =&gt; &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        const img = new Image();</span><br><span class="line">        img.crossOrigin = &quot;anonymous&quot;;</span><br><span class="line">        img.src = src;</span><br><span class="line">        img.width = IMAGE_SIZE;</span><br><span class="line">        img.height = IMAGE_SIZE;</span><br><span class="line">        img.onload = () =&gt; resolve(img);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">export const getInputs = async () =&gt; &#123;</span><br><span class="line">    const loadImgs = [];</span><br><span class="line">    const labels = [];</span><br><span class="line">    for (let i = 0; i &lt; 30; i += 1) &#123;</span><br><span class="line">        [&#x27;android&#x27;, &#x27;apple&#x27;, &#x27;windows&#x27;].forEach(label =&gt; &#123;</span><br><span class="line">            const src = `http://127.0.0.1:8080/brand/train/$&#123;label&#125;-$&#123;i&#125;.jpg`;</span><br><span class="line">            const img = loadImg(src);</span><br><span class="line">            loadImgs.push(img);</span><br><span class="line">            labels.push([</span><br><span class="line">                label === &#x27;android&#x27; ? 1 : 0,</span><br><span class="line">                label === &#x27;apple&#x27; ? 1 : 0,</span><br><span class="line">                label === &#x27;windows&#x27; ? 1 : 0,</span><br><span class="line">            ]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    const inputs = await Promise.all(loadImgs);</span><br><span class="line">    return &#123;</span><br><span class="line">        inputs,</span><br><span class="line">        labels,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>script.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import * as tf from &#x27;@tensorflow/tfjs&#x27;;</span><br><span class="line">import * as tfvis from &#x27;@tensorflow/tfjs-vis&#x27;;</span><br><span class="line">import &#123; getInputs &#125; from &#x27;./data&#x27;;</span><br><span class="line">import &#123; img2x, file2img &#125; from &#x27;./utils&#x27;;</span><br><span class="line"></span><br><span class="line">const MOBILENET_MODEL_PATH = &#x27;http://127.0.0.1:8080/mobilenet/web_model/model.json&#x27;;</span><br><span class="line">const NUM_CLASSES = 3;</span><br><span class="line">const BRAND_CLASSES = [&#x27;android&#x27;, &#x27;apple&#x27;, &#x27;windows&#x27;];</span><br><span class="line"></span><br><span class="line">window.onload = async () =&gt; &#123;</span><br><span class="line">    const &#123; inputs, labels &#125; = await getInputs();</span><br><span class="line">    const surface = tfvis.visor().surface(&#123; name: &#x27;è¾“å…¥ç¤ºä¾‹&#x27;, styles: &#123; height: 250 &#125; &#125;);</span><br><span class="line">    inputs.forEach(img =&gt; &#123;</span><br><span class="line">        surface.drawArea.appendChild(img);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const mobilenet = await tf.loadLayersModel(MOBILENET_MODEL_PATH);</span><br><span class="line">    mobilenet.summary(); // æ¨¡å‹ç»“æ„/*  */</span><br><span class="line">    const layer = mobilenet.getLayer(&#x27;conv_pw_13_relu&#x27;); //  è·å–æ¨¡å‹ä¸­é—´å±‚</span><br><span class="line">    const truncatedMobilenet = tf.model(&#123; //  æˆªæ–­æ¨¡å‹</span><br><span class="line">        inputs: mobilenet.inputs, //  è¾“å…¥å±‚</span><br><span class="line">        outputs: layer.output //  è¾“å‡ºå±‚ </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    //  åˆ›å»ºæ–°æ¨¡å‹</span><br><span class="line">    const model = tf.sequential();</span><br><span class="line"></span><br><span class="line">    console.log(layer.outputShape)</span><br><span class="line">    model.add(tf.layers.flatten(&#123; //  å±•å¹³å±‚ï¼Œ ä¸€ç»´çš„å‘é‡ï¼Œæ— è®­ç»ƒå‚æ•° </span><br><span class="line">        inputShape: layer.outputShape.slice(1) //  è·å–ä¸­é—´å±‚è¾“å‡ºçš„å½¢çŠ¶</span><br><span class="line">    &#125;));</span><br><span class="line">    model.add(tf.layers.dense(&#123; //  å…¨è¿æ¥å±‚</span><br><span class="line">        units: 10,</span><br><span class="line">        activation: &#x27;relu&#x27;</span><br><span class="line">    &#125;));</span><br><span class="line">    model.add(tf.layers.dense(&#123; // åˆ†ç±»å±‚ </span><br><span class="line">        units: NUM_CLASSES,</span><br><span class="line">        activation: &#x27;softmax&#x27;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    // å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span><br><span class="line">    model.compile(&#123; loss: &#x27;categoricalCrossentropy&#x27;, optimizer: tf.train.adam() &#125;);</span><br><span class="line"></span><br><span class="line">    //è®­ç»ƒæ•°æ®ç»è¿‡æˆªæ–­æ¨¡å‹ï¼Œè½¬ä¸ºå¯ä»¥ç”¨äºæ–°æ¨¡å‹è®­ç»ƒçš„æ•°æ®</span><br><span class="line">    const &#123; xs, ys &#125; = tf.tidy(() =&gt; &#123;</span><br><span class="line">        const xs = tf.concat(inputs.map(imgEl =&gt; truncatedMobilenet.predict(img2x(imgEl))));</span><br><span class="line">        const ys = tf.tensor(labels);</span><br><span class="line">        return &#123; xs, ys &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    await model.fit(xs, ys, &#123;</span><br><span class="line">        epochs: 20,</span><br><span class="line">        callbacks: tfvis.show.fitCallbacks(</span><br><span class="line">            &#123; name: &#x27;è®­ç»ƒæ•ˆæœ&#x27; &#125;,</span><br><span class="line">            [&#x27;loss&#x27;],</span><br><span class="line">            &#123; callbacks: [&#x27;onEpochEnd&#x27;] &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    window.predict = async (file) =&gt; &#123;</span><br><span class="line">        const img = await file2img(file);</span><br><span class="line">        document.body.appendChild(img);</span><br><span class="line">        const pred = tf.tidy(() =&gt; &#123;</span><br><span class="line">            const x = img2x(img);</span><br><span class="line">            const input = truncatedMobilenet.predict(x);</span><br><span class="line">            return model.predict(input);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        const index = pred.argMax(1).dataSync()[0];</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            alert(`é¢„æµ‹ç»“æœï¼š$&#123;BRAND_CLASSES[index]&#125;`);</span><br><span class="line">        &#125;, 0);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    window.download = async () =&gt; &#123;</span><br><span class="line">        await model.save(&#x27;downloads://model&#x27;);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>utils.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import * as tf from &#x27;@tensorflow/tfjs&#x27;;</span><br><span class="line"></span><br><span class="line">export function img2x(imgEl)&#123;</span><br><span class="line">    return tf.tidy(() =&gt; &#123;</span><br><span class="line">        const input = tf.browser.fromPixels(imgEl)</span><br><span class="line">            .toFloat()</span><br><span class="line">            .sub(255 / 2)</span><br><span class="line">            .div(255 / 2)</span><br><span class="line">            .reshape([1, 224, 224, 3]);</span><br><span class="line">        return input;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function file2img(f) &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        const reader = new FileReader();</span><br><span class="line">        reader.readAsDataURL(f);</span><br><span class="line">        reader.onload = (e) =&gt; &#123;</span><br><span class="line">            const img = document.createElement(&#x27;img&#x27;);</span><br><span class="line">            img.src = e.target.result;</span><br><span class="line">            img.width = 224;</span><br><span class="line">            img.height = 224;</span><br><span class="line">            img.onload = () =&gt; resolve(img);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">wangzhiwei</p>
  <div class="site-description" itemprop="description">javascript nodejs web developer...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangzhiwei</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
